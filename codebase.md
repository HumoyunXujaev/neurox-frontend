# .dockerignore

```
# Dependencies node_modules npm-debug.log yarn-error.log # Next.js build output .next out # Testing coverage .nyc_output __tests__ *.test.ts *.test.tsx jest.config.ts jest.setup.ts # Git .git .gitignore .gitattributes # CI/CD .github .gitlab-ci.yml .travis.yml # IDE .vscode .idea *.swp *.swo *~ # OS .DS_Store Thumbs.db # Environment files .env .env.local .env.development.local .env.test.local .env.production.local # Documentation README.md CONTRIBUTING.md LICENSE docs # Misc .npmrc .yarnrc .editorconfig .eslintcache .stylelintcache
```

# .github\workflows\ci-cd.yml

```yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

env:
  NODE_VERSION: '20.x'
  NEXT_PUBLIC_AUTH_SERVICE_URL: ${{ secrets.NEXT_PUBLIC_AUTH_SERVICE_URL }}
  NEXT_PUBLIC_BACKEND_URL: ${{ secrets.NEXT_PUBLIC_BACKEND_URL }}
  NEXT_PUBLIC_BOTS_CONNECTION_SECRET: ${{ secrets.NEXT_PUBLIC_BOTS_CONNECTION_SECRET }}
  NEXT_PUBLIC_MAIN_SERVICE_API_KEY: ${{ secrets.NEXT_PUBLIC_MAIN_SERVICE_API_KEY }}
  NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY: ${{ secrets.NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY }}

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linter
        run: npm run lint

      - name: Run tests with coverage
        run: npm run test:ci

      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella

  build:
    name: Build
    needs: test
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: nextjs-build
          path: |
            .next
            public
            package.json
            package-lock.json
          retention-days: 7

  deploy-staging:
    name: Deploy to Staging
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'
    environment:
      name: staging
      url: https://staging.neurox.ru
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: nextjs-build

      - name: Deploy to staging server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.STAGING_HOST }}
          username: ${{ secrets.STAGING_USER }}
          key: ${{ secrets.STAGING_SSH_KEY }}
          port: ${{ secrets.STAGING_PORT }}
          script: |
            cd /var/www/neurox-staging
            git pull origin develop
            npm ci --production
            npm run build
            pm2 restart neurox-staging || pm2 start npm --name "neurox-staging" -- start

  deploy-production:
    name: Deploy to Production
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    environment:
      name: production
      url: https://neurox.ru
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: nextjs-build

      - name: Deploy to production server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PRODUCTION_HOST }}
          username: ${{ secrets.PRODUCTION_USER }}
          key: ${{ secrets.PRODUCTION_SSH_KEY }}
          port: ${{ secrets.PRODUCTION_PORT }}
          script: |
            cd /var/www/neurox
            git pull origin main
            npm ci --production
            npm run build
            pm2 restart neurox || pm2 start npm --name "neurox" -- start

  docker-build-push:
    name: Build and Push Docker Image
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ${{ secrets.DOCKER_USERNAME }}/neurox-frontend
          tags: |
            type=ref,event=branch
            type=ref,event=pr
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=sha

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          platforms: linux/amd64,linux/arm64
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
          build-args: |
            NEXT_PUBLIC_AUTH_SERVICE_URL=${{ secrets.NEXT_PUBLIC_AUTH_SERVICE_URL }}
            NEXT_PUBLIC_BACKEND_URL=${{ secrets.NEXT_PUBLIC_BACKEND_URL }}
            NEXT_PUBLIC_BOTS_CONNECTION_SECRET=${{ secrets.NEXT_PUBLIC_BOTS_CONNECTION_SECRET }}
            NEXT_PUBLIC_MAIN_SERVICE_API_KEY=${{ secrets.NEXT_PUBLIC_MAIN_SERVICE_API_KEY }}
            NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY=${{ secrets.NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY }}
```

# app\account\loading.tsx

```tsx
export default function Loading() { return null }
```

# app\account\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Badge } from '@/components/ui/badge'; import { Progress } from '@/components/ui/progress'; import { Alert, AlertDescription } from '@/components/ui/alert'; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { User, Shield, CreditCard, ShoppingCart, Bell, Eye, EyeOff, CheckCircle, XCircle, AlertTriangle, Info, } from 'lucide-react'; import { toast } from 'sonner'; import { useSearchParams } from 'next/navigation'; import { useAuth } from '@/contexts/auth-context'; type TabType = | 'account' | 'profile' | 'security' | 'subscription' | 'purchase' | 'notifications'; export default function AccountPage() { const searchParams = useSearchParams(); const [activeTab, setActiveTab] = useState<TabType>( (searchParams.get('tab') as TabType) || 'account' ); const [showActivationDialog, setShowActivationDialog] = useState(false); const [showPaymentDialog, setShowPaymentDialog] = useState(false); const [activationKey, setActivationKey] = useState(''); const [selectedAgent, setSelectedAgent] = useState(''); const [showPassword, setShowPassword] = useState(false); const [showConfirmPassword, setShowConfirmPassword] = useState(false); const [newPassword, setNewPassword] = useState(''); const [confirmPassword, setConfirmPassword] = useState(''); // Profile form state const [profileData, setProfileData] = useState({ companyName: '', companySize: '', contactName: '', region: '', phone: '', email: '', language: '', experience: '', usage: '', }); // Notification states const [telegramConnected, setTelegramConnected] = useState(false); const [emailConnected, setEmailConnected] = useState(true); const { user, refreshUser } = useAuth(); const [accountDetails, setAccountDetails] = useState({ plan: 'Тест', subscriptionEnd: 'Never', botcoinBalance: 0, reservedBotcoin: 0, }); const getSubscriptionEndDate = () => { if (!user?.created_at) return new Date(); const createdDate = new Date(user.created_at); const endDate = new Date(createdDate); endDate.setDate(createdDate.getDate() + 7); return endDate; }; const getDaysRemaining = () => { const endDate = getSubscriptionEndDate(); const now = new Date(); const diffTime = endDate.getTime() - now.getTime(); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); return Math.max(0, diffDays); }; const getSubscriptionProgress = () => { const daysRemaining = getDaysRemaining(); return ((7 - daysRemaining) / 7) * 100; }; useEffect(() => { const fetchAccountDetails = async () => { if (user) { // Assuming user object contains necessary account details setAccountDetails({ plan: user.role, // Example: Assuming user.role represents the plan subscriptionEnd: 'Never', // Replace with actual subscription end date if available botcoinBalance: 100, // Replace with actual BotCoin balance if available reservedBotcoin: 0, // Replace with actual reserved BotCoin balance if available }); } }; fetchAccountDetails(); }, [user]); const tabs = [ { id: 'account', label: 'АККАУНТ', icon: User }, { id: 'profile', label: 'ПРОФИЛЬ', icon: User }, { id: 'security', label: 'БЕЗОПАСНОСТЬ', icon: Shield }, { id: 'subscription', label: 'ОПЛАТА ПОДПИСКИ', icon: CreditCard }, { id: 'purchase', label: 'ПОКУПКА BOTCOIN', icon: ShoppingCart }, { id: 'notifications', label: 'УВЕДОМЛЕНИЯ', icon: Bell }, ]; const handleActivateKey = () => { if (!activationKey.trim()) { toast.error('Введите ключ активации'); return; } toast.success('Ключ активации успешно применен'); setShowActivationDialog(false); setActivationKey(''); }; const handlePasswordChange = () => { if (!newPassword || !confirmPassword) { toast.error('Заполните все поля'); return; } if (newPassword !== confirmPassword) { toast.error('Пароли не совпадают'); return; } if (newPassword.length < 6) { toast.error('Пароль должен содержать минимум 6 символов'); return; } toast.success('Пароль успешно изменен'); setNewPassword(''); setConfirmPassword(''); }; const handlePayment = (paymentType: string) => { setShowPaymentDialog(false); toast.success(`Переход к оплате: ${paymentType}`); }; const renderAccountTab = () => ( <div className='space-y-4 md:space-y-6'> <h2 className='text-xl md:text-2xl font-bold'>Текущий план</h2> <div className='grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6'> <Card> <CardContent className='p-4 md:p-6'> <div className='space-y-4'> <div> <div className='text-lg font-semibold'> Тариф: {accountDetails.plan} </div> <div className='text-muted-foreground'>Пробная версия</div> </div> <div className='space-y-2'> <div className='text-sm text-muted-foreground'> Подписка не оплачена. </div> <div className='text-sm text-muted-foreground'> Уведомление об окончании подписки (и за 7 дней) придут вам в Email </div> </div> <div className='flex items-center gap-2'> <span className='text-lg font-bold'>0 руб в месяц</span> <Badge variant='secondary'>test</Badge> </div> <div className='text-sm text-muted-foreground'> Версия для тестирования </div> <Alert className='bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-600'> <AlertTriangle className='h-4 w-4 text-amber-600' /> <AlertDescription className='text-amber-800 dark:text-amber-200'> <strong>Внимание!</strong> <br /> Требуется оплатить{' '} <button onClick={() => setActiveTab('subscription')} className='underline hover:text-amber-900' > подписку </button> ! </AlertDescription> </Alert> </div> </CardContent> </Card> <Card> <CardContent className='p-4 md:p-6'> <div className='space-y-4'> <div className='flex items-center justify-between'> <span className='text-sm text-muted-foreground'> Текущая подписка </span> <span className='text-sm'> {getDaysRemaining()} из 7 дн осталось </span> </div> <Progress value={getSubscriptionProgress()} className='h-2' /> <div className='text-sm text-muted-foreground'> {getDaysRemaining()} дн. до окончания подписки </div> <div className='space-y-2'> <div className='flex items-center justify-between'> <span className='text-sm text-muted-foreground'> Бонусные BotCoin </span> <span className='text-sm'> {accountDetails.botcoinBalance} из 10 </span> </div> <Progress value={99.5} className='h-2' /> <div className='text-xs text-muted-foreground'> Обновляются каждый месяц на всех тарифах (кроме тестовых) </div> </div> <div className='space-y-2'> <div className='flex items-center justify-between'> <span className='text-sm text-muted-foreground'> Резервные BotCoin </span> <span className='text-sm'> {accountDetails.reservedBotcoin} </span> </div> <div className='text-xs text-muted-foreground'> Сохраняются после обновления и расходуются после бонусных </div> </div> </div> </CardContent> </Card> </div> <div className='flex justify-end'> <Button onClick={() => setShowActivationDialog(true)} className='bg-purple-600 hover:bg-purple-700 w-full sm:w-auto' > АКТИВИРОВАТЬ КЛЮЧ </Button> </div> </div> ); const renderProfileTab = () => ( <div className='space-y-4 md:space-y-6'> <h2 className='text-xl md:text-2xl font-bold'>Настройка профиля</h2> <div className='grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6'> <div className='space-y-2'> <Label htmlFor='company-name'>Название компании</Label> <Input id='company-name' value={profileData.companyName} onChange={(e) => setProfileData({ ...profileData, companyName: e.target.value }) } placeholder='Введите название компании' /> </div> <div className='space-y-2'> <Label htmlFor='activity-sphere'>Сфера деятельности</Label> <Input id='activity-sphere' value={profileData.contactName} onChange={(e) => setProfileData({ ...profileData, contactName: e.target.value }) } placeholder='Введите сферу деятельности' /> </div> <div className='space-y-2'> <Label htmlFor='company-size'>Размер компании</Label> <Input id='company-size' value={profileData.companySize} onChange={(e) => setProfileData({ ...profileData, companySize: e.target.value }) } placeholder='Введите размер компании' /> </div> <div className='space-y-2'> <Label htmlFor='region'>Регион</Label> <Input id='region' value={profileData.region} onChange={(e) => setProfileData({ ...profileData, region: e.target.value }) } placeholder='Введите регион' /> </div> <div className='space-y-2'> <Label htmlFor='contact-person'>ФИО для связи</Label> <Input id='contact-person' value={profileData.contactName} onChange={(e) => setProfileData({ ...profileData, contactName: e.target.value }) } placeholder='Введите ФИО' /> </div> <div className='space-y-2'> <Label htmlFor='phone'>Телефонный номер</Label> <Input id='phone' value={profileData.phone} onChange={(e) => setProfileData({ ...profileData, phone: e.target.value }) } placeholder='Введите номер телефона' /> </div> <div className='space-y-2'> <Label htmlFor='email'>Email</Label> <Input id='email' type='email' value={profileData.email} onChange={(e) => setProfileData({ ...profileData, email: e.target.value }) } placeholder='Введите email' /> </div> <div className='space-y-2'> <Label htmlFor='language'>Язык</Label> <Select value={profileData.language} onValueChange={(value) => setProfileData({ ...profileData, language: value }) } > <SelectTrigger> <SelectValue placeholder='Выберите язык' /> </SelectTrigger> <SelectContent> <SelectItem value='ru'>Русский</SelectItem> <SelectItem value='en'>English</SelectItem> </SelectContent> </Select> </div> <div className='space-y-2'> <Label htmlFor='experience'>Прошлый опыт</Label> <Select value={profileData.experience} onValueChange={(value) => setProfileData({ ...profileData, experience: value }) } > <SelectTrigger> <SelectValue placeholder='Выберите опыт' /> </SelectTrigger> <SelectContent> <SelectItem value='beginner'>Начинающий</SelectItem> <SelectItem value='intermediate'>Средний</SelectItem> <SelectItem value='advanced'>Продвинутый</SelectItem> </SelectContent> </Select> </div> <div className='space-y-2'> <Label htmlFor='usage'>Способ применения</Label> <Select value={profileData.usage} onValueChange={(value) => setProfileData({ ...profileData, usage: value }) } > <SelectTrigger> <SelectValue placeholder='Выберите способ применения' /> </SelectTrigger> <SelectContent> <SelectItem value='support'>Поддержка клиентов</SelectItem> <SelectItem value='sales'>Продажи</SelectItem> <SelectItem value='marketing'>Маркетинг</SelectItem> </SelectContent> </Select> </div> </div> </div> ); const renderSecurityTab = () => ( <div className='space-y-4 md:space-y-6'> <h2 className='text-xl md:text-2xl font-bold'>Смена пароля</h2> <Card className='max-w-2xl'> <CardContent className='p-4 md:p-6 space-y-6'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='space-y-2'> <Label htmlFor='new-password'>Новый пароль</Label> <div className='relative'> <Input id='new-password' type={showPassword ? 'text' : 'password'} value={newPassword} onChange={(e) => setNewPassword(e.target.value)} placeholder='Введите новый пароль' /> <Button type='button' variant='ghost' size='icon' className='absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8' onClick={() => setShowPassword(!showPassword)} > {showPassword ? ( <EyeOff className='h-4 w-4' /> ) : ( <Eye className='h-4 w-4' /> )} </Button> </div> </div> <div className='space-y-2'> <Label htmlFor='confirm-password'> Подтверждение нового пароля </Label> <div className='relative'> <Input id='confirm-password' type={showConfirmPassword ? 'text' : 'password'} value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} placeholder='Подтвердите новый пароль' /> <Button type='button' variant='ghost' size='icon' className='absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8' onClick={() => setShowConfirmPassword(!showConfirmPassword)} > {showConfirmPassword ? ( <EyeOff className='h-4 w-4' /> ) : ( <Eye className='h-4 w-4' /> )} </Button> </div> </div> </div> <div className='space-y-2'> <div className='text-sm font-medium'>Требования к паролю:</div> <ul className='text-sm text-muted-foreground space-y-1'> <li>• Минимум 6 символов в длину - лучше больше</li> <li>• Как минимум одна цифра и буква</li> </ul> </div> <div className='flex flex-col sm:flex-row gap-3'> <Button onClick={handlePasswordChange} className='bg-purple-600 hover:bg-purple-700' > СОХРАНИТЬ </Button> <Button variant='outline' onClick={() => { setNewPassword(''); setConfirmPassword(''); }} > ОТМЕНА </Button> </div> </CardContent> </Card> </div> ); const renderSubscriptionTab = () => ( <div className='space-y-4 md:space-y-6'> <div> <h2 className='text-xl md:text-2xl font-bold'>Купить подписку</h2> <p className='text-muted-foreground text-sm md:text-base'> Подписка активируется сразу после оплаты. Выберите подходящий для вас тариф. </p> </div> <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6'> {/* Business Plan */} <Card className='relative'> <CardHeader className='text-center pb-4'> <div className='mx-auto mb-4'> <img src='/images/4.png' alt='Business' className='h-26 w-26 md:h-26 md:w-26 mx-auto' /> </div> <CardTitle className='text-lg md:text-xl'>Бизнес</CardTitle> <div className='text-2xl md:text-3xl font-bold text-purple-600'> ₽2900 </div> </CardHeader> <CardContent className='space-y-3'> <div className='space-y-2 text-sm'> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>310 бонусных BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Возможность докупать BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Подписка на месяц</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> Доступны каналы связи: Telegram, Instagram, Avito, Vk, Salebot </span> </div> <div className='flex items-start gap-2 text-red-500'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>НЕдоступны интеграции с CRM, Notion, ELabs</span> </div> <div className='flex items-start gap-2 text-red-500'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> WhatsApp не входит в стоимость, доступен на странице "Каналы" </span> </div> </div> <Button className='w-full bg-purple-600 hover:bg-purple-700 mt-6' onClick={() => setShowPaymentDialog(true)} > <CreditCard className='mr-2 h-4 w-4' /> ОПЛАТИТЬ </Button> </CardContent> </Card> {/* Premium Plan */} <Card className='relative border-purple-500'> <CardHeader className='text-center pb-4'> <div className='mx-auto mb-4'> <img src='/images/5.png' alt='Premium' className='h-26 w-26 md:h-26 md:w-26 mx-auto' /> </div> <CardTitle className='text-lg md:text-xl'>Премиум</CardTitle> <div className='text-2xl md:text-3xl font-bold text-purple-600'> ₽4000 </div> </CardHeader> <CardContent className='space-y-3'> <div className='space-y-2 text-sm'> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>1520 бонусных BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Возможность докупать BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Подписка на месяц</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> Доступны каналы связи: Telegram, Instagram, Avito, Vk, Salebot </span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Интеграции с CRM, Notion, ELabs</span> </div> <div className='flex items-start gap-2 text-red-500'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> WhatsApp не входит в стоимость, доступен на странице "Каналы" </span> </div> </div> <Button className='w-full bg-purple-600 hover:bg-purple-700 mt-6' onClick={() => setShowPaymentDialog(true)} > <CreditCard className='mr-2 h-4 w-4' /> ОПЛАТИТЬ </Button> </CardContent> </Card> {/* VIP Plan */} <Card className='relative md:col-span-2 lg:col-span-1'> <CardHeader className='text-center pb-4'> <div className='mx-auto mb-4'> <img src='/images/6.png' alt='VIP' className='h-26 w-26 md:h-26 md:w-26 mx-auto' /> </div> <CardTitle className='text-lg md:text-xl'>VIP</CardTitle> <div className='text-2xl md:text-3xl font-bold text-purple-600'> ₽50000 </div> </CardHeader> <CardContent className='space-y-3'> <div className='space-y-2 text-sm'> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>1520 бонусных BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Возможность докупать BotCoin</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Подписка на месяц</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> Доступны каналы связи: Telegram, Instagram, Avito, Vk, Salebot </span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span>Интеграции с CRM, Notion, ELabs</span> </div> <div className='flex items-start gap-2'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> Поддержка персонального менеджера по настройке и интеграции NEXTBOT </span> </div> <div className='flex items-start gap-2 text-red-500'> <div className='w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0'></div> <span> WhatsApp не входит в стоимость, доступен на странице "Каналы" </span> </div> </div> <Button className='w-full bg-purple-600 hover:bg-purple-700 mt-6' onClick={() => setShowPaymentDialog(true)} > <CreditCard className='mr-2 h-4 w-4' /> ОПЛАТИТЬ </Button> </CardContent> </Card> </div> </div> ); const renderPurchaseTab = () => ( <div className='space-y-4 md:space-y-6'> <div className='max-w-md mx-auto'> <Card> <CardHeader className='text-center pb-4'> <div className='mx-auto mb-4'> <img src='/images/4.png' alt='BotCoin' className='h-26 w-26 md:h-26 md:w-26 mx-auto' /> </div> <CardTitle className='text-xl md:text-2xl'>300 BotCoin</CardTitle> <div className='text-sm text-muted-foreground'> 1.40 руб за 1 BotCoin </div> </CardHeader> <CardContent className='text-center space-y-6'> <div className='text-3xl md:text-4xl font-bold text-purple-600'> ₽420 </div> <div className='space-y-2 text-sm text-muted-foreground'> <div className='flex items-center gap-2'> <div className='w-1 h-1 bg-current rounded-full'></div> <span>300 BotCoin</span> </div> <div className='flex items-center gap-2'> <div className='w-1 h-1 bg-current rounded-full'></div> <span>Данные BotCoin не сгорают</span> </div> </div> <Button className='w-full bg-purple-600 hover:bg-purple-700' onClick={() => setShowPaymentDialog(true)} > <CreditCard className='mr-2 h-4 w-4' /> ОПЛАТИТЬ </Button> </CardContent> </Card> </div> </div> ); const renderNotificationsTab = () => ( <div className='space-y-4 md:space-y-6'> <h2 className='text-xl md:text-2xl font-bold'>Настройка уведомлений</h2> <div className='space-y-4 md:space-y-6'> {/* Telegram Notifications */} <Card> <CardHeader className='flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0'> <CardTitle className='text-lg'> Настройка уведомлений Telegram </CardTitle> <Info className='h-5 w-5 text-muted-foreground' /> </CardHeader> <CardContent className='space-y-4'> <div className='flex items-center gap-2'> <span className='text-sm'>Статус подключения:</span> {telegramConnected ? ( <div className='flex items-center gap-1'> <CheckCircle className='h-4 w-4 text-green-500' /> <span className='text-green-600'>Подключено</span> </div> ) : ( <div className='flex items-center gap-1'> <XCircle className='h-4 w-4 text-red-500' /> <span className='text-red-600'>Не подключено</span> </div> )} </div> <div className='flex flex-col sm:flex-row gap-3'> {telegramConnected ? ( <Button variant='destructive' onClick={() => { setTelegramConnected(false); toast.success('Telegram уведомления отключены'); }} > ОТКЛЮЧИТЬ </Button> ) : ( <Button onClick={() => { setTelegramConnected(true); toast.success('Telegram уведомления подключены'); }} className='bg-purple-600 hover:bg-purple-700' > ПОДПИСАТЬСЯ </Button> )} </div> {!telegramConnected && ( <div className='text-sm text-muted-foreground'> После подключения Telegram для получения состояния подключения требуется обновить страницу </div> )} </CardContent> </Card> {/* Email Notifications */} <Card> <CardHeader className='flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0'> <CardTitle className='text-lg'> Настройка уведомлений Email </CardTitle> <Info className='h-5 w-5 text-muted-foreground' /> </CardHeader> <CardContent className='space-y-4'> <div className='flex items-center gap-2'> <span className='text-sm'>Статус подключения:</span> {emailConnected ? ( <div className='flex items-center gap-1'> <CheckCircle className='h-4 w-4 text-green-500' /> <span className='text-green-600'>Подключено</span> </div> ) : ( <div className='flex items-center gap-1'> <XCircle className='h-4 w-4 text-red-500' /> <span className='text-red-600'>Не подключено</span> </div> )} </div> <div className='flex flex-col sm:flex-row gap-3'> {emailConnected ? ( <Button variant='destructive' onClick={() => { setEmailConnected(false); toast.success('Email уведомления отключены'); }} > ОТКЛЮЧИТЬ </Button> ) : ( <Button onClick={() => { setEmailConnected(true); toast.success('Email уведомления подключены'); }} className='bg-purple-600 hover:bg-purple-700' disabled > ПОДПИСАТЬСЯ </Button> )} </div> </CardContent> </Card> </div> </div> ); const renderTabContent = () => { switch (activeTab) { case 'account': return renderAccountTab(); case 'profile': return renderProfileTab(); case 'security': return renderSecurityTab(); case 'subscription': return renderSubscriptionTab(); case 'purchase': return renderPurchaseTab(); case 'notifications': return renderNotificationsTab(); default: return renderAccountTab(); } }; return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 overflow-auto'> {/* Tab Navigation */} <div className='border-b bg-background sticky top-0 z-10'> <div className='flex overflow-x-auto'> {tabs.map((tab) => ( <button key={tab.id} onClick={() => setActiveTab(tab.id as TabType)} className={`flex items-center gap-2 px-4 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${ activeTab === tab.id ? 'border-purple-500 text-purple-600' : 'border-transparent text-muted-foreground hover:text-foreground' }`} > <tab.icon className='h-4 w-4' /> <span className='hidden sm:inline'>{tab.label}</span> </button> ))} </div> </div> {/* Tab Content */} <div className='p-4 md:p-6'> <div className='max-w-7xl mx-auto'>{renderTabContent()}</div> </div> </main> </div> {/* Activation Key Dialog */} <Dialog open={showActivationDialog} onOpenChange={setShowActivationDialog} > <DialogContent className='sm:max-w-md mx-4'> <DialogHeader> <DialogTitle>Активация ключа</DialogTitle> <DialogDescription> Введите ключ активации для получения дополнительных возможностей или подписки </DialogDescription> </DialogHeader> <div className='space-y-4'> <div className='space-y-2'> <Label htmlFor='activation-key'>Ключ активации</Label> <Input id='activation-key' value={activationKey} onChange={(e) => setActivationKey(e.target.value)} placeholder='XXXX-XXXX-XXXX-XXXX-XXXX' /> </div> <div className='space-y-2'> <Label htmlFor='agent-select'> Выберите агента (опционально) </Label> <Select value={selectedAgent} onValueChange={setSelectedAgent}> <SelectTrigger> <SelectValue placeholder='Выберите агента' /> </SelectTrigger> <SelectContent> <SelectItem value='agent1'>Новый агент 1</SelectItem> <SelectItem value='agent2'>Агент 2</SelectItem> </SelectContent> </Select> </div> <Alert className='bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-600'> <Info className='h-4 w-4 text-blue-600' /> <AlertDescription className='text-blue-800 dark:text-blue-200'> Выбор агента требуется только для активации ключей WhatsApp. В большинстве случаев это поле можно оставить пустым. </AlertDescription> </Alert> </div> <DialogFooter className='flex flex-col sm:flex-row gap-2'> <Button variant='outline' onClick={() => setShowActivationDialog(false)} > ОТМЕНА </Button> <Button onClick={handleActivateKey} className='bg-purple-600 hover:bg-purple-700' > АКТИВИРОВАТЬ КЛЮЧ </Button> </DialogFooter> </DialogContent> </Dialog> {/* Payment Type Selection Dialog */} <Dialog open={showPaymentDialog} onOpenChange={setShowPaymentDialog}> <DialogContent className='sm:max-w-md mx-4'> <DialogHeader> <DialogTitle className='text-center'> Выберите тип оплаты </DialogTitle> </DialogHeader> <div className='space-y-3'> <Button className='w-full bg-purple-600 hover:bg-purple-700 text-white h-12' onClick={() => handlePayment('Оплата картой РФ')} > ОПЛАТА КАРТОЙ РФ </Button> <Button className='w-full bg-purple-600 hover:bg-purple-700 text-white h-12' onClick={() => handlePayment('Оплата картой')} > ОПЛАТА КАРТОЙ </Button> <Button className='w-full bg-purple-600 hover:bg-purple-700 text-white h-12' onClick={() => handlePayment('Оплата по расчетному счету')} > ОПЛАТА ПО РАСЧЕТНОМУ СЧЕТУ </Button> </div> </DialogContent> </Dialog> </div> ); }
```

# app\agents\page.tsx

```tsx
'use client'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { AgentCard } from '@/components/agent-card'; import { AddAgentCard } from '@/components/add-agent-card'; import { useAgentStore } from '@/lib/agent-store'; import { useAgents, type Agent } from '@/hooks/use-agents'; import { useState, useEffect } from 'react'; import { toast } from 'sonner'; import { useAuth } from '@/contexts/auth-context'; // Генерация случайного аватара const getRandomAvatar = () => { const randomSeed = Math.floor(Math.random() * 40) + 1; return `https://api.dicebear.com/9.x/notionists/png?seed=${randomSeed}&backgroundColor=b6e3f4,c0aede,d1d4f9`; }; export default function Dashboard() { const { selectedAgent, setSelectedAgent, setAgents: setStoreAgents, updateAgent: updateStoreAgent, deleteAgent: deleteStoreAgent, addAgent: addStoreAgent, } = useAgentStore(); const { agents, isLoading, createAgent, updateAgent: updateBackendAgent, deleteAgent: deleteBackendAgent, refresh, } = useAgents({ autoLoad: true }); const { user } = useAuth(); const [copiedAgentCode, setCopiedAgentCode] = useState<string | null>(null); // Добавим функцию для принудительного обновления UI const [, forceUpdate] = useState({}); // Синхронизируем агентов из бэкенда со стором (включая localStorage статусы) useEffect(() => { setStoreAgents(agents); }, [agents, setStoreAgents]); const handleAgentUpdate = async (updatedAgent: Agent) => { // Обновляем в localStorage через store updateStoreAgent(updatedAgent); // Также обновляем в бэкенде (кроме статуса) const { status, ...backendData } = updatedAgent; const result = await updateBackendAgent(updatedAgent.id, backendData); if (result) { // Merge backend result with localStorage status const finalAgent = { ...result, status: updatedAgent.status }; updateStoreAgent(finalAgent); } }; const handleAgentDelete = async (agentId: string) => { const success = await deleteBackendAgent(agentId, Number(user?.company_id)); if (success) { deleteStoreAgent(agentId); } }; const handleAgentAdd = async (newAgent: Agent, isFromCode = false) => { // Если агент не создается из кода, присваиваем случайный аватар if (!isFromCode && !newAgent.avatar) { newAgent.avatar = getRandomAvatar(); } // Сначала добавляем в localStorage addStoreAgent(newAgent); // Затем создаем в бэкенде const createdAgent = await createAgent(newAgent); if (createdAgent) { // Обновляем с данными из бэкенда, сохраняя localStorage статус const finalAgent = { ...createdAgent, status: newAgent.status }; updateStoreAgent(finalAgent); refresh(); } }; const handleCopyAgentCode = (agent: Agent) => { // Преобразуем объект в JSON-строку const jsonString = JSON.stringify(agent); // Безопасное кодирование в Base64 (поддерживает Unicode) const agentCode = btoa( encodeURIComponent(jsonString).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode(Number.parseInt(p1, 16)) ) ); setCopiedAgentCode(agentCode); navigator.clipboard.writeText(agentCode); toast.success('Код агента скопирован'); }; // Обновим обработчик переключения статуса const handleToggleStatus = (agentId: string) => { // Переключаем статус в store useAgentStore.getState().toggleAgentStatus(agentId); // Принудительно обновляем UI forceUpdate({}); }; return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68'> <Sidebar /> </div> {/* Main Content */} <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-3 md:p-4 lg:p-6 overflow-auto'> <div className='max-w-7xl mx-auto'> {isLoading && agents.length === 0 ? ( <div className='flex items-center justify-center h-64'> <div className='animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600'></div> </div> ) : ( <div className='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3 md:gap-4 lg:gap-6'> {agents.map((agent) => ( <AgentCard key={agent.id} agent={agent} isSelected={selectedAgent?.id === agent.id} onSelect={() => setSelectedAgent(agent)} onUpdate={handleAgentUpdate} onDelete={handleAgentDelete} onCopyCode={handleCopyAgentCode} // onToggleStatus={handleToggleStatus} /> ))} <AddAgentCard onAddAgent={handleAgentAdd} copiedAgentCode={copiedAgentCode} /> </div> )} </div> </main> </div> </div> ); }
```

# app\analytics\page.tsx

```tsx
'use client'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Calendar, ChevronDown } from 'lucide-react'; import { LineChart, Line, XAxis, YAxis, CartesianGrid, ResponsiveContainer, BarChart, Bar, } from 'recharts'; import { ChartContainer, ChartTooltip, ChartTooltipContent, } from '@/components/ui/chart'; // Sample data for charts const botcoinData = [{ date: '01', value: 0.04 }]; const dialogsData = [{ date: '01/07/2025', messages: 4, dialogs: 1 }]; const functionsData = [{ date: '01/07/2025', functions: 0 }]; const tokensData = [ { date: '01', 'gpt-4o-mini-incoming': 0, 'gpt-4o-mini-outgoing': 0, 'gpt-4-incoming': 0, 'gpt-4-outgoing': 0, 'gpt-o3-mini-incoming': 0, }, ]; export default function AnalyticsPage() { return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-7xl mx-auto space-y-4 md:space-y-6'> {/* BotCoin Expenses Chart */} <Card> <CardHeader className='flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <CardTitle className='text-lg font-medium'> Расход Botcoins </CardTitle> <Button variant='outline' size='sm' className='flex items-center gap-2 bg-transparent text-sm' > <Calendar className='h-4 w-4' /> <span className='hidden sm:inline'>01/06/25 - 01/07/25</span> <span className='sm:hidden'>Период</span> <ChevronDown className='h-4 w-4' /> </Button> </CardHeader> <CardContent> <div className='text-sm text-muted-foreground mb-4 space-y-1'> <div>Общие затраты за выбранный период: 0.03 Botcoins</div> <div>Средние затраты на диалог: 0.03 Botcoins/диалог</div> <div className='flex items-center gap-2 mt-2'> <div className='w-3 h-3 bg-purple-500 rounded-full'></div> <span>Главный текст</span> </div> </div> <ChartContainer config={{ value: { label: 'BotCoin', color: 'hsl(var(--chart-1))', }, }} className='h-[200px]' > <ResponsiveContainer width='100%' height='100%'> <BarChart data={botcoinData}> <CartesianGrid strokeDasharray='3 3' /> <XAxis dataKey='date' /> <YAxis domain={[0, 0.05]} /> <ChartTooltip content={<ChartTooltipContent />} /> <Bar dataKey='value' fill='var(--color-value)' /> </BarChart> </ResponsiveContainer> </ChartContainer> <div className='text-xs text-muted-foreground mt-2'> Отображается только расходы, превышающие 0.01 Botcoins </div> </CardContent> </Card> {/* Dialogs and Messages Chart */} <Card> <CardHeader className='flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <CardTitle className='text-lg font-medium'> Диалоги и сообщения </CardTitle> <Button variant='outline' size='sm' className='flex items-center gap-2 bg-transparent text-sm' > <Calendar className='h-4 w-4' /> <span className='hidden sm:inline'>01/06/25 - 01/07/25</span> <span className='sm:hidden'>Период</span> <ChevronDown className='h-4 w-4' /> </Button> </CardHeader> <CardContent> <div className='flex flex-wrap items-center gap-4 mb-4 text-sm'> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-blue-500 rounded-full'></div> <span>Сообщения: 4</span> </div> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-purple-500 rounded-full'></div> <span>Диалоги: 1</span> </div> </div> <ChartContainer config={{ messages: { label: 'Сообщения', color: 'hsl(var(--chart-2))', }, dialogs: { label: 'Диалоги', color: 'hsl(var(--chart-1))', }, }} className='h-[200px]' > <ResponsiveContainer width='100%' height='100%'> <BarChart data={dialogsData}> <CartesianGrid strokeDasharray='3 3' /> <XAxis dataKey='date' /> <YAxis domain={[0, 8]} /> <ChartTooltip content={<ChartTooltipContent />} /> <Bar dataKey='messages' fill='var(--color-messages)' /> <Bar dataKey='dialogs' fill='var(--color-dialogs)' /> </BarChart> </ResponsiveContainer> </ChartContainer> </CardContent> </Card> {/* Functions Executed Chart */} <Card> <CardHeader className='flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <CardTitle className='text-lg font-medium'> Выполнено функций </CardTitle> <Button variant='outline' size='sm' className='flex items-center gap-2 bg-transparent text-sm' > <Calendar className='h-4 w-4' /> <span className='hidden sm:inline'>01/06/25 - 01/07/25</span> <span className='sm:hidden'>Период</span> <ChevronDown className='h-4 w-4' /> </Button> </CardHeader> <CardContent> <div className='flex items-center gap-2 mb-4 text-sm'> <div className='w-3 h-3 bg-purple-500 rounded-full'></div> <span>Выполнено функций: 0</span> </div> <ChartContainer config={{ functions: { label: 'Функции', color: 'hsl(var(--chart-1))', }, }} className='h-[200px]' > <ResponsiveContainer width='100%' height='100%'> <BarChart data={functionsData}> <CartesianGrid strokeDasharray='3 3' /> <XAxis dataKey='date' /> <YAxis domain={[0, 4]} /> <ChartTooltip content={<ChartTooltipContent />} /> <Bar dataKey='functions' fill='var(--color-functions)' /> </BarChart> </ResponsiveContainer> </ChartContainer> </CardContent> </Card> {/* Tokens Chart */} <Card> <CardHeader className='flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <CardTitle className='text-lg font-medium'>Токены</CardTitle> <Button variant='outline' size='sm' className='flex items-center gap-2 bg-transparent text-sm' > <Calendar className='h-4 w-4' /> <span className='hidden sm:inline'>01/06/25 - 01/07/25</span> <span className='sm:hidden'>Период</span> <ChevronDown className='h-4 w-4' /> </Button> </CardHeader> <CardContent> <div className='grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4 text-xs'> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-green-500 rounded-full'></div> <span>Входящие токены GPT-4o-mini: 0</span> </div> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-blue-500 rounded-full'></div> <span>Исходящие токены GPT-4o-mini: 0</span> </div> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-purple-500 rounded-full'></div> <span>Входящие токены GPT-4: 0</span> </div> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-orange-500 rounded-full'></div> <span>Исходящие токены GPT-4: 0</span> </div> <div className='flex items-center gap-2'> <div className='w-3 h-3 bg-red-500 rounded-full'></div> <span>Входящие токены GPT-o3-mini: 0</span> </div> </div> <ChartContainer config={{ 'gpt-4o-mini-incoming': { label: 'GPT-4o-mini входящие', color: 'hsl(var(--chart-3))', }, 'gpt-4o-mini-outgoing': { label: 'GPT-4o-mini исходящие', color: 'hsl(var(--chart-2))', }, 'gpt-4-incoming': { label: 'GPT-4 входящие', color: 'hsl(var(--chart-1))', }, 'gpt-4-outgoing': { label: 'GPT-4 исходящие', color: 'hsl(var(--chart-4))', }, 'gpt-o3-mini-incoming': { label: 'GPT-o3-mini входящие', color: 'hsl(var(--chart-5))', }, }} className='h-[200px]' > <ResponsiveContainer width='100%' height='100%'> <LineChart data={tokensData}> <CartesianGrid strokeDasharray='3 3' /> <XAxis dataKey='date' /> <YAxis domain={[0, 4]} /> <ChartTooltip content={<ChartTooltipContent />} /> <Line type='monotone' dataKey='gpt-4o-mini-incoming' stroke='var(--color-gpt-4o-mini-incoming)' /> <Line type='monotone' dataKey='gpt-4o-mini-outgoing' stroke='var(--color-gpt-4o-mini-outgoing)' /> <Line type='monotone' dataKey='gpt-4-incoming' stroke='var(--color-gpt-4-incoming)' /> <Line type='monotone' dataKey='gpt-4-outgoing' stroke='var(--color-gpt-4-outgoing)' /> <Line type='monotone' dataKey='gpt-o3-mini-incoming' stroke='var(--color-gpt-o3-mini-incoming)' /> </LineChart> </ResponsiveContainer> </ChartContainer> </CardContent> </Card> </div> </main> </div> </div> ); }
```

# app\api\health\route.ts

```ts
import { NextResponse } from 'next/server'; export async function GET() { try { // Проверяем основные зависимости const checks = { status: 'ok', timestamp: new Date().toISOString(), uptime: process.uptime(), environment: process.env.NODE_ENV, version: process.env.npm_package_version || '1.0.0', memory: { used: process.memoryUsage().heapUsed / 1024 / 1024, total: process.memoryUsage().heapTotal / 1024 / 1024, external: process.memoryUsage().external / 1024 / 1024, }, }; return NextResponse.json(checks, { status: 200 }); } catch (error) { return NextResponse.json( { status: 'error', timestamp: new Date().toISOString(), error: error instanceof Error ? error.message : 'Unknown error', }, { status: 503 } ); } }
```

# app\channels\page.tsx

```tsx
'use client'; import { useState, useEffect, useCallback } from 'react'; import { Plus, Search, MoreVertical, RefreshCw, CheckCircle, XCircle, AlertCircle, } from 'lucide-react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent, CardDescription, CardHeader, CardTitle, } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Label } from '@/components/ui/label'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Skeleton } from '@/components/ui/skeleton'; import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, } from '@/components/ui/dropdown-menu'; import { Sidebar } from '@/components/sidebar'; import { Header } from '@/components/header'; import { useAuth } from '@/contexts/auth-context'; import { apiClient, InfoFlow } from '@/lib/api/client'; import { toast } from 'sonner'; import { cn } from '@/lib/utils'; // Channel type icons const channelIcons = { telegram: '📱', instagram: '📷', web: '🌐', }; // Channel type names const channelTypeNames = { telegram: 'Telegram', instagram: 'Instagram', web: 'Web Chat', }; export default function ChannelsPage() { const { user } = useAuth(); const [channels, setChannels] = useState<InfoFlow[]>([]); const [isLoading, setIsLoading] = useState(true); const [searchQuery, setSearchQuery] = useState(''); const [showAddDialog, setShowAddDialog] = useState(false); const [isCreating, setIsCreating] = useState(false); const [selectedChannel, setSelectedChannel] = useState<InfoFlow | null>(null); // New channel form const [newChannel, setNewChannel] = useState({ name: '', type: 'telegram' as 'telegram' | 'instagram' | 'web', data: {}, }); // Load channels const loadChannels = useCallback(async () => { if (!user?.company_id) return; try { setIsLoading(true); apiClient.infoFlow.setAuthHeader(process.env.NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY); const response = await apiClient.infoFlow.list({ limit: 100, }); // Filter by company const companyChannels = response.data.results.filter( (channel) => channel.company_id === user.company_id ); setChannels(companyChannels); console.log(response, 'response'); } catch (error) { console.error('Error loading channels:', error); toast.error('Ошибка загрузки каналов'); } finally { setIsLoading(false); } }, [user?.company_id]); useEffect(() => { loadChannels(); }, [loadChannels]); // Filter channels by search const filteredChannels = channels.filter((channel) => { if (!searchQuery) return true; const query = searchQuery.toLowerCase(); return ( channel.name.toLowerCase().includes(query) || channel.type.toLowerCase().includes(query) ); }); // Create channel const handleCreateChannel = async () => { if (!newChannel.name.trim() || !user?.company_id) return; setIsCreating(true); try { const channelData = { id: Math.floor(Date.now() / 100000), name: newChannel.name.trim(), type: newChannel.type, company_id: user.company_id, data: getDefaultChannelData(newChannel.type), }; apiClient.infoFlow.setAuthHeader(process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY); await apiClient.infoFlow.create(channelData); toast.success('Канал создан успешно'); setShowAddDialog(false); setNewChannel({ name: '', type: 'telegram', data: {} }); loadChannels(); } catch (error) { console.error('Error creating channel:', error); toast.error('Ошибка создания канала'); } finally { setIsCreating(false); } }; // Get default channel data const getDefaultChannelData = (type: string) => { switch (type) { case 'telegram': return { bot_token: '', webhook_url: '', }; case 'instagram': return { access_token: '', instagram_account_id: '', webhook_url: '', }; case 'web': return { widget_id: `widget_${Date.now()}`, allowed_domains: [], }; default: return {}; } }; // Delete channel const handleDeleteChannel = async (channel: InfoFlow) => { if (!confirm(`Удалить канал "${channel.name}"?`)) return; try { await apiClient.infoFlow.delete(channel.id); toast.success('Канал удален'); loadChannels(); } catch (error) { console.error('Error deleting channel:', error); toast.error('Ошибка удаления канала'); } }; // Connect channel (OAuth flow) const handleConnectChannel = async (channel: InfoFlow) => { try { if (channel.type === 'instagram') { const response = await apiClient.infoFlow.getOAuthLink( channel.id, 'instagram' ); // Open OAuth URL in new window if (response.data.url) { window.open(response.data.url, '_blank'); toast.info('Следуйте инструкциям для подключения Instagram'); } } else if (channel.type === 'telegram') { toast.info('Настройте бота Telegram через @BotFather и добавьте токен'); } else { toast.info('Web канал готов к использованию'); } } catch (error) { console.error('Error connecting channel:', error); toast.error('Ошибка подключения канала'); } }; // Check channel status const getChannelStatus = (channel: InfoFlow) => { // Check if channel has required data if (channel.type === 'telegram' && !channel.data?.bot_token) { return 'not_configured'; } if (channel.type === 'instagram' && !channel.data?.access_token) { return 'not_configured'; } // TODO: Add real status check via API return 'active'; }; // Get status badge const getStatusBadge = (status: string) => { switch (status) { case 'active': return ( <Badge variant='default' className='gap-1'> <CheckCircle className='h-3 w-3' /> Активен </Badge> ); case 'not_configured': return ( <Badge variant='secondary' className='gap-1'> <AlertCircle className='h-3 w-3' /> Не настроен </Badge> ); case 'error': return ( <Badge variant='destructive' className='gap-1'> <XCircle className='h-3 w-3' /> Ошибка </Badge> ); default: return null; } }; return ( <div className='flex h-screen bg-background'> <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-6xl mx-auto space-y-6'> {/* Header */} <div className='flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <div> <h1 className='text-2xl md:text-3xl font-bold'>Каналы</h1> <p className='text-muted-foreground mt-1'> Управление каналами связи с клиентами </p> </div> <Button onClick={() => setShowAddDialog(true)}> <Plus className='h-4 w-4 mr-2' /> Добавить канал </Button> </div> {/* Search */} <div className='relative max-w-md'> <Search className='absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground' /> <Input placeholder='Поиск каналов...' value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className='pl-9' /> </div> {/* Channels Grid */} {isLoading ? ( <div className='grid gap-4 md:grid-cols-2 lg:grid-cols-3'> {[...Array(3)].map((_, i) => ( <Card key={i}> <CardHeader> <Skeleton className='h-6 w-32 mb-2' /> <Skeleton className='h-4 w-24' /> </CardHeader> <CardContent> <Skeleton className='h-4 w-full mb-2' /> <Skeleton className='h-4 w-48' /> </CardContent> </Card> ))} </div> ) : filteredChannels.length === 0 ? ( <Card> <CardContent className='p-12 text-center'> <p className='text-muted-foreground mb-4'> {searchQuery ? 'Каналы не найдены' : 'У вас пока нет каналов'} </p> {!searchQuery && ( <Button onClick={() => setShowAddDialog(true)}> <Plus className='h-4 w-4 mr-2' /> Создать первый канал </Button> )} </CardContent> </Card> ) : ( <div className='grid gap-4 md:grid-cols-2 lg:grid-cols-3'> {filteredChannels.map((channel) => { const status = getChannelStatus(channel); return ( <Card key={channel.id} className='relative overflow-hidden'> <CardHeader className='pb-3'> <div className='flex items-start justify-between'> <div className='flex items-center gap-2'> <span className='text-2xl'> {channelIcons[ channel.type as keyof typeof channelIcons ] || '📡'} </span> <div> <CardTitle className='text-lg'> {channel.name} </CardTitle> <CardDescription> {channelTypeNames[ channel.type as keyof typeof channelTypeNames ] || channel.type} </CardDescription> </div> </div> <DropdownMenu> <DropdownMenuTrigger asChild> <Button variant='ghost' size='icon' className='h-8 w-8' > <MoreVertical className='h-4 w-4' /> </Button> </DropdownMenuTrigger> <DropdownMenuContent align='end'> <DropdownMenuItem onClick={() => setSelectedChannel(channel)} > Настройки </DropdownMenuItem> <DropdownMenuItem onClick={() => handleConnectChannel(channel)} > Подключить </DropdownMenuItem> <DropdownMenuItem onClick={() => handleDeleteChannel(channel)} className='text-destructive' > Удалить </DropdownMenuItem> </DropdownMenuContent> </DropdownMenu> </div> </CardHeader> <CardContent> <div className='space-y-3'> {getStatusBadge(status)} <div className='text-sm text-muted-foreground'> <p>ID: {channel.id}</p> <p> Создан:{' '} {new Date(channel.created_at).toLocaleDateString( 'ru-RU' )} </p> </div> {status === 'not_configured' && ( <Button size='sm' className='w-full' onClick={() => handleConnectChannel(channel)} > Настроить подключение </Button> )} </div> </CardContent> </Card> ); })} </div> )} </div> </main> </div> {/* Add Channel Dialog */} <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}> <DialogContent> <DialogHeader> <DialogTitle>Добавить канал</DialogTitle> <DialogDescription> Создайте новый канал для связи с клиентами </DialogDescription> </DialogHeader> <div className='space-y-4 py-4'> <div className='space-y-2'> <Label htmlFor='channel-name'>Название канала</Label> <Input id='channel-name' placeholder='Например: Основной Telegram' value={newChannel.name} onChange={(e) => setNewChannel({ ...newChannel, name: e.target.value }) } /> </div> <div className='space-y-2'> <Label htmlFor='channel-type'>Тип канала</Label> <Select value={newChannel.type} onValueChange={(value: any) => setNewChannel({ ...newChannel, type: value }) } > <SelectTrigger id='channel-type'> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value='telegram'> <div className='flex items-center gap-2'> <span>{channelIcons.telegram}</span> <span>Telegram</span> </div> </SelectItem> <SelectItem value='instagram'> <div className='flex items-center gap-2'> <span>{channelIcons.instagram}</span> <span>Instagram</span> </div> </SelectItem> <SelectItem value='web'> <div className='flex items-center gap-2'> <span>{channelIcons.web}</span> <span>Web Chat</span> </div> </SelectItem> </SelectContent> </Select> </div> </div> <DialogFooter> <Button variant='outline' onClick={() => setShowAddDialog(false)} disabled={isCreating} > Отмена </Button> <Button onClick={handleCreateChannel} disabled={!newChannel.name.trim() || isCreating} > {isCreating ? ( <> <RefreshCw className='h-4 w-4 mr-2 animate-spin' /> Создание... </> ) : ( 'Создать' )} </Button> </DialogFooter> </DialogContent> </Dialog> </div> ); }
```

# app\chat\page.tsx

```tsx
'use client'; import { useState, useRef, useEffect } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Send, Mic, Paperclip, RotateCcw } from 'lucide-react'; import { useAgentStore } from '@/lib/agent-store'; import { toast } from 'sonner'; interface Message { id: string; sender: 'user' | 'agent'; content: string; timestamp: Date; tokens?: number; cost?: number; } export default function ChatPage() { const { selectedAgent } = useAgentStore(); const [messages, setMessages] = useState<Message[]>([ { id: '1', sender: 'user', content: 'hi!', timestamp: new Date('2025-07-01T12:48:30'), }, { id: '2', sender: 'agent', content: 'Hello! 😊 How can I assist you today?', timestamp: new Date('2025-07-01T12:48:31'), tokens: 11, cost: 18, }, { id: '3', sender: 'user', content: 'test question?', timestamp: new Date('2025-07-01T12:49:42'), }, { id: '4', sender: 'agent', content: "What's your test question? 😊", timestamp: new Date('2025-07-01T12:49:43'), tokens: 9, cost: 40, }, ]); const [newMessage, setNewMessage] = useState(''); const [isLoading, setIsLoading] = useState(false); const messagesEndRef = useRef<HTMLDivElement>(null); const scrollToBottom = () => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }; useEffect(() => { scrollToBottom(); }, [messages]); const handleSendMessage = async () => { if (!newMessage.trim() || isLoading) return; const userMessage: Message = { id: Date.now().toString(), sender: 'user', content: newMessage, timestamp: new Date(), }; setMessages((prev) => [...prev, userMessage]); setNewMessage(''); setIsLoading(true); // Simulate agent response setTimeout(() => { const agentMessage: Message = { id: (Date.now() + 1).toString(), sender: 'agent', content: `I received your message: "${newMessage}". How can I help you further?`, timestamp: new Date(), tokens: Math.floor(Math.random() * 20) + 5, cost: Math.floor(Math.random() * 50) + 10, }; setMessages((prev) => [...prev, agentMessage]); setIsLoading(false); }, 1000); }; const handleRestartDialog = () => { setMessages([]); toast.success('Диалог перезапущен'); }; const formatTime = (date: Date) => { return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', }); }; const formatDate = (date: Date) => { return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', }); }; const totalCost = messages .filter((m) => m.sender === 'agent' && m.cost) .reduce((sum, m) => sum + (m.cost || 0), 0); const totalTokens = messages .filter((m) => m.sender === 'agent' && m.tokens) .reduce((sum, m) => sum + (m.tokens || 0), 0); // Group messages by date const groupedMessages = messages.reduce((groups, message) => { const date = formatDate(message.timestamp); if (!groups[date]) { groups[date] = []; } groups[date].push(message); return groups; }, {} as Record<string, Message[]>); if (!selectedAgent) { return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-4xl mx-auto'> <Card> <CardContent className='p-6 text-center'> <p className='text-muted-foreground'> Выберите агента для начала чата </p> </CardContent> </Card> </div> </main> </div> </div> ); } return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 flex flex-col'> {/* Chat Header */} <div className='border-b p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4'> <div> <h1 className='text-lg md:text-xl font-semibold'> Тестовый чат с агентом </h1> </div> <div className='flex flex-col sm:flex-row items-start sm:items-center gap-4'> <div className='text-right text-xs md:text-sm text-muted-foreground'> <div>Расход BotCoin: {(totalCost * 0.03).toFixed(3)}</div> <div>Входящие токены: {totalTokens}</div> <div>Исходящие: {Math.floor(totalTokens * 1.5)}</div> </div> <Button onClick={handleRestartDialog} className='bg-purple-600 hover:bg-purple-700 text-sm' > <RotateCcw className='mr-2 h-4 w-4' /> РЕСТАРТ ДИАЛОГА </Button> </div> </div> {/* Messages Area */} <div className='flex-1 overflow-auto p-4'> <div className='max-w-4xl mx-auto space-y-6'> {Object.entries(groupedMessages).map(([date, dateMessages]) => ( <div key={date}> {/* Date Separator */} <div className='flex justify-center mb-4'> <div className='bg-muted px-3 py-1 rounded-full text-xs text-muted-foreground'> {date} </div> </div> {/* Messages for this date */} <div className='space-y-4'> {dateMessages.map((message) => ( <div key={message.id} className={`flex ${ message.sender === 'user' ? 'justify-end' : 'justify-start' }`} > <div className={`max-w-[85%] sm:max-w-md rounded-2xl px-4 py-3 ${ message.sender === 'user' ? 'bg-purple-600 text-white ml-4 sm:ml-12' : 'bg-muted text-foreground mr-4 sm:mr-12' }`} > {message.sender === 'agent' && ( <div className='flex items-center gap-2 mb-2'> <Avatar className='h-6 w-6'> <AvatarImage src={ selectedAgent.avatar || '/placeholder.svg' } alt={selectedAgent.name} /> <AvatarFallback> {selectedAgent.name.charAt(0)} </AvatarFallback> </Avatar> <span className='text-sm font-medium'> {selectedAgent.name} </span> </div> )} <div className='text-sm'>{message.content}</div> <div className='flex items-center justify-between mt-2 text-xs opacity-70'> <span> {message.sender === 'agent' && message.tokens && ( <> Ответ из: {message.tokens} токенов | Количество: {message.cost} токенов </> )} </span> <span>{formatTime(message.timestamp)}</span> </div> </div> </div> ))} </div> </div> ))} {isLoading && ( <div className='flex justify-start'> <div className='bg-muted text-foreground max-w-[85%] sm:max-w-md rounded-2xl px-4 py-3 mr-4 sm:mr-12'> <div className='flex items-center gap-2'> <div className='flex space-x-1'> <div className='w-2 h-2 bg-current rounded-full animate-bounce'></div> <div className='w-2 h-2 bg-current rounded-full animate-bounce' style={{ animationDelay: '0.1s' }} ></div> <div className='w-2 h-2 bg-current rounded-full animate-bounce' style={{ animationDelay: '0.2s' }} ></div> </div> <span className='text-sm'>Печатает...</span> </div> </div> </div> )} <div ref={messagesEndRef} /> </div> </div> {/* Message Input */} <div className='border-t p-4'> <div className='max-w-4xl mx-auto'> <div className='flex items-center gap-2'> <div className='flex-1 relative'> <Input value={newMessage} onChange={(e) => setNewMessage(e.target.value)} placeholder='Отправить сообщение...' className='pr-16 sm:pr-20' onKeyPress={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } }} disabled={isLoading} /> <div className='absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1'> <Button variant='ghost' size='icon' className='h-8 w-8'> <Mic className='h-4 w-4' /> </Button> <Button variant='ghost' size='icon' className='h-8 w-8'> <Paperclip className='h-4 w-4' /> </Button> </div> </div> <Button onClick={handleSendMessage} disabled={!newMessage.trim() || isLoading} className='bg-purple-600 hover:bg-purple-700' size='icon' > <Send className='h-4 w-4' /> </Button> </div> </div> </div> </main> </div> </div> ); }
```

# app\dialogs\page.tsx

```tsx
'use client'; import { useState, useEffect, useRef, useCallback } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Badge } from '@/components/ui/badge'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Filter, RefreshCw, Settings, MessageCircle, Send, Mic, Paperclip, ChevronDown, Check, Clock, X, AlertCircle, User, } from 'lucide-react'; import { useAgentStore } from '@/lib/agent-store'; import { apiClient, type Appeal, type Message, type Chat, } from '@/lib/api/client'; import { useAuth } from '@/contexts/auth-context'; import { toast } from 'sonner'; import { tokenManager } from '@/lib/auth/token-manager'; import { getWebSocketUrl } from '@/lib/api/config'; interface ExtendedAppeal extends Appeal { lastMessage?: string; lastMessageTime?: string; unreadCount?: number; clientName?: string; clientAvatar?: string; } interface WSMessage { type: string; data: any; } const statusConfig: any = { new: { label: 'Новый', color: 'bg-blue-500', icon: AlertCircle }, in_work: { label: 'В работе', color: 'bg-yellow-500', icon: Clock }, on_pause: { label: 'На паузе', color: 'bg-gray-500', icon: Clock }, closed: { label: 'Закрыт', color: 'bg-green-500', icon: Check }, }; export default function DialogsPage() { const { user } = useAuth(); const { selectedAgent } = useAgentStore(); const [appeals, setAppeals] = useState<ExtendedAppeal[]>([]); const [selectedAppeal, setSelectedAppeal] = useState<ExtendedAppeal | null>( null ); const [messages, setMessages] = useState<Message[]>([]); const [newMessage, setNewMessage] = useState(''); const [isLoading, setIsLoading] = useState(true); const [isLoadingMessages, setIsLoadingMessages] = useState(false); const [isSending, setIsSending] = useState(false); const [filters, setFilters] = useState({ status: 'all', search: '', }); const [showFilterDialog, setShowFilterDialog] = useState(false); const messagesEndRef = useRef<HTMLDivElement>(null); const wsRef = useRef<WebSocket | null>(null); const [isConnected, setIsConnected] = useState(false); // WebSocket connection const connectWebSocket = useCallback(() => { if (!user || wsRef.current?.readyState === WebSocket.OPEN) return; const token = tokenManager.getAccessToken(); if (!token) return; const wsUrl = getWebSocketUrl('/api/v1/ws/crm/', token); try { const ws = new WebSocket(wsUrl); wsRef.current = ws; ws.onopen = () => { console.log('WebSocket connected'); setIsConnected(true); if (user.company_id) { ws.send( JSON.stringify({ type: 'subscribe', data: { company_id: user.company_id, event_types: ['new_appeal', 'appeal_update', 'new_message'], }, }) ); } }; ws.onmessage = (event) => { try { const message: WSMessage = JSON.parse(event.data); handleWebSocketMessage(message); } catch (error) { console.error('Failed to parse WebSocket message:', error); } }; ws.onerror = (error) => { console.error('WebSocket error:', error); setIsConnected(false); }; ws.onclose = () => { console.log('WebSocket disconnected'); setIsConnected(false); wsRef.current = null; setTimeout(() => { connectWebSocket(); }, 3000); }; } catch (error) { console.error('Failed to connect WebSocket:', error); setIsConnected(false); } }, [user]); const handleWebSocketMessage = (message: WSMessage) => { switch (message.type) { case 'new_appeal': loadAppeals(); break; case 'appeal_update': setAppeals((prev) => prev.map((appeal) => appeal.id === message.data.id ? { ...appeal, ...message.data } : appeal ) ); if (selectedAppeal?.id === message.data.id) { setSelectedAppeal((prev) => prev ? { ...prev, ...message.data } : null ); } break; case 'new_message': if (selectedAppeal?.id === message.data.appeal_id) { setMessages((prev) => [...prev, message.data]); scrollToBottom(); } // Update last message in appeals list setAppeals((prev) => prev.map((appeal) => { if (appeal.id === message.data.appeal_id) { return { ...appeal, lastMessage: message.data.text, lastMessageTime: message.data.created_at, unreadCount: appeal.id === selectedAppeal?.id ? 0 : (appeal.unreadCount || 0) + 1, }; } return appeal; }) ); break; } }; useEffect(() => { connectWebSocket(); return () => { if (wsRef.current) { wsRef.current.close(); } }; }, [connectWebSocket]); useEffect(() => { if (user?.company_id) { loadAppeals(); } }, [user, filters]); const loadAppeals = async () => { if (!user?.company_id) return; setIsLoading(true); try { const params: any = { company_id: user.company_id, limit: 100, offset: 0, }; if (filters.status !== 'all') { params.status = filters.status; } const response = await apiClient.appeal.list(params); const appealsList = response.data.results; // Enrich appeals with additional data const enrichedAppeals: ExtendedAppeal[] = await Promise.all( appealsList.map(async (appeal) => { try { // Get chat info to extract client data const chatResponse = await apiClient.backend.get( `/api/v1/chat/${appeal.chat_id}` ); const chat = chatResponse.data; // Get last message const messagesResponse = await apiClient.chat.getMessages( appeal.id, { limit: 1, offset: 0, } ); const lastMsg = messagesResponse.data.results[0]; return { ...appeal, clientName: chat.meta?.name || 'Клиент', clientAvatar: chat.meta?.avatar, lastMessage: lastMsg?.text || 'Нет сообщений', lastMessageTime: lastMsg?.created_at || appeal.created_at, unreadCount: 0, }; } catch (error) { console.error(`Failed to enrich appeal ${appeal.id}:`, error); return { ...appeal, clientName: 'Клиент', lastMessage: 'Нет сообщений', lastMessageTime: appeal.created_at, unreadCount: 0, }; } }) ); // Filter by search const filtered = filters.search ? enrichedAppeals.filter( (appeal) => appeal.clientName ?.toLowerCase() .includes(filters.search.toLowerCase()) || appeal.lastMessage ?.toLowerCase() .includes(filters.search.toLowerCase()) ) : enrichedAppeals; // Sort by last message time filtered.sort( (a, b) => new Date(b.lastMessageTime || 0).getTime() - new Date(a.lastMessageTime || 0).getTime() ); setAppeals(filtered); // Select first appeal if none selected if (!selectedAppeal && filtered.length > 0) { handleSelectAppeal(filtered[0]); } } catch (error) { console.error('Failed to load appeals:', error); toast.error('Ошибка загрузки диалогов'); } finally { setIsLoading(false); } }; const handleSelectAppeal = async (appeal: ExtendedAppeal) => { setSelectedAppeal(appeal); setIsLoadingMessages(true); try { const response = await apiClient.chat.getMessages(appeal.id, { limit: 100, offset: 0, }); setMessages(response.data.results.reverse()); // Mark as read if (appeal.unreadCount && appeal.unreadCount > 0) { setAppeals((prev) => prev.map((a) => (a.id === appeal.id ? { ...a, unreadCount: 0 } : a)) ); } scrollToBottom(); } catch (error) { console.error('Failed to load messages:', error); toast.error('Ошибка загрузки сообщений'); } finally { setIsLoadingMessages(false); } }; const handleSendMessage = async () => { if (!newMessage.trim() || !selectedAppeal || isSending) return; const messageText = newMessage.trim(); setNewMessage(''); setIsSending(true); try { const response = await apiClient.chat.sendMessage({ appeal_id: selectedAppeal.id, text: messageText, type: 'text', }); setMessages((prev) => [...prev, response.data]); // Update last message in appeals list setAppeals((prev) => prev.map((appeal) => appeal.id === selectedAppeal.id ? { ...appeal, lastMessage: messageText, lastMessageTime: response.data.created_at, } : appeal ) ); scrollToBottom(); } catch (error) { console.error('Failed to send message:', error); toast.error('Ошибка отправки сообщения'); setNewMessage(messageText); } finally { setIsSending(false); } }; const handleStatusChange = async (appealId: number, newStatus: string) => { try { await apiClient.appeal.update(appealId, { status: newStatus }); setAppeals((prev) => prev.map((appeal) => appeal.id === appealId ? { ...appeal, status: newStatus } : appeal ) ); if (selectedAppeal?.id === appealId) { setSelectedAppeal((prev) => prev ? { ...prev, status: newStatus } : null ); } toast.success('Статус обновлен'); } catch (error) { console.error('Failed to update status:', error); toast.error('Ошибка обновления статуса'); } }; const scrollToBottom = () => { setTimeout(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, 100); }; const formatTime = (dateString?: string) => { if (!dateString) return ''; const date = new Date(dateString); const now = new Date(); const diff = now.getTime() - date.getTime(); const days = Math.floor(diff / (1000 * 60 * 60 * 24)); if (days === 0) { return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', }); } else if (days === 1) { return 'Вчера'; } else if (days < 7) { return `${days} дн. назад`; } else { return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short', }); } }; const handleKeyPress = (e: React.KeyboardEvent) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } }; const getFilteredCount = () => { if (filters.status === 'all') return appeals.length; return appeals.filter((a) => a.status === filters.status).length; }; return ( <div className='flex h-screen bg-background'> <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 flex overflow-hidden'> {/* Left Panel - Dialog List */} <div className='w-full md:w-80 border-r bg-background flex flex-col'> {/* Filters */} <div className='p-4 md:p-5 border-b space-y-3'> <div className='flex gap-2'> <Button className='bg-purple-600 hover:bg-purple-700 text-white flex-1' onClick={() => setShowFilterDialog(true)} > <Filter className='mr-2 h-4 w-4' /> ФИЛЬТРЫ <ChevronDown className='ml-2 h-4 w-4' /> </Button> <Button variant='outline' size='icon' onClick={loadAppeals} disabled={isLoading} > <RefreshCw className={`h-4 w-4 ${isLoading ? 'animate-spin' : ''}`} /> </Button> </div> <Input placeholder='Поиск по диалогам...' value={filters.search} onChange={(e) => setFilters((prev) => ({ ...prev, search: e.target.value })) } className='w-full' /> </div> {/* Dialog Count */} <div className='px-4 md:px-5 py-3 text-sm text-muted-foreground border-b'> Показано: {getFilteredCount()} из {appeals.length} диалогов </div> {/* Dialog List */} <div className='flex-1 overflow-auto'> {isLoading ? ( <div className='flex items-center justify-center h-32'> <div className='animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600'></div> </div> ) : appeals.length === 0 ? ( <div className='text-center py-8 px-4'> <MessageCircle className='h-12 w-12 mx-auto text-muted-foreground mb-2' /> <p className='text-muted-foreground'>Нет диалогов</p> </div> ) : ( appeals.map((appeal) => { const status = statusConfig[appeal.status] || statusConfig.new; return ( <div key={appeal.id} className={`p-4 md:p-5 border-b cursor-pointer transition-colors ${ selectedAppeal?.id === appeal.id ? 'bg-purple-50 dark:bg-purple-950' : 'hover:bg-muted/50' }`} onClick={() => handleSelectAppeal(appeal)} > <div className='flex items-start gap-3'> <Avatar className='h-10 w-10 flex-shrink-0'> <AvatarImage src={appeal.clientAvatar} /> <AvatarFallback> <User className='h-5 w-5' /> </AvatarFallback> </Avatar> <div className='flex-1 min-w-0'> <div className='flex items-center justify-between mb-1'> <h4 className='font-medium truncate'> {appeal.clientName} </h4> <span className='text-xs text-muted-foreground flex-shrink-0'> {formatTime(appeal.lastMessageTime)} </span> </div> <p className='text-sm text-muted-foreground truncate mb-2'> {appeal.lastMessage} </p> <div className='flex items-center justify-between'> <Badge variant='secondary' className={`text-xs ${status.color} text-white`} > <status.icon className='h-3 w-3 mr-1' /> {status.label} </Badge> {appeal.unreadCount ? ( <Badge className='bg-purple-600 text-white text-xs'> {appeal.unreadCount} </Badge> ) : null} </div> </div> </div> </div> ); }) )} </div> </div> {/* Right Panel - Messages */} <div className='flex-1 flex flex-col bg-background'> {selectedAppeal ? ( <> {/* Chat Header */} <div className='border-b px-4 py-3 flex items-center justify-between'> <div className='flex items-center gap-3'> <Avatar className='h-10 w-10'> <AvatarImage src={selectedAppeal.clientAvatar} /> <AvatarFallback> <User className='h-5 w-5' /> </AvatarFallback> </Avatar> <div> <h3 className='font-semibold'> {selectedAppeal.clientName} </h3> <p className='text-xs text-muted-foreground'> ID: #{selectedAppeal.id} </p> </div> </div> <div className='flex items-center gap-2'> <Select value={selectedAppeal.status} onValueChange={(value) => handleStatusChange(selectedAppeal.id, value) } > <SelectTrigger className='w-[140px]'> <SelectValue /> </SelectTrigger> <SelectContent> {Object.entries(statusConfig).map(([value, config]) => { const typedConfig = config as { label: string; color: string; icon: React.ElementType; }; return ( <SelectItem key={value} value={value}> <div className='flex items-center'> <typedConfig.icon className='h-4 w-4 mr-2' /> {typedConfig.label} </div> </SelectItem> ); })} </SelectContent> </Select> <Button variant='ghost' size='icon'> <Settings className='h-4 w-4' /> </Button> </div> </div> {/* Messages Area */} <div className='flex-1 overflow-y-auto p-4'> {isLoadingMessages ? ( <div className='flex items-center justify-center h-full'> <div className='animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600'></div> </div> ) : messages.length === 0 ? ( <div className='text-center text-muted-foreground'> Нет сообщений </div> ) : ( <div className='space-y-4'> {messages.map((message) => { const isUser = message.sender.type === 'user'; const isBot = message.sender.type === 'bot'; return ( <div key={message.id} className={`flex gap-3 ${ isUser ? 'justify-end' : '' }`} > {!isUser && ( <Avatar className='h-8 w-8 flex-shrink-0'> <AvatarImage src={ isBot ? selectedAgent?.avatar || '/avatars/bot1.png' : message.sender.avatar } /> <AvatarFallback> {message.sender.name?.[0] || (isBot ? 'B' : 'U')} </AvatarFallback> </Avatar> )} <div className={`max-w-[70%] ${ isUser ? 'order-1' : 'order-2' }`} > <div className={`rounded-2xl px-4 py-2 ${ isUser ? 'bg-purple-600 text-white' : isBot ? 'bg-blue-100 dark:bg-blue-900' : 'bg-muted' }`} > <p className='text-sm whitespace-pre-wrap break-words'> {message.text} </p> </div> <div className='flex items-center gap-2 mt-1'> <p className={`text-xs text-muted-foreground ${ isUser ? 'text-right' : '' }`} > {formatTime(message.created_at)} </p> {message.sender.name && ( <p className='text-xs text-muted-foreground'> • {message.sender.name} </p> )} </div> </div> {isUser && ( <Avatar className='h-8 w-8 flex-shrink-0 order-2'> <AvatarImage src={selectedAppeal.clientAvatar} /> <AvatarFallback> <User className='h-4 w-4' /> </AvatarFallback> </Avatar> )} </div> ); })} <div ref={messagesEndRef} /> </div> )} </div> {/* Input Area */} <div className='border-t p-4'> <div className='flex items-end gap-2'> <div className='flex-1'> <div className='relative'> <Input value={newMessage} onChange={(e) => setNewMessage(e.target.value)} onKeyPress={handleKeyPress} placeholder='Введите сообщение...' className='pr-20' disabled={ isSending || selectedAppeal.status === 'closed' } /> <div className='absolute right-2 bottom-2 flex gap-1'> <Button variant='ghost' size='icon' className='h-6 w-6' > <Mic className='h-4 w-4' /> </Button> <Button variant='ghost' size='icon' className='h-6 w-6' > <Paperclip className='h-4 w-4' /> </Button> </div> </div> </div> <Button onClick={handleSendMessage} disabled={ !newMessage.trim() || isSending || selectedAppeal.status === 'closed' } className='bg-purple-600 hover:bg-purple-700' size='icon' > <Send className='h-4 w-4' /> </Button> </div> {selectedAppeal.status === 'closed' && ( <p className='text-xs text-muted-foreground mt-2'> Диалог закрыт. Откройте его для отправки сообщений. </p> )} </div> </> ) : ( <div className='flex-1 flex items-center justify-center text-muted-foreground'> <div className='text-center'> <MessageCircle className='h-12 w-12 mx-auto mb-4' /> <p>Выберите диалог для просмотра сообщений</p> </div> </div> )} </div> </main> </div> {/* Filter Dialog */} <Dialog open={showFilterDialog} onOpenChange={setShowFilterDialog}> <DialogContent> <DialogHeader> <DialogTitle>Фильтры диалогов</DialogTitle> <DialogDescription> Настройте параметры отображения диалогов </DialogDescription> </DialogHeader> <div className='space-y-4'> <div className='space-y-2'> <label className='text-sm font-medium'>Статус</label> <Select value={filters.status} onValueChange={(value) => setFilters((prev) => ({ ...prev, status: value })) } > <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value='all'>Все статусы</SelectItem> {Object.entries(statusConfig).map(([value, config]) => { const typedConfig = config as { label: string; color: string; icon: React.ElementType; }; return ( <SelectItem key={value} value={value}> <div className='flex items-center'> <typedConfig.icon className='h-4 w-4 mr-2' /> {typedConfig.label} </div> </SelectItem> ); })} </SelectContent> </Select> </div> </div> <DialogFooter> <Button variant='outline' onClick={() => { setFilters({ status: 'all', search: '' }); setShowFilterDialog(false); }} > Сбросить </Button> <Button onClick={() => setShowFilterDialog(false)} className='bg-purple-600 hover:bg-purple-700' > Применить </Button> </DialogFooter> </DialogContent> </Dialog> </div> ); }
```

# app\favicon.ico

This is a binary file of the type: Binary

# app\functions\page.tsx

```tsx
'use client'; import { useState } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Textarea } from '@/components/ui/textarea'; import { Switch } from '@/components/ui/switch'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Badge } from '@/components/ui/badge'; import { Alert, AlertDescription } from '@/components/ui/alert'; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow, } from '@/components/ui/table'; import { Plus, Settings, Trash2, Edit, AlertTriangle, Info, ChevronLeft, ChevronRight, } from 'lucide-react'; import { toast } from 'sonner'; import Link from 'next/link'; interface FunctionParameter { name: string; type: string; description: string; required: boolean; validation?: string; } interface CustomFunction { id: string; name: string; description: string; parameters: FunctionParameter[]; enabled: boolean; createdAt: string; } export default function FunctionsPage() { const [functions, setFunctions] = useState<CustomFunction[]>([]); const [showCreateDialog, setShowCreateDialog] = useState(false); const [showEditDialog, setShowEditDialog] = useState(false); const [editingFunction, setEditingFunction] = useState<CustomFunction | null>( null ); const [currentPage, setCurrentPage] = useState(1); const itemsPerPage = 10; // Form state const [functionName, setFunctionName] = useState(''); const [functionDescription, setFunctionDescription] = useState(''); const [parameters, setParameters] = useState<FunctionParameter[]>([ { name: '', type: 'string', description: '', required: false }, ]); const handleCreateFunction = () => { if (!functionName.trim() || !functionDescription.trim()) { toast.error('Заполните все обязательные поля'); return; } const newFunction: CustomFunction = { id: Date.now().toString(), name: functionName, description: functionDescription, parameters: parameters.filter((p) => p.name.trim() !== ''), enabled: true, createdAt: new Date().toISOString(), }; setFunctions([...functions, newFunction]); setShowCreateDialog(false); resetForm(); toast.success('Функция успешно создана'); }; const handleEditFunction = () => { if ( !editingFunction || !functionName.trim() || !functionDescription.trim() ) { toast.error('Заполните все обязательные поля'); return; } const updatedFunction: CustomFunction = { ...editingFunction, name: functionName, description: functionDescription, parameters: parameters.filter((p) => p.name.trim() !== ''), }; setFunctions( functions.map((f) => (f.id === editingFunction.id ? updatedFunction : f)) ); setShowEditDialog(false); setEditingFunction(null); resetForm(); toast.success('Функция успешно обновлена'); }; const handleDeleteFunction = (id: string) => { setFunctions(functions.filter((f) => f.id !== id)); toast.success('Функция удалена'); }; const handleToggleFunction = (id: string) => { setFunctions( functions.map((f) => (f.id === id ? { ...f, enabled: !f.enabled } : f)) ); }; const resetForm = () => { setFunctionName(''); setFunctionDescription(''); setParameters([ { name: '', type: 'string', description: '', required: false }, ]); }; const addParameter = () => { setParameters([ ...parameters, { name: '', type: 'string', description: '', required: false }, ]); }; const removeParameter = (index: number) => { if (parameters.length > 1) { setParameters(parameters.filter((_, i) => i !== index)); } }; const updateParameter = ( index: number, field: keyof FunctionParameter, value: string | boolean ) => { const updated = [...parameters]; updated[index] = { ...updated[index], [field]: value }; setParameters(updated); }; const openEditDialog = (func: CustomFunction) => { setEditingFunction(func); setFunctionName(func.name); setFunctionDescription(func.description); setParameters( func.parameters.length > 0 ? func.parameters : [{ name: '', type: 'string', description: '', required: false }] ); setShowEditDialog(true); }; const renderParameterForm = () => ( <div className='space-y-4'> <div className='flex items-center justify-between'> <Label className='text-base font-medium'>Параметры функции</Label> <Button type='button' variant='outline' size='sm' onClick={addParameter} > <Plus className='h-4 w-4 mr-2' /> Добавить параметр </Button> </div> {parameters.map((param, index) => ( <Card key={index} className='p-4'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='space-y-2'> <Label htmlFor={`param-name-${index}`}> Название параметра * {!param.name.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Input id={`param-name-${index}`} value={param.name} onChange={(e) => updateParameter(index, 'name', e.target.value)} placeholder='Введите название параметра' className={!param.name.trim() ? 'border-red-500' : ''} /> </div> <div className='space-y-2'> <Label htmlFor={`param-type-${index}`}>Тип данных</Label> <Select value={param.type} onValueChange={(value) => updateParameter(index, 'type', value)} > <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value='string'>Строка</SelectItem> <SelectItem value='number'>Число</SelectItem> <SelectItem value='boolean'>Логический</SelectItem> <SelectItem value='array'>Массив</SelectItem> <SelectItem value='object'>Объект</SelectItem> </SelectContent> </Select> </div> <div className='space-y-2 md:col-span-2'> <Label htmlFor={`param-desc-${index}`}> Описание параметра * {!param.description.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Textarea id={`param-desc-${index}`} value={param.description} onChange={(e) => updateParameter(index, 'description', e.target.value) } placeholder='Опишите назначение параметра' className={!param.description.trim() ? 'border-red-500' : ''} rows={2} /> </div> <div className='flex items-center justify-between md:col-span-2'> <div className='flex items-center space-x-2'> <Switch id={`param-required-${index}`} checked={param.required} onCheckedChange={(checked) => updateParameter(index, 'required', checked) } /> <Label htmlFor={`param-required-${index}`}> Обязательный параметр </Label> </div> {parameters.length > 1 && ( <Button type='button' variant='destructive' size='sm' onClick={() => removeParameter(index)} > <Trash2 className='h-4 w-4' /> </Button> )} </div> </div> </Card> ))} </div> ); const paginatedFunctions = functions.slice( (currentPage - 1) * itemsPerPage, currentPage * itemsPerPage ); return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 overflow-auto'> <div className='p-4 md:p-6'> <div className='max-w-7xl mx-auto space-y-4 md:space-y-6'> {/* Premium Warning */} <Alert className='bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-600'> <AlertTriangle className='h-4 w-4 text-amber-600' /> <AlertDescription className='text-amber-800 dark:text-amber-200'> <strong>Премиум-функции</strong> <br /> Для доступа к этой функции необходим тариф Премиум. Для получения доступа купите{' '} <Link href='/account?tab=subscription' className='text-purple-600 hover:text-purple-700 underline' > соответствующую подписку </Link> . </AlertDescription> </Alert> {/* Header */} <div className='flex flex-col sm:flex-row sm:items-center justify-between gap-4'> <div> <h1 className='text-2xl md:text-3xl font-bold'>Функции</h1> <p className='text-muted-foreground text-sm md:text-base'> Создавайте пользовательские функции для расширения возможностей ваших агентов </p> </div> <Button onClick={() => setShowCreateDialog(true)} className='bg-purple-600 hover:bg-purple-700 w-full sm:w-auto' > <Plus className='mr-2 h-4 w-4' /> СОЗДАТЬ ФУНКЦИЮ </Button> </div> {/* Functions Table */} <Card> <CardHeader> <CardTitle className='text-lg'>Список функций</CardTitle> </CardHeader> <CardContent> {functions.length === 0 ? ( <div className='text-center py-8 text-muted-foreground'> <Settings className='h-12 w-12 mx-auto mb-4 opacity-50' /> <p>Функции не созданы</p> <p className='text-sm mt-2'> Создайте первую функцию для расширения возможностей агентов </p> </div> ) : ( <div className='space-y-4'> {/* Desktop Table */} <div className='hidden md:block'> <Table> <TableHeader> <TableRow> <TableHead>Название</TableHead> <TableHead>Описание</TableHead> <TableHead>Параметры</TableHead> <TableHead>Статус</TableHead> <TableHead>Создано</TableHead> <TableHead className='text-right'> Действия </TableHead> </TableRow> </TableHeader> <TableBody> {paginatedFunctions.map((func) => ( <TableRow key={func.id}> <TableCell className='font-medium'> {func.name} </TableCell> <TableCell className='max-w-xs truncate'> {func.description} </TableCell> <TableCell> <Badge variant='secondary'> {func.parameters.length} параметр(ов) </Badge> </TableCell> <TableCell> <div className='flex items-center gap-2'> <Switch checked={func.enabled} onCheckedChange={() => handleToggleFunction(func.id) } /> <span className='text-sm'> {func.enabled ? 'Включена' : 'Отключена'} </span> </div> </TableCell> <TableCell className='text-sm text-muted-foreground'> {new Date( func.createdAt ).toLocaleDateString()} </TableCell> <TableCell className='text-right'> <div className='flex items-center gap-2 justify-end'> <Button variant='outline' size='sm' onClick={() => openEditDialog(func)} > <Edit className='h-4 w-4' /> </Button> <Button variant='destructive' size='sm' onClick={() => handleDeleteFunction(func.id) } > <Trash2 className='h-4 w-4' /> </Button> </div> </TableCell> </TableRow> ))} </TableBody> </Table> </div> {/* Mobile Cards */} <div className='md:hidden space-y-4'> {paginatedFunctions.map((func) => ( <Card key={func.id}> <CardContent className='p-4 space-y-3'> <div className='flex items-start justify-between'> <div> <h3 className='font-medium'>{func.name}</h3> <p className='text-sm text-muted-foreground mt-1'> {func.description} </p> </div> <div className='flex items-center gap-2'> <Switch checked={func.enabled} onCheckedChange={() => handleToggleFunction(func.id) } /> </div> </div> <div className='flex items-center gap-4 text-sm text-muted-foreground'> <Badge variant='secondary'> {func.parameters.length} параметр(ов) </Badge> <span> {new Date( func.createdAt ).toLocaleDateString()} </span> </div> <div className='flex gap-2 pt-2'> <Button variant='outline' size='sm' onClick={() => openEditDialog(func)} className='flex-1' > <Edit className='h-4 w-4 mr-2' /> Редактировать </Button> <Button variant='destructive' size='sm' onClick={() => handleDeleteFunction(func.id)} className='flex-1' > <Trash2 className='h-4 w-4 mr-2' /> Удалить </Button> </div> </CardContent> </Card> ))} </div> {/* Pagination */} {functions.length > itemsPerPage && ( <div className='flex flex-col sm:flex-row items-center justify-between gap-4 mt-6'> <div className='text-sm text-muted-foreground'> Показано{' '} {Math.min( (currentPage - 1) * itemsPerPage + 1, functions.length )}{' '} -{' '} {Math.min( currentPage * itemsPerPage, functions.length )}{' '} из {functions.length} функций </div> <div className='flex items-center gap-2'> <Button variant='outline' size='sm' onClick={() => setCurrentPage(Math.max(1, currentPage - 1)) } disabled={currentPage === 1} > <ChevronLeft className='h-4 w-4' /> Предыдущая </Button> <span className='text-sm'> Страница {currentPage} из{' '} {Math.ceil(functions.length / itemsPerPage)} </span> <Button variant='outline' size='sm' onClick={() => setCurrentPage( Math.min( Math.ceil(functions.length / itemsPerPage), currentPage + 1 ) ) } disabled={ currentPage >= Math.ceil(functions.length / itemsPerPage) } > Следующая <ChevronRight className='h-4 w-4' /> </Button> </div> </div> )} </div> )} </CardContent> </Card> </div> </div> </main> </div> {/* Create Function Dialog */} <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}> <DialogContent className='max-w-4xl max-h-[90vh] overflow-y-auto mx-4'> <DialogHeader> <DialogTitle>Создать новую функцию</DialogTitle> <DialogDescription> Создайте пользовательскую функцию для расширения возможностей ваших агентов </DialogDescription> </DialogHeader> <div className='space-y-6'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='space-y-2'> <Label htmlFor='function-name'> Название функции * {!functionName.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Input id='function-name' value={functionName} onChange={(e) => setFunctionName(e.target.value)} placeholder='Введите название функции' className={!functionName.trim() ? 'border-red-500' : ''} /> </div> </div> <div className='space-y-2'> <Label htmlFor='function-description'> Описание функции * {!functionDescription.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Textarea id='function-description' value={functionDescription} onChange={(e) => setFunctionDescription(e.target.value)} placeholder='Опишите назначение и работу функции' className={!functionDescription.trim() ? 'border-red-500' : ''} rows={3} /> </div> {renderParameterForm()} <Alert className='bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-600'> <Info className='h-4 w-4 text-blue-600' /> <AlertDescription className='text-blue-800 dark:text-blue-200'> <strong>Совет:</strong> Четко опишите назначение функции и каждого параметра. Это поможет агенту правильно использовать функцию в диалогах. </AlertDescription> </Alert> </div> <DialogFooter className='flex flex-col sm:flex-row gap-2'> <Button variant='outline' onClick={() => { setShowCreateDialog(false); resetForm(); }} > Отмена </Button> <Button onClick={handleCreateFunction} className='bg-purple-600 hover:bg-purple-700' > Создать функцию </Button> </DialogFooter> </DialogContent> </Dialog> {/* Edit Function Dialog */} <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}> <DialogContent className='max-w-4xl max-h-[90vh] overflow-y-auto mx-4'> <DialogHeader> <DialogTitle>Редактировать функцию</DialogTitle> <DialogDescription> Внесите изменения в существующую функцию </DialogDescription> </DialogHeader> <div className='space-y-6'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='space-y-2'> <Label htmlFor='edit-function-name'> Название функции * {!functionName.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Input id='edit-function-name' value={functionName} onChange={(e) => setFunctionName(e.target.value)} placeholder='Введите название функции' className={!functionName.trim() ? 'border-red-500' : ''} /> </div> </div> <div className='space-y-2'> <Label htmlFor='edit-function-description'> Описание функции * {!functionDescription.trim() && ( <span className='text-red-500 ml-1'>⚠</span> )} </Label> <Textarea id='edit-function-description' value={functionDescription} onChange={(e) => setFunctionDescription(e.target.value)} placeholder='Опишите назначение и работу функции' className={!functionDescription.trim() ? 'border-red-500' : ''} rows={3} /> </div> {renderParameterForm()} </div> <DialogFooter className='flex flex-col sm:flex-row gap-2'> <Button variant='outline' onClick={() => { setShowEditDialog(false); setEditingFunction(null); resetForm(); }} > Отмена </Button> <Button onClick={handleEditFunction} className='bg-purple-600 hover:bg-purple-700' > Сохранить изменения </Button> </DialogFooter> </DialogContent> </Dialog> </div> ); }
```

# app\globals.css

```css
@import "tailwindcss"; @import "tw-animate-css"; @custom-variant dark (&:is(.dark *)); @theme inline { --color-background: var(--background); --color-foreground: var(--foreground); --font-sans: var(--font-geist-sans); --font-mono: var(--font-geist-mono); --color-sidebar-ring: var(--sidebar-ring); --color-sidebar-border: var(--sidebar-border); --color-sidebar-accent-foreground: var(--sidebar-accent-foreground); --color-sidebar-accent: var(--sidebar-accent); --color-sidebar-primary-foreground: var(--sidebar-primary-foreground); --color-sidebar-primary: var(--sidebar-primary); --color-sidebar-foreground: var(--sidebar-foreground); --color-sidebar: var(--sidebar); --color-chart-5: var(--chart-5); --color-chart-4: var(--chart-4); --color-chart-3: var(--chart-3); --color-chart-2: var(--chart-2); --color-chart-1: var(--chart-1); --color-ring: var(--ring); --color-input: var(--input); --color-border: var(--border); --color-destructive: var(--destructive); --color-accent-foreground: var(--accent-foreground); --color-accent: var(--accent); --color-muted-foreground: var(--muted-foreground); --color-muted: var(--muted); --color-secondary-foreground: var(--secondary-foreground); --color-secondary: var(--secondary); --color-primary-foreground: var(--primary-foreground); --color-primary: var(--primary); --color-popover-foreground: var(--popover-foreground); --color-popover: var(--popover); --color-card-foreground: var(--card-foreground); --color-card: var(--card); --radius-sm: calc(var(--radius) - 4px); --radius-md: calc(var(--radius) - 2px); --radius-lg: var(--radius); --radius-xl: calc(var(--radius) + 4px); } :root { --radius: 0.625rem; --background: oklch(1 0 0); --foreground: oklch(0.145 0 0); --card: oklch(1 0 0); --card-foreground: oklch(0.145 0 0); --popover: oklch(1 0 0); --popover-foreground: oklch(0.145 0 0); --primary: oklch(0.205 0 0); --primary-foreground: oklch(0.985 0 0); --secondary: oklch(0.97 0 0); --secondary-foreground: oklch(0.205 0 0); --muted: oklch(0.97 0 0); --muted-foreground: oklch(0.556 0 0); --accent: oklch(0.97 0 0); --accent-foreground: oklch(0.205 0 0); --destructive: oklch(0.577 0.245 27.325); --border: oklch(0.922 0 0); --input: oklch(0.922 0 0); --ring: oklch(0.708 0 0); --chart-1: oklch(0.646 0.222 41.116); --chart-2: oklch(0.6 0.118 184.704); --chart-3: oklch(0.398 0.07 227.392); --chart-4: oklch(0.828 0.189 84.429); --chart-5: oklch(0.769 0.188 70.08); --sidebar: oklch(0.985 0 0); --sidebar-foreground: oklch(0.145 0 0); --sidebar-primary: oklch(0.205 0 0); --sidebar-primary-foreground: oklch(0.985 0 0); --sidebar-accent: oklch(0.97 0 0); --sidebar-accent-foreground: oklch(0.205 0 0); --sidebar-border: oklch(0.922 0 0); --sidebar-ring: oklch(0.708 0 0); } .dark { --background: oklch(0.145 0 0); --foreground: oklch(0.985 0 0); --card: oklch(0.205 0 0); --card-foreground: oklch(0.985 0 0); --popover: oklch(0.205 0 0); --popover-foreground: oklch(0.985 0 0); --primary: oklch(0.922 0 0); --primary-foreground: oklch(0.205 0 0); --secondary: oklch(0.269 0 0); --secondary-foreground: oklch(0.985 0 0); --muted: oklch(0.269 0 0); --muted-foreground: oklch(0.708 0 0); --accent: oklch(0.269 0 0); --accent-foreground: oklch(0.985 0 0); --destructive: oklch(0.704 0.191 22.216); --border: oklch(1 0 0 / 10%); --input: oklch(1 0 0 / 15%); --ring: oklch(0.556 0 0); --chart-1: oklch(0.488 0.243 264.376); --chart-2: oklch(0.696 0.17 162.48); --chart-3: oklch(0.769 0.188 70.08); --chart-4: oklch(0.627 0.265 303.9); --chart-5: oklch(0.645 0.246 16.439); --sidebar: oklch(0.205 0 0); --sidebar-foreground: oklch(0.985 0 0); --sidebar-primary: oklch(0.488 0.243 264.376); --sidebar-primary-foreground: oklch(0.985 0 0); --sidebar-accent: oklch(0.269 0 0); --sidebar-accent-foreground: oklch(0.985 0 0); --sidebar-border: oklch(1 0 0 / 10%); --sidebar-ring: oklch(0.556 0 0); } @layer base { * { @apply border-border outline-ring/50; } body { @apply bg-background text-foreground; } }
```

# app\integrations\page.tsx

```tsx
'use client'; import type React from 'react'; import { useState } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Badge } from '@/components/ui/badge'; import { Alert, AlertDescription } from '@/components/ui/alert'; import { AlertTriangle, Calendar, Database, Users, Plane, Volume2, FileText, BarChart3, Briefcase, ExternalLink, CheckCircle, XCircle, } from 'lucide-react'; import { toast } from 'sonner'; interface Integration { id: string; name: string; icon: React.ReactNode; badge?: 'Premium' | 'Beta'; description: string[]; status: 'connected' | 'disconnected' | 'premium-required'; category: string; } const integrations: Integration[] = [ { id: 'bitrix', name: 'Bitrix', icon: <Database className='h-6 w-6' />, badge: 'Premium', description: [ 'Передача диалогов агента в CRM', 'Подключение чатботов в открытые линии', 'Использование данных клиентов для помощи в продажах', 'Автоматизация работы со сделками и лидами (создание, заполнение, перемещение)', 'Передача данных клиентов из CRM для персонализированных ответов', ], status: 'premium-required', category: 'CRM', }, { id: 'amocrm', name: 'amoCRM', icon: <Users className='h-6 w-6' />, badge: 'Premium', description: [ 'Интеграция мессенджеров через Nextbot или напрямую с amoCRM', 'Подключение агентов к любым воронкам и этапам продаж', 'Использование второго пилота для поддержки продаж', 'Автоматическое заполнение и перемещение сделок по воронке', ], status: 'premium-required', category: 'CRM', }, { id: 'uon-travel', name: 'U-ON Travel', icon: <Plane className='h-6 w-6' />, badge: 'Premium', description: [ 'Создание и заполнение карточек туристов', 'Обработка обращений', 'Автоматическое внесение данных клиентов и их запросов', 'Помощь в ведении базы туристов и управлении заявками', ], status: 'premium-required', category: 'Travel', }, { id: 'elevenlabs', name: 'ElevenLabs', icon: <Volume2 className='h-6 w-6' />, badge: 'Premium', description: [ 'Создание и использование персонализированного голоса для повышения эффективности и привлекательности коммуникации с клиентами', ], status: 'premium-required', category: 'AI', }, { id: 'notion', name: 'Notion', icon: <FileText className='h-6 w-6' />, badge: 'Premium', description: [ 'Получение информации о товарах и услугах из вашей базы данных Notion по любым запросам клиента', ], status: 'premium-required', category: 'Productivity', }, { id: 'google-calendar', name: 'Google Calendar', icon: <Calendar className='h-6 w-6' />, description: [ 'Создание, перенос и отмена записей на услуги и мероприятия', 'Проверка свободного времени', 'Напоминания о предстоящих событиях', ], status: 'disconnected', category: 'Calendar', }, { id: 'yclients', name: 'YClients', icon: <Briefcase className='h-6 w-6' />, badge: 'Beta', description: [ 'Создание, перенос и отмена записей на услуги и мероприятия', 'Проверка свободного времени', ], status: 'disconnected', category: 'Business', }, { id: 'yandex-metrika', name: 'Yandex Metrika', icon: <BarChart3 className='h-6 w-6' />, description: ['Передача данных в Яндекс.Метрику'], status: 'disconnected', category: 'Analytics', }, ]; export default function IntegrationsPage() { const [selectedIntegration, setSelectedIntegration] = useState<Integration | null>(null); const [connectionStates, setConnectionStates] = useState< Record<string, 'connected' | 'disconnected' | 'premium-required'> >({}); const handleConnect = (integrationId: string) => { setConnectionStates((prev) => ({ ...prev, [integrationId]: 'connected', })); toast.success('Интеграция подключена успешно'); }; const handleDisconnect = (integrationId: string) => { setConnectionStates((prev) => ({ ...prev, [integrationId]: 'disconnected', })); toast.success('Интеграция отключена'); }; const getIntegrationStatus = (integration: Integration) => { return connectionStates[integration.id] || integration.status; }; const renderIntegrationDetail = (integration: Integration) => { const status = getIntegrationStatus(integration); if (status === 'premium-required') { return ( <div className='space-y-6'> <div> <h1 className='text-xl md:text-2xl font-bold mb-2'> Интеграции / {integration.name} </h1> </div> <Card className='bg-card border-border'> <CardHeader> <CardTitle className='text-foreground'>Премиум-функции</CardTitle> </CardHeader> <CardContent> <Alert className='bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-600'> <AlertTriangle className='h-4 w-4 text-amber-600 dark:text-amber-500' /> <AlertDescription className='text-foreground'> Для доступа к этой функции необходим тариф Премиум. Для получения доступа купите{' '} <a href='#' className='text-purple-400 hover:text-purple-300 underline' > соответствующую подписку </a> . </AlertDescription> </Alert> </CardContent> </Card> </div> ); } return ( <div className='space-y-6'> <div> <h1 className='text-xl md:text-2xl font-bold mb-2'> Интеграции / {integration.name} </h1> </div> <Card className='bg-card border-border'> <CardHeader> <CardTitle className='text-foreground'> Подключение {integration.name} </CardTitle> </CardHeader> <CardContent className='space-y-4'> <div className='flex items-center gap-2'> <span className='text-muted-foreground'>Статус подключения:</span> {status === 'connected' ? ( <div className='flex items-center gap-1'> <CheckCircle className='h-4 w-4 text-green-500' /> <span className='text-green-400'>Подключено</span> </div> ) : ( <div className='flex items-center gap-1'> <XCircle className='h-4 w-4 text-red-500' /> <span className='text-red-400'>Не подключено</span> </div> )} </div> <div className='flex gap-3'> {status === 'connected' ? ( <Button variant='destructive' onClick={() => handleDisconnect(integration.id)} className='bg-gray-600 hover:bg-gray-700' > <XCircle className='mr-2 h-4 w-4' /> ОТКЛЮЧИТЬ </Button> ) : ( <Button onClick={() => handleConnect(integration.id)} className='bg-purple-600 hover:bg-purple-700' > <ExternalLink className='mr-2 h-4 w-4' /> ПОДКЛЮЧИТЬ </Button> )} </div> </CardContent> </Card> </div> ); }; const renderIntegrationGrid = () => ( <div className='space-y-6'> <div> <h1 className='text-xl md:text-2xl font-bold mb-2'>Интеграции</h1> </div> <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6'> {integrations.map((integration) => { const status = getIntegrationStatus(integration); return ( <Card key={integration.id} className='bg-card border-border cursor-pointer hover:bg-muted/50 transition-colors' onClick={() => setSelectedIntegration(integration)} > <CardHeader className='pb-3'> <div className='flex items-center justify-between'> <div className='flex items-center gap-3'> <div className='p-2 bg-muted rounded-lg'> {integration.icon} </div> <CardTitle className='text-foreground text-base md:text-lg'> {integration.name} </CardTitle> </div> {integration.badge && ( <Badge variant={ integration.badge === 'Premium' ? 'default' : 'secondary' } className={ integration.badge === 'Premium' ? 'bg-purple-600 hover:bg-purple-700 text-xs' : 'bg-blue-600 hover:bg-blue-700 text-xs' } > {integration.badge} </Badge> )} </div> </CardHeader> <CardContent> <ul className='space-y-2 text-sm text-muted-foreground'> {integration.description.map((item, index) => ( <li key={index} className='flex items-start gap-2'> <span className='text-purple-400 mt-1'>•</span> <span>{item}</span> </li> ))} </ul> </CardContent> </Card> ); })} </div> </div> ); return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto bg-gray-50 dark:bg-gray-900'> <div className='max-w-7xl mx-auto'> {selectedIntegration ? ( <div className='space-y-4'> <Button variant='ghost' onClick={() => setSelectedIntegration(null)} className='text-muted-foreground hover:text-foreground mb-4' > ← Назад к интеграциям </Button> {renderIntegrationDetail(selectedIntegration)} </div> ) : ( renderIntegrationGrid() )} </div> </main> </div> </div> ); }
```

# app\knowledge\loading.tsx

```tsx
export default function Loading() { return null }
```

# app\knowledge\page.tsx

```tsx
'use client'; import type React from 'react'; import { useState } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Switch } from '@/components/ui/switch'; import { Slider } from '@/components/ui/slider'; import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'; import { Badge } from '@/components/ui/badge'; import { Alert, AlertDescription } from '@/components/ui/alert'; import { Database, FileText, Globe, Table, Upload, AlertTriangle, HelpCircle, Info, Plus, ChevronLeft, ChevronRight, } from 'lucide-react'; import { toast } from 'sonner'; import Link from 'next/link'; type KnowledgeSection = | 'main' | 'database' | 'documents' | 'openai-docs' | 'web-search' | 'tables' | 'document-upload'; interface KnowledgeItem { id: string; name: string; content: string; tokens: number; } export default function KnowledgePage() { const [currentSection, setCurrentSection] = useState<KnowledgeSection>('main'); const [knowledgeEnabled, setKnowledgeEnabled] = useState(false); const [maxResults, setMaxResults] = useState([3]); const [minSimilarity, setMinSimilarity] = useState([25]); const [smartSearch, setSmartSearch] = useState(false); const [resultReranking, setResultReranking] = useState(false); const [webSearchEnabled, setWebSearchEnabled] = useState(false); const [searchQuality, setSearchQuality] = useState('medium'); const [fileSearchEnabled, setFileSearchEnabled] = useState(false); const [knowledgeItems, setKnowledgeItems] = useState<KnowledgeItem[]>([]); const [currentPage, setCurrentPage] = useState(1); const itemsPerPage = 25; const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => { const files = event.target.files; if (files) { Array.from(files).forEach((file) => { toast.success(`Файл ${file.name} загружен`); }); } }; const renderBreadcrumb = () => { const breadcrumbs = [ { label: 'Источники знаний', section: 'main' as KnowledgeSection }, ]; if (currentSection === 'database') { breadcrumbs.push({ label: 'База знаний', section: 'database' as KnowledgeSection, }); } else if (currentSection === 'documents') { breadcrumbs.push({ label: 'Документы', section: 'documents' as KnowledgeSection, }); } else if (currentSection === 'openai-docs') { breadcrumbs.push({ label: 'OpenAI документы', section: 'openai-docs' as KnowledgeSection, }); } else if (currentSection === 'web-search') { breadcrumbs.push({ label: 'OpenAI веб-поиск', section: 'web-search' as KnowledgeSection, }); } else if (currentSection === 'tables') { breadcrumbs.push({ label: 'Таблицы', section: 'tables' as KnowledgeSection, }); } else if (currentSection === 'document-upload') { breadcrumbs.push({ label: 'Загрузка документа', section: 'document-upload' as KnowledgeSection, }); } return ( <div className='flex items-center gap-2 text-sm text-muted-foreground mb-4 md:mb-6'> {breadcrumbs.map((crumb, index) => ( <div key={crumb.section} className='flex items-center gap-2'> {index > 0 && <span>/</span>} <button onClick={() => setCurrentSection(crumb.section)} className={`hover:text-foreground ${ currentSection === crumb.section ? 'text-foreground font-medium' : '' }`} > {crumb.label} </button> </div> ))} </div> ); }; const renderMainSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} {/* Premium Warning */} <Alert className='bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-600'> <AlertTriangle className='h-4 w-4 text-amber-600' /> <AlertDescription className='text-amber-800 dark:text-amber-200'> <strong>Премиум-функции</strong> <br /> Для доступа к этой функции необходим тариф Премиум. Для получения доступа купите{' '} <Link href='/account?tab=subscription' className='text-purple-600 hover:text-purple-700 underline' > соответствующую подписку </Link> . </AlertDescription> </Alert> {/* Knowledge Source Cards */} <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6'> {/* База знаний */} <Card className='cursor-pointer hover:shadow-md transition-shadow' onClick={() => setCurrentSection('database')} > <CardHeader className='pb-4'> <div className='flex items-center gap-3 mb-3'> <div className='p-2 bg-purple-100 dark:bg-purple-900 rounded-lg'> <Database className='h-6 w-6 text-purple-600 dark:text-purple-400' /> </div> <CardTitle className='text-lg'>База знаний</CardTitle> </div> </CardHeader> <CardContent> <div className='space-y-2 text-sm text-muted-foreground'> <p>Ручное создание и организация ключевой информации.</p> <ul className='space-y-1'> <li>• Точный контроль над каждым фрагментом данных</li> <li>• Релевантные данные подтягиваются на каждый запрос</li> <li>• Идеально для FAQ, регламентов, скриптов продаж</li> </ul> </div> </CardContent> </Card> {/* Документы */} <Card className='cursor-pointer hover:shadow-md transition-shadow' onClick={() => setCurrentSection('documents')} > <CardHeader className='pb-4'> <div className='flex items-center gap-3 mb-3'> <div className='p-2 bg-blue-100 dark:bg-blue-900 rounded-lg'> <FileText className='h-6 w-6 text-blue-600 dark:text-blue-400' /> </div> <CardTitle className='text-lg'>Документы</CardTitle> </div> </CardHeader> <CardContent> <div className='space-y-2 text-sm text-muted-foreground'> <p> Быстрая загрузка ключевой информации из файлов без ручной обработки. </p> <ul className='space-y-1'> <li>• Автоматическое разделение на фрагменты</li> <li>• Релевантные данные подтягиваются на каждый запрос</li> <li>• Для быстрого тестирования гипотез</li> </ul> </div> </CardContent> </Card> {/* Документы OpenAI */} <Card className='cursor-pointer hover:shadow-md transition-shadow' onClick={() => setCurrentSection('openai-docs')} > <CardHeader className='pb-4'> <div className='flex items-center gap-3 mb-3'> <div className='p-2 bg-green-100 dark:bg-green-900 rounded-lg'> <FileText className='h-6 w-6 text-green-600 dark:text-green-400' /> </div> <CardTitle className='text-lg'>Документы OpenAI</CardTitle> </div> </CardHeader> <CardContent> <div className='space-y-2 text-sm text-muted-foreground'> <p>Документы по запросу без перегрузки контекста.</p> <ul className='space-y-1'> <li>• Агент сам решает, когда обращаться к документации</li> <li>• Экономия на токенах и ресурсах</li> <li>• Надежное решение для больших массивов данных</li> </ul> </div> </CardContent> </Card> {/* Веб-поиск */} <Card className='cursor-pointer hover:shadow-md transition-shadow' onClick={() => setCurrentSection('web-search')} > <CardHeader className='pb-4'> <div className='flex items-center gap-3 mb-3'> <div className='p-2 bg-orange-100 dark:bg-orange-900 rounded-lg'> <Globe className='h-6 w-6 text-orange-600 dark:text-orange-400' /> </div> <CardTitle className='text-lg'>Веб-поиск</CardTitle> </div> </CardHeader> <CardContent> <div className='space-y-2 text-sm text-muted-foreground'> <p>Доступ агента к актуальной информации в интернете.</p> <ul className='space-y-1'> <li>• Самостоятельный поиск свежих данных</li> <li>• Ответы на вопросы, требующие актуальности</li> <li>• Для работы с ценами, новостями, тенденциями рынка</li> </ul> </div> </CardContent> </Card> {/* Таблицы */} <Card className='cursor-pointer hover:shadow-md transition-shadow' onClick={() => setCurrentSection('tables')} > <CardHeader className='pb-4'> <div className='flex items-center gap-3 mb-3'> <div className='p-2 bg-indigo-100 dark:bg-indigo-900 rounded-lg'> <Table className='h-6 w-6 text-indigo-600 dark:text-indigo-400' /> </div> <div className='flex items-center gap-2'> <CardTitle className='text-lg'>Таблицы</CardTitle> <Badge variant='secondary' className='bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100' > Beta </Badge> </div> </div> </CardHeader> <CardContent> <div className='space-y-2 text-sm text-muted-foreground'> <p>Структурированные данные с комбинированным поиском.</p> <ul className='space-y-1'> <li>• Точная фильтрация по параметрам (цена, категория)</li> <li>• Интеллектуальный поиск по смыслу в описаниях</li> <li>• Идеально для прайс-листов и каталогов продукции</li> </ul> </div> </CardContent> </Card> </div> </div> ); const renderDatabaseSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} <Card> <CardHeader className='flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0'> <CardTitle className='text-lg'>Настройки базы знаний</CardTitle> <div className='flex items-center gap-2'> <HelpCircle className='h-4 w-4 text-muted-foreground' /> <Button variant='ghost' size='icon' className='h-8 w-8'> <Info className='h-4 w-4' /> </Button> </div> </CardHeader> <CardContent className='space-y-4 md:space-y-6'> {/* Включить базу знаний */} <div className='space-y-3'> <div className='flex items-center space-x-2'> <Switch id='knowledge-enabled' checked={knowledgeEnabled} onCheckedChange={setKnowledgeEnabled} /> <Label htmlFor='knowledge-enabled' className='font-medium'> Включить базу знаний </Label> </div> <div className='text-sm text-muted-foreground'> Когда включено, агент сможет искать информацию в базе знаний. <br /> Найденные фрагменты будут добавлены в контекст Агента. И при необходимости будут использоваться для генерации ответов. </div> </div> {/* Максимальное число результатов */} <div className='space-y-4'> <div className='flex items-center gap-2'> <Label className='font-medium'> Максимальное число результатов </Label> </div> <div className='text-sm text-muted-foreground mb-3'> Определяет, сколько фрагментов(знаний) будет извлечено при поиске. </div> <div className='space-y-2'> <div className='text-sm'>Число результатов: {maxResults[0]}</div> <Slider value={maxResults} onValueChange={setMaxResults} max={50} min={1} step={1} className='w-full' /> <div className='flex justify-between text-xs text-muted-foreground'> <span>1</span> <span>10</span> <span>20</span> <span>30</span> <span>40</span> <span>50</span> </div> </div> <div className='text-xs text-purple-600 flex items-start gap-2'> <Info className='h-3 w-3 mt-0.5 flex-shrink-0' /> <span> Рекомендации по выбору числа результатов <br /> Установите максимальное количество фрагментов(знаний), которые агент получит при поиске в файлах. Рекомендуется начинать с небольших значений (1-5) и увеличивать их при необходимости. Большая база знаний может требовать большего числа результатов. </span> </div> </div> {/* Минимальный процент совпадений */} <div className='space-y-4'> <div className='flex items-center gap-2'> <Label className='font-medium'> Минимальный процент совпадений </Label> </div> <div className='text-sm text-muted-foreground mb-3'> Определяет, насколько сильно должен совпадать фрагмент по смыслу, чтобы быть включённым в результаты поиска. </div> <div className='space-y-2'> <div className='text-sm'> Процент совпадений: {minSimilarity[0]}% </div> <Slider value={minSimilarity} onValueChange={setMinSimilarity} max={100} min={1} step={1} className='w-full' /> <div className='flex justify-between text-xs text-muted-foreground'> <span>1%</span> <span>20%</span> <span>40%</span> <span>60%</span> <span>80%</span> <span>100%</span> </div> </div> <div className='text-xs text-purple-600 flex items-start gap-2'> <Info className='h-3 w-3 mt-0.5 flex-shrink-0' /> <span> Средний порог: Компромисс <br />В этом диапазоне система старается отсекать наименее релевантные фрагменты, но сохранит те, что имеют достаточное смысловое совпадение. Это компромисс между полнотой и точностью результатов. Баланс точности будет умеренным и зависит от количества проходящих фильтр фрагментов. </span> </div> </div> {/* Умный поиск */} <div className='space-y-3'> <div className='flex items-center space-x-2'> <Switch id='smart-search' checked={smartSearch} onCheckedChange={setSmartSearch} /> <Label htmlFor='smart-search' className='font-medium'> Включить умный поиск </Label> </div> <div className='text-sm text-muted-foreground'> Агент объединяет несколько последних сообщений пользователя в свои ответы в один общий вопрос, чтобы выполнить более точный поиск по базе знаний. </div> </div> {/* Переоценка результатов */} <div className='space-y-3'> <div className='flex items-center space-x-2'> <Switch id='result-reranking' checked={resultReranking} onCheckedChange={setResultReranking} /> <Label htmlFor='result-reranking' className='font-medium'> Включить переоценку результатов </Label> </div> <div className='text-sm text-muted-foreground'> Агент выполняет дополнительную проверку найденных фрагментов для повышения точности и релевантности ответов. ЭТО НЕ значительно улучшает качество поиска, но увеличивает время ответа и стоимость. </div> </div> </CardContent> </Card> {/* Knowledge Items Table */} <Card> <CardHeader className='flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0'> <div className='flex flex-col sm:flex-row items-start sm:items-center gap-3'> <Button className='bg-purple-600 hover:bg-purple-700 w-full sm:w-auto'> <Plus className='mr-2 h-4 w-4' /> ДОБАВИТЬ ЗНАНИЕ </Button> <span className='text-sm text-muted-foreground'>Поиск</span> </div> </CardHeader> <CardContent> <div className='space-y-4'> <div className='hidden md:grid grid-cols-4 gap-4 text-sm font-medium text-muted-foreground border-b pb-2'> <div>Имя</div> <div>Контент</div> <div>Токены</div> <div></div> </div> {knowledgeItems.length === 0 ? ( <div className='text-center py-8 text-muted-foreground'> Нет строк </div> ) : ( knowledgeItems.map((item) => ( <div key={item.id} className='grid grid-cols-1 md:grid-cols-4 gap-2 md:gap-4 text-sm py-2 border-b' > <div className='font-medium md:font-normal'> <span className='md:hidden text-muted-foreground'> Имя:{' '} </span> {item.name} </div> <div className='truncate'> <span className='md:hidden text-muted-foreground'> Контент:{' '} </span> {item.content} </div> <div> <span className='md:hidden text-muted-foreground'> Токены:{' '} </span> {item.tokens} </div> <div className='flex gap-2'> <Button variant='outline' size='sm'> Редактировать </Button> <Button variant='destructive' size='sm'> Удалить </Button> </div> </div> )) )} </div> {/* Pagination */} <div className='flex flex-col sm:flex-row items-center justify-between gap-4 mt-6'> <div className='text-sm text-muted-foreground'> Показано{' '} {Math.min( (currentPage - 1) * itemsPerPage + 1, knowledgeItems.length )}{' '} - {Math.min(currentPage * itemsPerPage, knowledgeItems.length)} из{' '} {knowledgeItems.length} строк </div> <div className='flex items-center gap-2'> <Button variant='outline' size='sm' onClick={() => setCurrentPage(Math.max(1, currentPage - 1))} disabled={currentPage === 1} > <ChevronLeft className='h-4 w-4' /> Предыдущая </Button> <span className='text-sm'> Страница {currentPage} из{' '} {Math.ceil(knowledgeItems.length / itemsPerPage) || 1} </span> <Button variant='outline' size='sm' onClick={() => setCurrentPage( Math.min( Math.ceil(knowledgeItems.length / itemsPerPage), currentPage + 1 ) ) } disabled={ currentPage >= Math.ceil(knowledgeItems.length / itemsPerPage) } > Следующая <ChevronRight className='h-4 w-4' /> </Button> </div> </div> </CardContent> </Card> </div> ); const renderDocumentsSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} <Card> <CardHeader> <CardTitle className='text-lg'>Загрузка документов</CardTitle> </CardHeader> <CardContent className='space-y-4'> <div className='border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 md:p-8 text-center'> <Upload className='h-8 w-8 mx-auto mb-4 text-muted-foreground' /> <div className='space-y-2'> <p className='text-sm text-muted-foreground'> Перетащите файлы сюда или </p> <Label htmlFor='file-upload' className='cursor-pointer'> <Button variant='outline' className='bg-purple-600 hover:bg-purple-700 text-white' > Выберите файлы </Button> <Input id='file-upload' type='file' multiple className='hidden' accept='.pdf,.doc,.docx,.txt' onChange={handleFileUpload} /> </Label> </div> <p className='text-xs text-muted-foreground mt-2'> Поддерживаемые форматы: PDF, DOC, DOCX, TXT (максимум 10 МБ) </p> </div> </CardContent> </Card> </div> ); const renderOpenAIDocsSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} <Card> <CardHeader> <CardTitle className='text-lg'>Настройки документов OpenAI</CardTitle> </CardHeader> <CardContent className='space-y-4'> <div className='space-y-3'> <div className='flex items-center space-x-2'> <Switch id='file-search' checked={fileSearchEnabled} onCheckedChange={setFileSearchEnabled} /> <Label htmlFor='file-search' className='font-medium'> Включить поиск по файлам </Label> </div> <div className='text-sm text-muted-foreground'> Агент сможет самостоятельно искать информацию в загруженных документах при необходимости. </div> </div> <div className='border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 md:p-8 text-center'> <FileText className='h-8 w-8 mx-auto mb-4 text-muted-foreground' /> <div className='space-y-2'> <p className='text-sm text-muted-foreground'> Загрузите документы для OpenAI </p> <Label htmlFor='openai-file-upload' className='cursor-pointer'> <Button variant='outline' className='bg-purple-600 hover:bg-purple-700 text-white' > Выберите файлы </Button> <Input id='openai-file-upload' type='file' multiple className='hidden' accept='.pdf,.doc,.docx,.txt' onChange={handleFileUpload} /> </Label> </div> </div> </CardContent> </Card> </div> ); const renderWebSearchSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} <Card> <CardHeader> <CardTitle className='text-lg'>Настройки веб-поиска</CardTitle> </CardHeader> <CardContent className='space-y-4 md:space-y-6'> <div className='space-y-3'> <div className='flex items-center space-x-2'> <Switch id='web-search' checked={webSearchEnabled} onCheckedChange={setWebSearchEnabled} /> <Label htmlFor='web-search' className='font-medium'> Включить веб-поиск </Label> </div> <div className='text-sm text-muted-foreground'> Агент сможет искать актуальную информацию в интернете для ответов на вопросы пользователей. </div> </div> <div className='space-y-3'> <Label className='font-medium'>Качество поиска</Label> <RadioGroup value={searchQuality} onValueChange={setSearchQuality}> <div className='flex items-center space-x-2'> <RadioGroupItem value='low' id='low' /> <Label htmlFor='low'>Низкое (быстро, дешево)</Label> </div> <div className='flex items-center space-x-2'> <RadioGroupItem value='medium' id='medium' /> <Label htmlFor='medium'>Среднее (баланс)</Label> </div> <div className='flex items-center space-x-2'> <RadioGroupItem value='high' id='high' /> <Label htmlFor='high'>Высокое (медленно, дорого)</Label> </div> </RadioGroup> </div> </CardContent> </Card> </div> ); const renderTablesSection = () => ( <div className='space-y-4 md:space-y-6'> {renderBreadcrumb()} <Card> <CardHeader className='flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0'> <div className='flex items-center gap-2'> <CardTitle className='text-lg'>Таблицы</CardTitle> <Badge variant='secondary' className='bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100' > Beta </Badge> </div> <Button className='bg-purple-600 hover:bg-purple-700 w-full sm:w-auto'> <Plus className='mr-2 h-4 w-4' /> СОЗДАТЬ ТАБЛИЦУ </Button> </CardHeader> <CardContent> <div className='text-center py-8 text-muted-foreground'> <Table className='h-12 w-12 mx-auto mb-4 opacity-50' /> <p>Таблицы не созданы</p> <p className='text-sm mt-2'> Создайте первую таблицу для структурированного хранения данных </p> </div> </CardContent> </Card> </div> ); const renderContent = () => { switch (currentSection) { case 'main': return renderMainSection(); case 'database': return renderDatabaseSection(); case 'documents': return renderDocumentsSection(); case 'openai-docs': return renderOpenAIDocsSection(); case 'web-search': return renderWebSearchSection(); case 'tables': return renderTablesSection(); default: return renderMainSection(); } }; return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 overflow-auto'> <div className='p-4 md:p-6'> <div className='max-w-7xl mx-auto'>{renderContent()}</div> </div> </main> </div> </div> ); }
```

# app\layout.tsx

```tsx
import type React from 'react'; import type { Metadata } from 'next'; import { Inter } from 'next/font/google'; import './globals.css'; import { ThemeProvider } from '@/components/theme-provider'; import { Toaster } from '@/components/ui/sonner'; import { AuthProvider } from '@/contexts/auth-context'; const inter = Inter({ subsets: ['latin'] }); export const metadata: Metadata = { title: 'NeuroX - AI Agent Dashboard', description: 'Manage your AI agents with NeuroX', }; export default function RootLayout({ children, }: { children: React.ReactNode; }) { return ( <html lang='en' suppressHydrationWarning> <body className={inter.className}> <ThemeProvider attribute='class' defaultTheme='light' enableSystem disableTransitionOnChange > <AuthProvider> {children} </AuthProvider> <Toaster /> </ThemeProvider> </body> </html> ); }
```

# app\login\page.tsx

```tsx
"use client" import type React from "react" import { useState } from "react" import Link from "next/link" import { useRouter } from "next/navigation" import { Button } from "@/components/ui/button" import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card" import { Input } from "@/components/ui/input" import { Label } from "@/components/ui/label" import { Eye, EyeOff, Loader2, Mail, Lock, ArrowLeft } from "lucide-react" import AnimatedBackground from "@/components/animated-background" import { useAuth } from "@/contexts/auth-context" import { toast } from "sonner" export default function LoginPage() { const [showPassword, setShowPassword] = useState(false) const [email, setEmail] = useState("") const [password, setPassword] = useState("") const [isLoading, setIsLoading] = useState(false) const { login } = useAuth() const router = useRouter() const handleSubmit = async (e: React.FormEvent) => { e.preventDefault() if (!email || !password) { toast.error("Заполните все поля") return } setIsLoading(true) try { await login({ email, password }) } catch (error: any) { toast.error(error.message || "Ошибка входа") } finally { setIsLoading(false) } } return ( <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 relative overflow-hidden"> <AnimatedBackground /> {/* Header */} <div className="absolute top-0 left-0 right-0 z-20 p-4 sm:p-6"> <div className="flex items-center justify-between max-w-7xl mx-auto"> <Button variant="ghost" className="text-white/80 hover:text-white hover:bg-white/10" onClick={() => router.push("/")} > <ArrowLeft className="w-4 h-4 mr-2" /> На главную </Button> <div className="text-xl sm:text-2xl font-bold bg-gradient-to-r from-white via-purple-100 to-blue-100 bg-clip-text text-transparent"> NEUROX </div> </div> </div> {/* Main Content */} <div className="flex items-center justify-center min-h-screen p-4 pt-20"> <div className="w-full max-w-md relative z-10"> <Card className="bg-white/95 backdrop-blur-sm border-0 shadow-2xl"> <CardHeader className="space-y-2 text-center pb-6"> <div className="mx-auto w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center mb-4"> <Lock className="w-8 h-8 text-white" /> </div> <CardTitle className="text-2xl sm:text-3xl font-bold text-gray-900">Добро пожаловать</CardTitle> <CardDescription className="text-gray-600 text-base"> Войдите в свой аккаунт для продолжения </CardDescription> </CardHeader> <CardContent className="space-y-6"> <form onSubmit={handleSubmit} className="space-y-5"> <div className="space-y-2"> <Label htmlFor="email" className="text-sm font-medium text-gray-700"> Email адрес </Label> <div className="relative"> <Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="email" type="email" placeholder="example@email.com" value={email} onChange={(e) => setEmail(e.target.value)} className="pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> </div> </div> <div className="space-y-2"> <Label htmlFor="password" className="text-sm font-medium text-gray-700"> Пароль </Label> <div className="relative"> <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="password" type={showPassword ? "text" : "password"} placeholder="Введите пароль" value={password} onChange={(e) => setPassword(e.target.value)} className="pl-10 pr-12 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors" disabled={isLoading} > {showPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />} </button> </div> </div> <div className="flex items-center justify-between"> <Link href="/reset-password" className="text-sm text-purple-600 hover:text-purple-700 font-medium transition-colors" > Забыли пароль? </Link> </div> <Button type="submit" className="w-full h-12 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200" disabled={isLoading} > {isLoading ? ( <> <Loader2 className="mr-2 h-5 w-5 animate-spin" /> Вход... </> ) : ( "Войти в аккаунт" )} </Button> </form> <div className="relative"> <div className="absolute inset-0 flex items-center"> <span className="w-full border-t border-gray-200" /> </div> <div className="relative flex justify-center text-xs uppercase"> <span className="bg-white px-2 text-gray-500">или</span> </div> </div> <div className="text-center"> <span className="text-gray-600">Нет аккаунта? </span> <Link href="/register" className="text-purple-600 hover:text-purple-700 font-medium transition-colors"> Зарегистрироваться </Link> </div> </CardContent> </Card> {/* Additional Info */} <div className="mt-8 text-center"> <p className="text-white/80 text-sm"> Используя NEUROX, вы соглашаетесь с нашими{" "} <Link href="/terms" className="text-white underline hover:text-purple-200"> условиями использования </Link> </p> </div> </div> </div> </div> ) }
```

# app\not-found.tsx

```tsx
'use client'; import Link from 'next/link'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Home, ArrowLeft, Bot, Search } from 'lucide-react'; export default function NotFound() { return ( <div className='min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-purple-900 flex items-center justify-center p-4'> <Card className='w-full max-w-2xl shadow-2xl border-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm'> <CardContent className='p-12 text-center space-y-8'> {/* Logo */} <div className='text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent'> NEUROX </div> {/* 404 Animation */} <div className='relative'> <div className='text-8xl font-bold text-purple-600 dark:text-purple-400 opacity-20'> 404 </div> <div className='absolute inset-0 flex items-center justify-center'> <Bot className='h-16 w-16 text-purple-600 dark:text-purple-400 animate-bounce' /> </div> </div> {/* Error Message */} <div className='space-y-4'> <h1 className='text-3xl font-bold text-gray-900 dark:text-white'> Страница не найдена </h1> <p className='text-lg text-gray-600 dark:text-gray-300 max-w-md mx-auto'> Похоже, что страница, которую вы ищете, не существует или была перемещена. </p> </div> {/* Suggestions */} <div className='bg-purple-50 dark:bg-purple-900/20 rounded-lg p-6 space-y-3'> <h3 className='font-semibold text-gray-900 dark:text-white'> Возможные причины: </h3> <ul className='text-sm text-gray-600 dark:text-gray-300 space-y-1'> <li>• Неправильно введен адрес страницы</li> <li>• Страница была удалена или перемещена</li> <li>• Ссылка устарела или повреждена</li> </ul> </div> {/* Action Buttons */} <div className='flex flex-col sm:flex-row gap-4 justify-center'> <Button asChild className='bg-purple-600 hover:bg-purple-700 text-white' > <Link href='/'> <Home className='mr-2 h-4 w-4' /> На главную </Link> </Button> <Button asChild variant='outline' className='border-purple-600 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 bg-transparent' > <Link href='javascript:history.back()'> <ArrowLeft className='mr-2 h-4 w-4' /> Назад </Link> </Button> <Button asChild variant='outline'> <Link href='/support'> <Search className='mr-2 h-4 w-4' /> Поддержка </Link> </Button> </div> {/* Additional Help */} <div className='text-sm text-gray-500 dark:text-gray-400'> Если проблема повторяется, обратитесь в{' '} <Link href='/support' className='text-purple-600 hover:text-purple-700 underline' > службу поддержки </Link> </div> </CardContent> </Card> </div> ); }
```

# app\page.tsx

```tsx
'use client'; import AnimatedBackground from '../components/animated-background'; import { useRef, useEffect, useState } from 'react'; import { useRouter } from 'next/navigation'; // Particle type for floating particles interface FloatingParticle { id: number; top: number; left: number; size: number; duration: number; delay: number; } export default function Home() { const buttonRef = useRef<HTMLButtonElement>(null); const [isClient, setIsClient] = useState(false); const [particles, setParticles] = useState<FloatingParticle[]>([]); const router = useRouter(); const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => { // Ripple effect (перенести код из createRipple сюда) const button = buttonRef.current; if (!button) return; const ripple = document.createElement('span'); const diameter = Math.max(button.clientWidth, button.clientHeight); const radius = diameter / 2; ripple.style.width = ripple.style.height = `${diameter}px`; ripple.style.left = `${ e.clientX - button.getBoundingClientRect().left - radius }px`; ripple.style.top = `${ e.clientY - button.getBoundingClientRect().top - radius }px`; ripple.classList.add('ripple'); const rippleAnimation = ripple.animate( [ { transform: 'scale(0)', opacity: 1 }, { transform: 'scale(4)', opacity: 0 }, ], { duration: 800, easing: 'cubic-bezier(0.4, 0, 0.2, 1)' } ); rippleAnimation.onfinish = () => ripple.remove(); button.appendChild(ripple); router.push('/agents'); }; // Initialize client state and generate particles on client only useEffect(() => { setIsClient(true); generateParticles(); }, []); // Generate particles with random properties const generateParticles = () => { const newParticles: FloatingParticle[] = []; for (let i = 0; i < 20; i++) { newParticles.push({ id: i, top: Math.random() * 100, left: Math.random() * 100, size: Math.random() * 8 + 2, duration: Math.random() * 10 + 10, delay: Math.random() * 5, }); } setParticles(newParticles); }; // // Ripple effect handler // useEffect(() => { // const button = buttonRef.current; // if (!button) return; // const createRipple = (e: MouseEvent) => { // const ripple = document.createElement('span'); // const diameter = Math.max(button.clientWidth, button.clientHeight); // const radius = diameter / 2; // ripple.style.width = ripple.style.height = `${diameter}px`; // ripple.style.left = `${ // e.clientX - button.getBoundingClientRect().left - radius // }px`; // ripple.style.top = `${ // e.clientY - button.getBoundingClientRect().top - radius // }px`; // ripple.classList.add('ripple'); // const rippleAnimation = ripple.animate( // [ // { transform: 'scale(0)', opacity: 1 }, // { transform: 'scale(4)', opacity: 0 }, // ], // { duration: 800, easing: 'cubic-bezier(0.4, 0, 0.2, 1)' } // ); // rippleAnimation.onfinish = () => ripple.remove(); // button.appendChild(ripple); // }; // button.addEventListener('click', createRipple); // return () => button.removeEventListener('click', createRipple); // }, []); return ( <div className='relative min-h-screen w-full overflow-hidden flex items-center justify-center'> <AnimatedBackground /> {/* Quantum Pulse Button */} <div className='relative z-10'> <button ref={buttonRef} onClick={handleClick} className='relative group w-40 h-40 md:w-48 md:h-48 flex items-center justify-center' aria-label='Start' > {/* Quantum Core */} <div className='absolute w-full h-full rounded-full bg-gradient-to-br from-purple-700 via-indigo-800 to-purple-900 shadow-2xl transform transition-all duration-700 group-hover:scale-105 group-hover:shadow-[0_0_50px_15px_rgba(139,92,246,0.5)]'> <div className='absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(255,255,255,0.2)_0%,transparent_70%)] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500'></div> </div> {/* Quantum Rings */} {[...Array(3)].map((_, i) => ( <div key={i} className='absolute border-2 border-transparent border-t-purple-500 rounded-full' style={{ width: `${100 + i * 30}%`, height: `${100 + i * 30}%`, animation: `spin ${3 + i}s linear infinite, pulse ${ 4 - i }s ease-in-out infinite alternate`, filter: `blur(${i === 0 ? 0 : i}px)`, opacity: 0.7 - i * 0.2, }} ></div> ))} {/* Glowing Center */} <div className='absolute w-28 h-28 md:w-32 md:h-32 rounded-full bg-gradient-to-br from-purple-600 to-indigo-700 shadow-inner shadow-purple-300/30 flex items-center justify-center transform transition-all duration-500 group-hover:scale-95 group-hover:shadow-[0_0_30px_5px_rgba(192,132,252,0.7)]'> <span className='text-white font-bold text-xl md:text-2xl tracking-widest transform transition-all duration-300 group-hover:scale-110 group-hover:text-purple-200'> START </span> </div> {/* Particle Glow */} <div className='absolute -inset-4 rounded-full bg-purple-500/10 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-700'></div> </button> </div> {/* Floating Particles (Client-side only) */} {isClient && ( <div className='absolute inset-0 pointer-events-none'> {particles.map((particle) => ( <div key={particle.id} className='absolute rounded-full bg-purple-500/30' style={{ top: `${particle.top}%`, left: `${particle.left}%`, width: `${particle.size}px`, height: `${particle.size}px`, animation: `float ${particle.duration}s infinite ease-in-out both`, animationDelay: `${particle.delay}s`, }} ></div> ))} </div> )} <style jsx global>{` @keyframes spin { to { transform: rotate(360deg); } } @keyframes pulse { 0% { opacity: 0.3; } 100% { opacity: 0.7; } } @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; } 25% { transform: translate(-10px, -15px) scale(1.1); opacity: 0.5; } 50% { transform: translate(5px, -20px) scale(0.9); opacity: 0.7; } 75% { transform: translate(15px, 10px) scale(1.2); opacity: 0.4; } } .ripple { position: absolute; border-radius: 50%; background: radial-gradient( circle, rgba(192, 132, 252, 0.8) 0%, transparent 70% ); pointer-events: none; z-index: 10; } `}</style> </div> ); }
```

# app\privacy\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useRouter } from 'next/navigation'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Separator } from '@/components/ui/separator'; import { ArrowLeft, Shield, Database, Eye, Lock, Users, Mail, AlertTriangle, CheckCircle, Clock, FileText, Settings, } from 'lucide-react'; import AnimatedBackground from '@/components/animated-background'; export default function PrivacyPage() { const router = useRouter(); return ( <div className='min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 relative overflow-hidden'> <AnimatedBackground /> {/* Header */} <div className='absolute top-0 left-0 right-0 z-20 p-4 sm:p-6'> <div className='flex items-center justify-between max-w-4xl mx-auto'> <Button variant='ghost' className='text-white/80 hover:text-white hover:bg-white/10' onClick={() => router.back()} > <ArrowLeft className='w-4 h-4 mr-2' /> Назад </Button> <Link href='/' className='text-xl sm:text-2xl font-bold bg-gradient-to-r from-white via-purple-100 to-blue-100 bg-clip-text text-transparent' > NEUROX </Link> </div> </div> {/* Main Content */} <div className='pt-20 pb-8 px-4 sm:px-6 lg:px-8'> <div className='max-w-4xl mx-auto'> {/* Page Header */} <div className='text-center mb-8 relative z-10'> <div className='inline-flex items-center gap-3 mb-4'> <div className='p-3 bg-white/20 rounded-xl backdrop-blur-sm'> <Shield className='w-8 h-8 text-white' /> </div> <Badge className='bg-white/20 text-white border-white/30'> 152-ФЗ </Badge> </div> <h1 className='text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4'> Политика конфиденциальности </h1> <p className='text-white/80 text-lg max-w-2xl mx-auto'> Мы заботимся о защите ваших данных и объясняем это простыми словами </p> <div className='flex items-center justify-center gap-4 mt-6 text-white/60 text-sm'> <div className='flex items-center gap-2'> <Clock className='w-4 h-4' /> <span>Обновлено: 15 января 2025</span> </div> </div> </div> {/* Content */} <Card className='bg-white/95 backdrop-blur-sm border-0 shadow-xl relative z-10'> <CardContent className='p-8 space-y-8'> {/* Introduction */} <div className='text-center'> <p className='text-gray-700 text-lg leading-relaxed'> Мы серьезно относимся к защите ваших персональных данных и соблюдаем все требования российского законодательства. </p> </div> <Separator /> {/* Main Sections */} <div className='space-y-8'> {/* What data we collect */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-blue-100 rounded-lg'> <Database className='w-5 h-5 text-blue-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Какие данные мы собираем </h2> </div> <div className='grid grid-cols-1 md:grid-cols-2 gap-6'> <div className='bg-green-50 p-4 rounded-lg'> <div className='flex items-center gap-2 mb-3'> <Users className='w-5 h-5 text-green-600' /> <h4 className='font-medium text-green-900'> При регистрации </h4> </div> <ul className='text-sm text-green-800 space-y-1'> <li>• Имя и фамилия</li> <li>• Email адрес</li> <li>• Номер телефона</li> <li>• Название компании</li> </ul> </div> <div className='bg-blue-50 p-4 rounded-lg'> <div className='flex items-center gap-2 mb-3'> <Settings className='w-5 h-5 text-blue-600' /> <h4 className='font-medium text-blue-900'> Автоматически </h4> </div> <ul className='text-sm text-blue-800 space-y-1'> <li>• IP-адрес</li> <li>• Тип браузера</li> <li>• Время посещения</li> <li>• Действия в системе</li> </ul> </div> </div> </section> {/* How we use data */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-green-100 rounded-lg'> <Eye className='w-5 h-5 text-green-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Как мы используем данные </h2> </div> <div className='space-y-4'> <p className='text-gray-700 leading-relaxed'> Ваши данные используются только для работы платформы: </p> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='flex items-start gap-3 p-4 bg-gray-50 rounded-lg'> <CheckCircle className='w-5 h-5 text-green-600 mt-0.5 flex-shrink-0' /> <div> <h4 className='font-medium text-gray-900 mb-1'> Работа аккаунта </h4> <p className='text-gray-700 text-sm'> Вход в систему и доступ к функциям </p> </div> </div> <div className='flex items-start gap-3 p-4 bg-gray-50 rounded-lg'> <CheckCircle className='w-5 h-5 text-green-600 mt-0.5 flex-shrink-0' /> <div> <h4 className='font-medium text-gray-900 mb-1'> Поддержка </h4> <p className='text-gray-700 text-sm'> Помощь в решении вопросов </p> </div> </div> <div className='flex items-start gap-3 p-4 bg-gray-50 rounded-lg'> <CheckCircle className='w-5 h-5 text-green-600 mt-0.5 flex-shrink-0' /> <div> <h4 className='font-medium text-gray-900 mb-1'> Безопасность </h4> <p className='text-gray-700 text-sm'> Защита от мошенничества </p> </div> </div> <div className='flex items-start gap-3 p-4 bg-gray-50 rounded-lg'> <CheckCircle className='w-5 h-5 text-green-600 mt-0.5 flex-shrink-0' /> <div> <h4 className='font-medium text-gray-900 mb-1'> Улучшения </h4> <p className='text-gray-700 text-sm'> Развитие платформы </p> </div> </div> </div> </div> </section> {/* Data protection */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-purple-100 rounded-lg'> <Lock className='w-5 h-5 text-purple-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Как мы защищаем данные </h2> </div> <div className='bg-purple-50 p-6 rounded-lg'> <div className='grid grid-cols-1 md:grid-cols-3 gap-4'> <div className='text-center'> <Lock className='w-8 h-8 text-purple-600 mx-auto mb-2' /> <h4 className='font-medium text-gray-900 mb-1'> Шифрование </h4> <p className='text-gray-700 text-sm'> Все данные защищены современным шифрованием </p> </div> <div className='text-center'> <Shield className='w-8 h-8 text-purple-600 mx-auto mb-2' /> <h4 className='font-medium text-gray-900 mb-1'> Мониторинг </h4> <p className='text-gray-700 text-sm'> Круглосуточный контроль безопасности </p> </div> <div className='text-center'> <Users className='w-8 h-8 text-purple-600 mx-auto mb-2' /> <h4 className='font-medium text-gray-900 mb-1'> Доступ </h4> <p className='text-gray-700 text-sm'> Только авторизованные сотрудники </p> </div> </div> </div> </section> {/* Data sharing */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-yellow-100 rounded-lg'> <AlertTriangle className='w-5 h-5 text-yellow-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Передача данных </h2> </div> <div className='space-y-4'> <div className='bg-red-50 p-4 rounded-lg border-l-4 border-red-500'> <h4 className='font-medium text-red-900 mb-2'> ❌ Мы НЕ продаем ваши данные </h4> <p className='text-red-800 text-sm'> Мы никогда не продаем, не сдаем в аренду и не передаем ваши данные для рекламы или маркетинга. </p> </div> <div className='bg-blue-50 p-4 rounded-lg'> <h4 className='font-medium text-blue-900 mb-2'> ✅ Когда мы можем передать данные: </h4> <ul className='text-blue-800 text-sm space-y-1'> <li>• С вашего письменного согласия</li> <li>• По требованию суда или полиции</li> <li> • Техническим партнерам (хостинг, платежи) — только необходимый минимум </li> </ul> </div> </div> </section> {/* Your rights */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-green-100 rounded-lg'> <Eye className='w-5 h-5 text-green-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Ваши права </h2> </div> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div className='bg-green-50 p-4 rounded-lg'> <h4 className='font-medium text-green-900 mb-2'> Вы можете: </h4> <ul className='text-sm text-green-800 space-y-1'> <li>• Посмотреть свои данные</li> <li>• Исправить неточности</li> <li>• Удалить аккаунт</li> <li>• Скачать свои данные</li> </ul> </div> <div className='bg-blue-50 p-4 rounded-lg'> <h4 className='font-medium text-blue-900 mb-2'> Как это сделать: </h4> <p className='text-sm text-blue-800 mb-2'> Напишите нам на: </p> <p className='text-sm text-blue-800 font-medium'> privacy@neurox.ru </p> <p className='text-xs text-blue-700 mt-2'> Ответим в течение 30 дней </p> </div> </div> </section> {/* Cookies */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-orange-100 rounded-lg'> <Settings className='w-5 h-5 text-orange-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Файлы cookie </h2> </div> <div className='bg-orange-50 p-4 rounded-lg'> <p className='text-orange-800 text-sm mb-3'> Мы используем cookie для работы сайта и улучшения вашего опыта: </p> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> <div> <h4 className='font-medium text-orange-900 mb-1'> Необходимые </h4> <p className='text-xs text-orange-800'> Для входа и работы сайта (всегда включены) </p> </div> <div> <h4 className='font-medium text-orange-900 mb-1'> Аналитические </h4> <p className='text-xs text-orange-800'> Для улучшения сайта (можно отключить) </p> </div> </div> </div> </section> {/* Contact */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-gray-100 rounded-lg'> <Mail className='w-5 h-5 text-gray-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Вопросы о данных </h2> </div> <div className='bg-gray-50 p-6 rounded-lg'> <div className='text-center'> <p className='text-gray-700 mb-4'> Если у вас есть вопросы о том, как мы обрабатываем ваши данные: </p> <div className='space-y-2'> <p className='font-medium text-gray-900'> Email: privacy@neurox.ru </p> <p className='text-gray-600 text-sm'> Ответим в течение 30 дней </p> </div> </div> </div> </section> </div> {/* Footer */} <div className='bg-gray-50 p-6 rounded-lg text-center'> <p className='text-gray-600 text-sm mb-4'> Мы можем обновлять эту политику. Актуальная версия всегда доступна на этой странице. </p> <div className='flex flex-col sm:flex-row items-center justify-center gap-4'> <Button asChild className='bg-purple-600 hover:bg-purple-700'> <Link href='/register'> <Users className='w-4 h-4 mr-2' /> Создать аккаунт </Link> </Button> <Button variant='outline' asChild> <Link href='/terms'> <FileText className='w-4 h-4 mr-2' /> Условия использования </Link> </Button> </div> </div> </CardContent> </Card> </div> </div> </div> ); }
```

# app\register\page.tsx

```tsx
"use client" import type React from "react" import { useState } from "react" import Link from "next/link" import { useRouter } from "next/navigation" import { Button } from "@/components/ui/button" import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card" import { Input } from "@/components/ui/input" import { Label } from "@/components/ui/label" import { Checkbox } from "@/components/ui/checkbox" import { Progress } from "@/components/ui/progress" import { Eye, EyeOff, Loader2, User, Mail, Phone, Lock, ArrowLeft, Check, X } from "lucide-react" import AnimatedBackground from "@/components/animated-background" import { useAuth } from "@/contexts/auth-context" import { toast } from "sonner" export default function RegisterPage() { const [showPassword, setShowPassword] = useState(false) const [showConfirmPassword, setShowConfirmPassword] = useState(false) const [agreedToTerms, setAgreedToTerms] = useState(false) const [isLoading, setIsLoading] = useState(false) const [formData, setFormData] = useState({ name: "", email: "", phone: "", password: "", password_confirmation: "", }) const { register } = useAuth() const router = useRouter() const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => { const { name, value } = e.target setFormData((prev) => ({ ...prev, [name]: value })) } const formatPhoneNumber = (value: string) => { const numbers = value.replace(/\D/g, "") if (numbers.startsWith("7") || numbers.startsWith("8")) { return "+7" + numbers.slice(1).slice(0, 10) } else if (numbers.length > 0) { return "+7" + numbers.slice(0, 10) } return "" } const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => { const formatted = formatPhoneNumber(e.target.value) setFormData((prev) => ({ ...prev, phone: formatted })) } // Password strength calculation const getPasswordStrength = (password: string) => { let strength = 0 const checks = { length: password.length >= 8, uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), numbers: /\d/.test(password), special: /[!@#$%^&*(),.?":{}|<>]/.test(password), } Object.values(checks).forEach((check) => { if (check) strength += 20 }) return { strength, checks } } const passwordStrength = getPasswordStrength(formData.password) const validateForm = (): boolean => { if (!formData.name || !formData.email || !formData.phone || !formData.password || !formData.password_confirmation) { toast.error("Заполните все поля") return false } if (formData.password !== formData.password_confirmation) { toast.error("Пароли не совпадают") return false } if (passwordStrength.strength < 80) { toast.error("Пароль должен быть более надежным") return false } if (!agreedToTerms) { toast.error("Необходимо принять условия использования") return false } return true } const handleSubmit = async (e: React.FormEvent) => { e.preventDefault() if (!validateForm()) return setIsLoading(true) try { await register(formData) } catch (error: any) { toast.error(error.message || "Ошибка регистрации") } finally { setIsLoading(false) } } const getStrengthColor = (strength: number) => { if (strength < 40) return "bg-red-500" if (strength < 60) return "bg-yellow-500" if (strength < 80) return "bg-blue-500" return "bg-green-500" } const getStrengthText = (strength: number) => { if (strength < 40) return "Слабый" if (strength < 60) return "Средний" if (strength < 80) return "Хороший" return "Отличный" } return ( <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 relative overflow-hidden"> <AnimatedBackground /> {/* Header */} <div className="absolute top-0 left-0 right-0 z-20 p-4 sm:p-6"> <div className="flex items-center justify-between max-w-7xl mx-auto"> <Button variant="ghost" className="text-white/80 hover:text-white hover:bg-white/10" onClick={() => router.push("/")} > <ArrowLeft className="w-4 h-4 mr-2" /> На главную </Button> <div className="text-xl sm:text-2xl font-bold bg-gradient-to-r from-white via-purple-100 to-blue-100 bg-clip-text text-transparent"> NEUROX </div> </div> </div> {/* Main Content */} <div className="flex items-center justify-center min-h-screen p-4 pt-20"> <div className="w-full max-w-lg relative z-10"> <Card className="bg-white/95 backdrop-blur-sm border-0 shadow-2xl"> <CardHeader className="space-y-2 text-center pb-6"> <div className="mx-auto w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center mb-4"> <User className="w-8 h-8 text-white" /> </div> <CardTitle className="text-2xl sm:text-3xl font-bold text-gray-900">Создать аккаунт</CardTitle> <CardDescription className="text-gray-600 text-base"> Присоединяйтесь к NEUROX и начните создавать AI-агентов </CardDescription> </CardHeader> <CardContent className="space-y-6"> <form onSubmit={handleSubmit} className="space-y-5"> <div className="space-y-2"> <Label htmlFor="name" className="text-sm font-medium text-gray-700"> Полное имя </Label> <div className="relative"> <User className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="name" name="name" type="text" placeholder="Иван Иванов" value={formData.name} onChange={handleInputChange} className="pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> </div> </div> <div className="space-y-2"> <Label htmlFor="email" className="text-sm font-medium text-gray-700"> Email адрес </Label> <div className="relative"> <Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="email" name="email" type="email" placeholder="example@email.com" value={formData.email} onChange={handleInputChange} className="pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> </div> </div> <div className="space-y-2"> <Label htmlFor="phone" className="text-sm font-medium text-gray-700"> Номер телефона </Label> <div className="relative"> <Phone className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="phone" name="phone" type="tel" placeholder="+7 (999) 123-45-67" value={formData.phone} onChange={handlePhoneChange} className="pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> </div> </div> <div className="space-y-2"> <Label htmlFor="password" className="text-sm font-medium text-gray-700"> Пароль </Label> <div className="relative"> <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="password" name="password" type={showPassword ? "text" : "password"} placeholder="Создайте надежный пароль" value={formData.password} onChange={handleInputChange} className="pl-10 pr-12 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors" disabled={isLoading} > {showPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />} </button> </div> {formData.password && ( <div className="space-y-2"> <div className="flex items-center justify-between text-xs"> <span className="text-gray-600">Надежность пароля:</span> <span className={`font-medium ${passwordStrength.strength >= 80 ? "text-green-600" : passwordStrength.strength >= 60 ? "text-blue-600" : passwordStrength.strength >= 40 ? "text-yellow-600" : "text-red-600"}`} > {getStrengthText(passwordStrength.strength)} </span> </div> <Progress value={passwordStrength.strength} className={`h-2 ${getStrengthColor(passwordStrength.strength)}`} /> <div className="grid grid-cols-2 gap-2 text-xs"> {Object.entries({ "Минимум 8 символов": passwordStrength.checks.length, "Заглавные буквы": passwordStrength.checks.uppercase, "Строчные буквы": passwordStrength.checks.lowercase, Цифры: passwordStrength.checks.numbers, }).map(([label, check]) => ( <div key={label} className="flex items-center gap-1"> {check ? ( <Check className="w-3 h-3 text-green-500" /> ) : ( <X className="w-3 h-3 text-red-500" /> )} <span className={check ? "text-green-600" : "text-red-600"}>{label}</span> </div> ))} </div> </div> )} </div> <div className="space-y-2"> <Label htmlFor="password_confirmation" className="text-sm font-medium text-gray-700"> Подтвердите пароль </Label> <div className="relative"> <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /> <Input id="password_confirmation" name="password_confirmation" type={showConfirmPassword ? "text" : "password"} placeholder="Повторите пароль" value={formData.password_confirmation} onChange={handleInputChange} className="pl-10 pr-12 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500" disabled={isLoading} required /> <button type="button" onClick={() => setShowConfirmPassword(!showConfirmPassword)} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors" disabled={isLoading} > {showConfirmPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />} </button> </div> {formData.password_confirmation && formData.password !== formData.password_confirmation && ( <p className="text-red-600 text-xs flex items-center gap-1"> <X className="w-3 h-3" /> Пароли не совпадают </p> )} </div> <div className="flex items-start space-x-3"> <Checkbox id="terms" checked={agreedToTerms} onCheckedChange={(checked) => setAgreedToTerms(checked as boolean)} disabled={isLoading} className="mt-1" /> <label htmlFor="terms" className="text-sm text-gray-600 cursor-pointer leading-relaxed"> Я согласен с{" "} <Link href="/terms" className="text-purple-600 hover:text-purple-700 font-medium" target="_blank"> условиями использования </Link>{" "} и{" "} <Link href="/privacy" className="text-purple-600 hover:text-purple-700 font-medium" target="_blank"> политикой конфиденциальности </Link> </label> </div> <Button type="submit" className="w-full h-12 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200" disabled={isLoading || !agreedToTerms || passwordStrength.strength < 80} > {isLoading ? ( <> <Loader2 className="mr-2 h-5 w-5 animate-spin" /> Создание аккаунта... </> ) : ( "Создать аккаунт" )} </Button> </form> <div className="relative"> <div className="absolute inset-0 flex items-center"> <span className="w-full border-t border-gray-200" /> </div> <div className="relative flex justify-center text-xs uppercase"> <span className="bg-white px-2 text-gray-500">или</span> </div> </div> <div className="text-center"> <span className="text-gray-600">Уже есть аккаунт? </span> <Link href="/login" className="text-purple-600 hover:text-purple-700 font-medium transition-colors"> Войти </Link> </div> </CardContent> </Card> {/* Additional Info */} <div className="mt-8 text-center"> <p className="text-white/80 text-sm"> Регистрируясь, вы получаете доступ к мощным инструментам для создания AI-агентов </p> </div> </div> </div> </div> ) }
```

# app\reset-password\page.tsx

```tsx
'use client'; import type React from 'react'; import { useState } from 'react'; import Link from 'next/link'; import { useRouter } from 'next/navigation'; import { Button } from '@/components/ui/button'; import { Card, CardContent, CardDescription, CardHeader, CardTitle, } from '@/components/ui/card'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Alert, AlertDescription } from '@/components/ui/alert'; import { Progress } from '@/components/ui/progress'; import { ArrowLeft, Mail, Lock, Eye, EyeOff, Loader2, CheckCircle, AlertTriangle, Key, Shield, Clock, Check, X, } from 'lucide-react'; import AnimatedBackground from '@/components/animated-background'; import { toast } from 'sonner'; type Step = 'email' | 'code' | 'password' | 'success'; export default function ResetPasswordPage() { const router = useRouter(); const [currentStep, setCurrentStep] = useState<Step>('email'); const [isLoading, setIsLoading] = useState(false); const [email, setEmail] = useState(''); const [code, setCode] = useState(''); const [newPassword, setNewPassword] = useState(''); const [confirmPassword, setConfirmPassword] = useState(''); const [showPassword, setShowPassword] = useState(false); const [showConfirmPassword, setShowConfirmPassword] = useState(false); const [timeLeft, setTimeLeft] = useState(300); // 5 minutes // Password strength calculation const getPasswordStrength = (password: string) => { let strength = 0; const checks = { length: password.length >= 8, uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), numbers: /\d/.test(password), special: /[!@#$%^&*(),.?":{}|<>]/.test(password), }; Object.values(checks).forEach((check) => { if (check) strength += 20; }); return { strength, checks }; }; const passwordStrength = getPasswordStrength(newPassword); const getStrengthColor = (strength: number) => { if (strength < 40) return 'bg-red-500'; if (strength < 60) return 'bg-yellow-500'; if (strength < 80) return 'bg-blue-500'; return 'bg-green-500'; }; const getStrengthText = (strength: number) => { if (strength < 40) return 'Слабый'; if (strength < 60) return 'Средний'; if (strength < 80) return 'Хороший'; return 'Отличный'; }; const handleEmailSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!email) { toast.error('Введите email адрес'); return; } setIsLoading(true); try { // Simulate API call await new Promise((resolve) => setTimeout(resolve, 2000)); toast.success('Код восстановления отправлен на email'); setCurrentStep('code'); // Start countdown const timer = setInterval(() => { setTimeLeft((prev) => { if (prev <= 1) { clearInterval(timer); return 0; } return prev - 1; }); }, 1000); } catch (error) { toast.error('Ошибка отправки кода'); } finally { setIsLoading(false); } }; const handleCodeSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!code || code.length !== 6) { toast.error('Введите 6-значный код'); return; } setIsLoading(true); try { // Simulate API call await new Promise((resolve) => setTimeout(resolve, 1500)); toast.success('Код подтвержден'); setCurrentStep('password'); } catch (error) { toast.error('Неверный код'); } finally { setIsLoading(false); } }; const handlePasswordSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!newPassword || !confirmPassword) { toast.error('Заполните все поля'); return; } if (newPassword !== confirmPassword) { toast.error('Пароли не совпадают'); return; } if (passwordStrength.strength < 80) { toast.error('Пароль должен быть более надежным'); return; } setIsLoading(true); try { // Simulate API call await new Promise((resolve) => setTimeout(resolve, 2000)); toast.success('Пароль успешно изменен'); setCurrentStep('success'); } catch (error) { toast.error('Ошибка изменения пароля'); } finally { setIsLoading(false); } }; const handleResendCode = async () => { setIsLoading(true); try { await new Promise((resolve) => setTimeout(resolve, 1000)); toast.success('Код отправлен повторно'); setTimeLeft(300); } catch (error) { toast.error('Ошибка отправки кода'); } finally { setIsLoading(false); } }; const formatTime = (seconds: number) => { const mins = Math.floor(seconds / 60); const secs = seconds % 60; return `${mins}:${secs.toString().padStart(2, '0')}`; }; const getStepProgress = () => { switch (currentStep) { case 'email': return 25; case 'code': return 50; case 'password': return 75; case 'success': return 100; default: return 0; } }; return ( <div className='min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 relative overflow-hidden'> <AnimatedBackground /> {/* Header */} <div className='absolute top-0 left-0 right-0 z-20 p-4 sm:p-6'> <div className='flex items-center justify-between max-w-7xl mx-auto'> <Button variant='ghost' className='text-white/80 hover:text-white hover:bg-white/10' onClick={() => router.push('/login')} > <ArrowLeft className='w-4 h-4 mr-2' /> Вернуться к входу </Button> <Link href='/' className='text-xl sm:text-2xl font-bold bg-gradient-to-r from-white via-purple-100 to-blue-100 bg-clip-text text-transparent' > NEUROX </Link> </div> </div> {/* Main Content */} <div className='flex items-center justify-center min-h-screen p-4 pt-20'> <div className='w-full max-w-md relative z-10'> {/* Progress Bar */} <div className='mb-8'> <div className='flex items-center justify-between mb-2'> <span className='text-white/80 text-sm'> Восстановление пароля </span> <span className='text-white/80 text-sm'> {getStepProgress()}% </span> </div> <Progress value={getStepProgress()} className='h-2 bg-white/20' /> </div> <Card className='bg-white/95 backdrop-blur-sm border-0 shadow-2xl'> {/* Email Step */} {currentStep === 'email' && ( <> <CardHeader className='space-y-2 text-center pb-6'> <div className='mx-auto w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center mb-4'> <Mail className='w-8 h-8 text-white' /> </div> <CardTitle className='text-2xl sm:text-3xl font-bold text-gray-900'> Восстановление пароля </CardTitle> <CardDescription className='text-gray-600 text-base'> Введите email адрес для получения кода восстановления </CardDescription> </CardHeader> <CardContent className='space-y-6'> <form onSubmit={handleEmailSubmit} className='space-y-5'> <div className='space-y-2'> <Label htmlFor='email' className='text-sm font-medium text-gray-700' > Email адрес </Label> <div className='relative'> <Mail className='absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5' /> <Input id='email' type='email' placeholder='example@email.com' value={email} onChange={(e) => setEmail(e.target.value)} className='pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500' disabled={isLoading} required /> </div> </div> <Alert className='bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-600'> <AlertTriangle className='h-4 w-4 text-blue-600' /> <AlertDescription className='text-blue-800 dark:text-blue-200'> Мы отправим 6-значный код на указанный email адрес. Код действителен в течение 5 минут. </AlertDescription> </Alert> <Button type='submit' className='w-full h-12 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200' disabled={isLoading} > {isLoading ? ( <> <Loader2 className='mr-2 h-5 w-5 animate-spin' /> Отправка кода... </> ) : ( <> <Mail className='mr-2 h-5 w-5' /> Отправить код </> )} </Button> </form> <div className='text-center'> <span className='text-gray-600'>Вспомнили пароль? </span> <Link href='/login' className='text-purple-600 hover:text-purple-700 font-medium transition-colors' > Войти </Link> </div> </CardContent> </> )} {/* Code Verification Step */} {currentStep === 'code' && ( <> <CardHeader className='space-y-2 text-center pb-6'> <div className='mx-auto w-16 h-16 bg-gradient-to-br from-green-600 to-teal-600 rounded-2xl flex items-center justify-center mb-4'> <Key className='w-8 h-8 text-white' /> </div> <CardTitle className='text-2xl sm:text-3xl font-bold text-gray-900'> Введите код </CardTitle> <CardDescription className='text-gray-600 text-base'> Мы отправили 6-значный код на {email} </CardDescription> </CardHeader> <CardContent className='space-y-6'> <form onSubmit={handleCodeSubmit} className='space-y-5'> <div className='space-y-2'> <Label htmlFor='code' className='text-sm font-medium text-gray-700' > Код подтверждения </Label> <div className='relative'> <Key className='absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5' /> <Input id='code' type='text' placeholder='123456' value={code} onChange={(e) => setCode( e.target.value.replace(/\D/g, '').slice(0, 6) ) } className='pl-10 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500 text-center text-lg font-mono tracking-widest' disabled={isLoading} maxLength={6} required /> </div> </div> {timeLeft > 0 ? ( <div className='flex items-center justify-center gap-2 text-sm text-gray-600'> <Clock className='w-4 h-4' /> <span>Код действителен еще {formatTime(timeLeft)}</span> </div> ) : ( <Alert className='bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-600'> <AlertTriangle className='h-4 w-4 text-red-600' /> <AlertDescription className='text-red-800 dark:text-red-200'> Время действия кода истекло. Запросите новый код. </AlertDescription> </Alert> )} <Button type='submit' className='w-full h-12 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200' disabled={isLoading || code.length !== 6} > {isLoading ? ( <> <Loader2 className='mr-2 h-5 w-5 animate-spin' /> Проверка кода... </> ) : ( <> <CheckCircle className='mr-2 h-5 w-5' /> Подтвердить код </> )} </Button> </form> <div className='text-center'> <span className='text-gray-600'>Не получили код? </span> <button onClick={handleResendCode} disabled={isLoading || timeLeft > 0} className='text-purple-600 hover:text-purple-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed' > Отправить повторно </button> </div> </CardContent> </> )} {/* New Password Step */} {currentStep === 'password' && ( <> <CardHeader className='space-y-2 text-center pb-6'> <div className='mx-auto w-16 h-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mb-4'> <Lock className='w-8 h-8 text-white' /> </div> <CardTitle className='text-2xl sm:text-3xl font-bold text-gray-900'> Новый пароль </CardTitle> <CardDescription className='text-gray-600 text-base'> Создайте надежный пароль для вашего аккаунта </CardDescription> </CardHeader> <CardContent className='space-y-6'> <form onSubmit={handlePasswordSubmit} className='space-y-5'> <div className='space-y-2'> <Label htmlFor='new-password' className='text-sm font-medium text-gray-700' > Новый пароль </Label> <div className='relative'> <Lock className='absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5' /> <Input id='new-password' type={showPassword ? 'text' : 'password'} placeholder='Создайте надежный пароль' value={newPassword} onChange={(e) => setNewPassword(e.target.value)} className='pl-10 pr-12 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500' disabled={isLoading} required /> <button type='button' onClick={() => setShowPassword(!showPassword)} className='absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors' disabled={isLoading} > {showPassword ? ( <EyeOff className='h-5 w-5' /> ) : ( <Eye className='h-5 w-5' /> )} </button> </div> {newPassword && ( <div className='space-y-2'> <div className='flex items-center justify-between text-xs'> <span className='text-gray-600'> Надежность пароля: </span> <span className={`font-medium ${ passwordStrength.strength >= 80 ? 'text-green-600' : passwordStrength.strength >= 60 ? 'text-blue-600' : passwordStrength.strength >= 40 ? 'text-yellow-600' : 'text-red-600' }`} > {getStrengthText(passwordStrength.strength)} </span> </div> <Progress value={passwordStrength.strength} className={`h-2 ${getStrengthColor( passwordStrength.strength )}`} /> <div className='grid grid-cols-2 gap-2 text-xs'> {Object.entries({ 'Минимум 8 символов': passwordStrength.checks.length, 'Заглавные буквы': passwordStrength.checks.uppercase, 'Строчные буквы': passwordStrength.checks.lowercase, Цифры: passwordStrength.checks.numbers, }).map(([label, check]) => ( <div key={label} className='flex items-center gap-1' > {check ? ( <Check className='w-3 h-3 text-green-500' /> ) : ( <X className='w-3 h-3 text-red-500' /> )} <span className={ check ? 'text-green-600' : 'text-red-600' } > {label} </span> </div> ))} </div> </div> )} </div> <div className='space-y-2'> <Label htmlFor='confirm-password' className='text-sm font-medium text-gray-700' > Подтвердите пароль </Label> <div className='relative'> <Lock className='absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5' /> <Input id='confirm-password' type={showConfirmPassword ? 'text' : 'password'} placeholder='Повторите пароль' value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} className='pl-10 pr-12 h-12 border-gray-200 focus:border-purple-500 focus:ring-purple-500' disabled={isLoading} required /> <button type='button' onClick={() => setShowConfirmPassword(!showConfirmPassword) } className='absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors' disabled={isLoading} > {showConfirmPassword ? ( <EyeOff className='h-5 w-5' /> ) : ( <Eye className='h-5 w-5' /> )} </button> </div> {confirmPassword && newPassword !== confirmPassword && ( <p className='text-red-600 text-xs flex items-center gap-1'> <X className='w-3 h-3' /> Пароли не совпадают </p> )} </div> <Button type='submit' className='w-full h-12 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200' disabled={ isLoading || passwordStrength.strength < 80 || newPassword !== confirmPassword } > {isLoading ? ( <> <Loader2 className='mr-2 h-5 w-5 animate-spin' /> Сохранение пароля... </> ) : ( <> <Shield className='mr-2 h-5 w-5' /> Сохранить пароль </> )} </Button> </form> </CardContent> </> )} {/* Success Step */} {currentStep === 'success' && ( <> <CardHeader className='space-y-2 text-center pb-6'> <div className='mx-auto w-16 h-16 bg-gradient-to-br from-green-600 to-emerald-600 rounded-2xl flex items-center justify-center mb-4'> <CheckCircle className='w-8 h-8 text-white' /> </div> <CardTitle className='text-2xl sm:text-3xl font-bold text-gray-900'> Пароль изменен! </CardTitle> <CardDescription className='text-gray-600 text-base'> Ваш пароль успешно изменен. Теперь вы можете войти в систему с новым паролем. </CardDescription> </CardHeader> <CardContent className='space-y-6'> <div className='bg-green-50 p-4 rounded-lg border border-green-200'> <div className='flex items-center gap-3'> <CheckCircle className='w-5 h-5 text-green-600 flex-shrink-0' /> <div> <p className='font-medium text-green-900'> Пароль успешно обновлен </p> <p className='text-green-700 text-sm'> Используйте новый пароль для входа в систему </p> </div> </div> </div> <div className='space-y-3'> <Button onClick={() => router.push('/login')} className='w-full h-12 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium text-base shadow-lg hover:shadow-xl transition-all duration-200' > <CheckCircle className='mr-2 h-5 w-5' /> Войти в систему </Button> <Button variant='outline' onClick={() => router.push('/')} className='w-full h-12 border-gray-200 hover:bg-gray-50' > На главную страницу </Button> </div> <Alert className='bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-600'> <Shield className='h-4 w-4 text-blue-600' /> <AlertDescription className='text-blue-800 dark:text-blue-200'> <strong>Рекомендация:</strong> Для дополнительной безопасности рассмотрите возможность включения двухфакторной аутентификации в настройках аккаунта. </AlertDescription> </Alert> </CardContent> </> )} </Card> {/* Additional Info */} <div className='mt-8 text-center'> <p className='text-white/80 text-sm'> Нужна помощь?{' '} <Link href='mailto:support@neurox.ru' className='text-white underline hover:text-purple-200' > Свяжитесь с поддержкой </Link> </p> </div> </div> </div> </div> ); }
```

# app\settings\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Textarea } from '@/components/ui/textarea'; import { Switch } from '@/components/ui/switch'; import { Slider } from '@/components/ui/slider'; import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'; import { Collapsible, CollapsibleContent, CollapsibleTrigger, } from '@/components/ui/collapsible'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Checkbox } from '@/components/ui/checkbox'; import { ChevronDown, ChevronUp, Settings2, HelpCircle } from 'lucide-react'; import { useAgentStore } from '@/lib/agent-store'; import { useAgents } from '@/hooks/use-agents'; import { toast } from 'sonner'; import { useRouter } from 'next/navigation'; import { useAuth } from '@/contexts/auth-context'; export default function SettingsPage() { const router = useRouter(); const { selectedAgent, updateAgent: updateStoreAgent } = useAgentStore(); const { updateAgent: updateBackendAgent } = useAgents({ autoLoad: false }); const { user } = useAuth(); const [temperature, setTemperature] = useState([0.7]); const [agentName, setAgentName] = useState(''); const [instructions, setInstructions] = useState(''); const [isDialogManagementOpen, setIsDialogManagementOpen] = useState(false); const [isKnowledgeBaseOpen, setIsKnowledgeBaseOpen] = useState(false); const [isToolsOpen, setIsToolsOpen] = useState(false); const [isGuardrailsOpen, setIsGuardrailsOpen] = useState(false); const [isLoading, setIsLoading] = useState(false); // Настройки агента из бэкенда const [enableFunctions, setEnableFunctions] = useState(true); const [talkativeness, setTalkativeness] = useState([50]); const [isRobotQuestion, setIsRobotQuestion] = useState(false); const [llmModel, setLlmModel] = useState('gpt-4o-mini-2024-07-18'); const [timezone, setTimezone] = useState('UTC'); // Синхронизация с выбранным агентом - обновлено для правильной работы useEffect(() => { if (selectedAgent) { setAgentName(selectedAgent.name || ''); setInstructions(selectedAgent.instructions || selectedAgent.prompt || ''); setTemperature([selectedAgent.temperature || 0.7]); setEnableFunctions(selectedAgent.enable_functions ?? true); setTalkativeness([selectedAgent.talkativeness || 50]); setIsRobotQuestion(selectedAgent.is_robot_question === 'yes'); // Исправление для модели - проверяем все возможные поля const model = selectedAgent.llmModel || 'gpt-4o-mini-2024-07-18'; setLlmModel(model); setTimezone(selectedAgent.timezone || 'UTC'); } }, [selectedAgent]); const handleSave = async () => { if (!selectedAgent) { toast.error('Выберите агента для настройки'); return; } try { setIsLoading(true); const updatedAgent = { ...selectedAgent, name: agentName, company_id: user?.company_id, temperature: temperature[0], talkativeness: talkativeness[0], is_robot_question: isRobotQuestion ? 'yes' : 'no', llmModel: llmModel, // llm_model: llmModel, // Дублируем для совместимости timezone: timezone, prompt: instructions, // instructions: instructions, // Дублируем для совместимости // enable_functions: enableFunctions, }; const result = await updateBackendAgent(selectedAgent.id, updatedAgent); if (result) { updateStoreAgent(result); toast.success('Настройки сохранены'); } } catch (error) { console.error('Error saving settings:', error); toast.error('Ошибка при сохранении настроек'); } finally { setIsLoading(false); } }; if (!selectedAgent) { return ( <div className='flex h-screen bg-background'> <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-4xl mx-auto'> <Card> <CardContent className='flex flex-col items-center justify-center py-12'> <Settings2 className='h-12 w-12 text-muted-foreground mb-4' /> <p className='text-lg text-muted-foreground text-center'> Выберите агента для настройки </p> <Button className='mt-4' onClick={() => router.push('/agents')} > Перейти к агентам </Button> </CardContent> </Card> </div> </main> </div> </div> ); } return ( <div className='flex h-screen bg-background'> <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-4xl mx-auto space-y-6'> {/* Basic Settings */} <Card> <CardHeader> <CardTitle>Основные настройки</CardTitle> </CardHeader> <CardContent className='space-y-6'> <div className='space-y-2'> <Label htmlFor='agent-name'>Имя агента</Label> <Input id='agent-name' value={agentName} onChange={(e) => setAgentName(e.target.value)} placeholder='Введите имя агента' /> </div> <div className='space-y-2'> <Label htmlFor='model'>Модель</Label> <Select value={llmModel} onValueChange={setLlmModel}> <SelectTrigger id='model'> <SelectValue placeholder='Выберите модель' /> </SelectTrigger> <SelectContent> <SelectItem value='gpt-3.5-turbo-0125'> GPT-3.5 Turbo (0125) </SelectItem> <SelectItem value='gpt-4-turbo-2024-04-09'> GPT-4 Turbo (2024-04-09) </SelectItem> <SelectItem value='gpt-4o-2024-08-06'> GPT-4o (2024-08-06) </SelectItem> <SelectItem value='gpt-4o-mini-2024-07-18'> GPT-4o Mini (2024-07-18) </SelectItem> <SelectItem value='gpt-4o-search-preview-2025-03-11'> GPT-4o Search Preview (2025-03-11) </SelectItem> <SelectItem value='gpt-4.5-preview-2025-02-27'> GPT-4.5 Preview (2025-02-27) </SelectItem> <SelectItem value='o4-mini-2025-04-16'> O4 Mini (2025-04-16) </SelectItem> <SelectItem value='gpt-4.1-nano-2025-04-14'> GPT-4.1 Nano (2025-04-14) </SelectItem> <SelectItem value='gpt-4.1-mini-2025-04-14'> GPT-4.1 Mini (2025-04-14) </SelectItem> </SelectContent> </Select> </div> <div className='space-y-2'> <Label htmlFor='instructions'>Инструкции</Label> <Textarea id='instructions' value={instructions} onChange={(e) => setInstructions(e.target.value)} placeholder='Опишите, как должен вести себя агент...' className='min-h-[150px]' /> <p className='text-sm text-muted-foreground'> Подробные инструкции помогут агенту лучше понимать свою роль </p> </div> <div className='space-y-2'> <div className='flex items-center justify-between'> <Label htmlFor='temperature'> Температура: {temperature[0]} </Label> <HelpCircle className='h-4 w-4 text-muted-foreground' /> </div> <Slider id='temperature' min={0} max={2} step={0.1} value={temperature} onValueChange={setTemperature} /> <p className='text-sm text-muted-foreground'> Контролирует креативность ответов (0 = точные, 2 = креативные) </p> </div> <div className='space-y-2'> <div className='flex items-center justify-between'> <Label htmlFor='talkativeness'> Разговорчивость: {talkativeness[0]}% </Label> </div> <Slider id='talkativeness' min={0} max={100} step={10} value={talkativeness} onValueChange={setTalkativeness} /> <p className='text-sm text-muted-foreground'> Насколько подробными будут ответы агента </p> </div> <div className='flex items-center space-x-2'> <Switch id='enable-functions' checked={enableFunctions} onCheckedChange={setEnableFunctions} /> <Label htmlFor='enable-functions'>Включить функции</Label> </div> <div className='flex items-center space-x-2'> <Switch id='robot-question' checked={isRobotQuestion} onCheckedChange={setIsRobotQuestion} /> <Label htmlFor='robot-question'> Спрашивать "Вы робот?" при первом контакте </Label> </div> <div className='space-y-2'> <Label htmlFor='timezone'>Часовой пояс</Label> <Select value={timezone} onValueChange={setTimezone}> <SelectTrigger id='timezone'> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value='UTC'>UTC</SelectItem> <SelectItem value='Europe/Moscow'>Москва</SelectItem> <SelectItem value='Asia/Tashkent'>Ташкент</SelectItem> <SelectItem value='America/New_York'>Нью-Йорк</SelectItem> <SelectItem value='Europe/London'>Лондон</SelectItem> <SelectItem value='Asia/Tokyo'>Токио</SelectItem> </SelectContent> </Select> </div> </CardContent> </Card> {/* Dialog Management */} <Collapsible open={isDialogManagementOpen} onOpenChange={setIsDialogManagementOpen} > <Card> <CollapsibleTrigger asChild> <CardHeader className='cursor-pointer'> <div className='flex items-center justify-between'> <CardTitle>Управление диалогом</CardTitle> {isDialogManagementOpen ? ( <ChevronUp className='h-5 w-5' /> ) : ( <ChevronDown className='h-5 w-5' /> )} </div> </CardHeader> </CollapsibleTrigger> <CollapsibleContent> <CardContent className='space-y-4'> <div className='space-y-4'> <div className='flex items-center space-x-2'> <Switch id='greeting' defaultChecked /> <Label htmlFor='greeting'>Приветствие</Label> </div> <Textarea placeholder='Привет! Я ваш виртуальный помощник. Как я могу вам помочь?' className='min-h-[100px]' /> </div> <div className='space-y-4'> <div className='flex items-center space-x-2'> <Switch id='suggested-replies' /> <Label htmlFor='suggested-replies'> Предлагаемые ответы </Label> </div> <p className='text-sm text-muted-foreground'> Показывать пользователям кнопки с вариантами ответов </p> </div> <div className='space-y-4'> <Label>Длина контекста</Label> <RadioGroup defaultValue='auto'> <div className='flex items-center space-x-2'> <RadioGroupItem value='auto' id='context-auto' /> <Label htmlFor='context-auto'>Автоматически</Label> </div> <div className='flex items-center space-x-2'> <RadioGroupItem value='short' id='context-short' /> <Label htmlFor='context-short'> Короткий (5 сообщений) </Label> </div> <div className='flex items-center space-x-2'> <RadioGroupItem value='medium' id='context-medium' /> <Label htmlFor='context-medium'> Средний (10 сообщений) </Label> </div> <div className='flex items-center space-x-2'> <RadioGroupItem value='long' id='context-long' /> <Label htmlFor='context-long'> Длинный (20 сообщений) </Label> </div> </RadioGroup> </div> </CardContent> </CollapsibleContent> </Card> </Collapsible> {/* Knowledge Base */} <Collapsible open={isKnowledgeBaseOpen} onOpenChange={setIsKnowledgeBaseOpen} > <Card> <CollapsibleTrigger asChild> <CardHeader className='cursor-pointer'> <div className='flex items-center justify-between'> <CardTitle>База знаний</CardTitle> {isKnowledgeBaseOpen ? ( <ChevronUp className='h-5 w-5' /> ) : ( <ChevronDown className='h-5 w-5' /> )} </div> </CardHeader> </CollapsibleTrigger> <CollapsibleContent> <CardContent> <div className='flex items-center justify-center py-8'> <Button variant='outline' onClick={() => router.push('/knowledge')} > Перейти к настройке базы знаний </Button> </div> </CardContent> </CollapsibleContent> </Card> </Collapsible> {/* Tools */} <Collapsible open={isToolsOpen} onOpenChange={setIsToolsOpen}> <Card> <CollapsibleTrigger asChild> <CardHeader className='cursor-pointer'> <div className='flex items-center justify-between'> <CardTitle>Инструменты</CardTitle> {isToolsOpen ? ( <ChevronUp className='h-5 w-5' /> ) : ( <ChevronDown className='h-5 w-5' /> )} </div> </CardHeader> </CollapsibleTrigger> <CollapsibleContent> <CardContent className='space-y-4'> <div className='space-y-2'> <div className='flex items-center space-x-2'> <Checkbox id='web-search' disabled={!enableFunctions} /> <Label htmlFor='web-search'>Поиск в интернете</Label> </div> <p className='text-sm text-muted-foreground ml-6'> Позволяет агенту искать актуальную информацию </p> </div> <div className='space-y-2'> <div className='flex items-center space-x-2'> <Checkbox id='calculations' disabled={!enableFunctions} /> <Label htmlFor='calculations'>Вычисления</Label> </div> <p className='text-sm text-muted-foreground ml-6'> Выполнение математических расчетов </p> </div> <div className='space-y-2'> <div className='flex items-center space-x-2'> <Checkbox id='image-generation' disabled={!enableFunctions} /> <Label htmlFor='image-generation'> Генерация изображений </Label> </div> <p className='text-sm text-muted-foreground ml-6'> Создание изображений по текстовому описанию </p> </div> {!enableFunctions && ( <p className='text-sm text-yellow-600 mt-2'> Включите функции в основных настройках для использования инструментов </p> )} </CardContent> </CollapsibleContent> </Card> </Collapsible> {/* Guardrails */} <Collapsible open={isGuardrailsOpen} onOpenChange={setIsGuardrailsOpen} > <Card> <CollapsibleTrigger asChild> <CardHeader className='cursor-pointer'> <div className='flex items-center justify-between'> <CardTitle>Ограничения</CardTitle> {isGuardrailsOpen ? ( <ChevronUp className='h-5 w-5' /> ) : ( <ChevronDown className='h-5 w-5' /> )} </div> </CardHeader> </CollapsibleTrigger> <CollapsibleContent> <CardContent className='space-y-4'> <div className='flex items-center space-x-2'> <Switch id='content-filter' defaultChecked /> <Label htmlFor='content-filter'>Фильтр контента</Label> </div> <div className='flex items-center space-x-2'> <Switch id='personal-data' defaultChecked /> <Label htmlFor='personal-data'> Защита персональных данных </Label> </div> <div className='space-y-2'> <Label>Запрещенные темы</Label> <Textarea placeholder='Введите темы через запятую...' className='min-h-[100px]' /> </div> <div className='space-y-2'> <Label>Максимальная длина ответа</Label> <Select defaultValue='medium'> <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value='short'> Короткий (до 500 символов) </SelectItem> <SelectItem value='medium'> Средний (до 1500 символов) </SelectItem> <SelectItem value='long'> Длинный (до 3000 символов) </SelectItem> <SelectItem value='unlimited'> Без ограничений </SelectItem> </SelectContent> </Select> </div> </CardContent> </CollapsibleContent> </Card> </Collapsible> {/* Save Button */} <div className='flex justify-end'> <Button size='lg' className='bg-purple-600 hover:bg-purple-700' onClick={handleSave} disabled={isLoading} > {isLoading ? 'Сохранение...' : 'СОХРАНИТЬ ИЗМЕНЕНИЯ'} </Button> </div> </div> </main> </div> </div> ); }
```

# app\support\page.tsx

```tsx
'use client'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardDescription, CardHeader, CardTitle, } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { MessageCircle, Users, BookOpen, ExternalLink } from 'lucide-react'; import Link from 'next/link'; export default function SupportPage() { return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-8 overflow-auto'> <div className='max-w-7xl mx-auto'> <div className='mb-6 md:mb-10'> <h1 className='text-2xl md:text-4xl font-bold mb-3'>Поддержка</h1> <p className='text-muted-foreground text-sm md:text-lg'> Выберите подходящий способ обращения за поддержкой или получения информации. </p> </div> <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8'> {/* Техническая поддержка */} <Card className='h-full'> <CardHeader className='text-center pb-6'> <div className='mx-auto mb-6 p-4 bg-purple-100 dark:bg-purple-900 rounded-full w-fit'> <MessageCircle className='h-8 w-8 md:h-10 md:w-10 text-purple-600 dark:text-purple-400' /> </div> <CardTitle className='text-xl md:text-2xl'> Техническая поддержка </CardTitle> <CardDescription className='text-center text-sm md:text-base'> Если вы столкнулись с ошибками или неработающим функционалом, свяжитесь с нашей службой поддержки через Telegram-бот. </CardDescription> </CardHeader> <CardContent className='pt-0'> <Button asChild className='w-full bg-purple-600 hover:bg-purple-700 text-white h-12 md:h-14 text-sm md:text-base' > <Link href='https://t.me/neurox_support_bot' target='_blank' rel='noopener noreferrer' > <MessageCircle className='mr-3 h-4 w-4 md:h-5 md:w-5' />К TELEGRAM-БОТУ <ExternalLink className='ml-3 h-4 w-4 md:h-5 md:w-5' /> </Link> </Button> </CardContent> </Card> {/* Сообщество пользователей */} <Card className='h-full'> <CardHeader className='text-center pb-6'> <div className='mx-auto mb-6 p-4 bg-gray-100 dark:bg-gray-800 rounded-full w-fit'> <Users className='h-8 w-8 md:h-10 md:w-10 text-gray-600 dark:text-gray-400' /> </div> <CardTitle className='text-xl md:text-2xl'> Сообщество пользователей </CardTitle> <CardDescription className='text-center text-sm md:text-base'> Задавайте вопросы другим пользователям и обменивайтесь опытом в нашем сообществе в Telegram. </CardDescription> </CardHeader> <CardContent className='pt-0'> <Button asChild variant='secondary' className='w-full bg-gray-500 hover:bg-gray-600 text-white h-12 md:h-14 text-sm md:text-base' > <Link href='https://t.me/neurox_community' target='_blank' rel='noopener noreferrer' > <Users className='mr-3 h-4 w-4 md:h-5 md:w-5' />В СООБЩЕСТВО <ExternalLink className='ml-3 h-4 w-4 md:h-5 md:w-5' /> </Link> </Button> </CardContent> </Card> {/* Документация */} <Card className='h-full'> <CardHeader className='text-center pb-6'> <div className='mx-auto mb-6 p-4 bg-blue-100 dark:bg-blue-900 rounded-full w-fit'> <BookOpen className='h-8 w-8 md:h-10 md:w-10 text-blue-600 dark:text-blue-400' /> </div> <CardTitle className='text-xl md:text-2xl'> Документация </CardTitle> <CardDescription className='text-center text-sm md:text-base'> Ознакомьтесь с официальной документацией, чтобы лучше понять функционал нашего сервиса. </CardDescription> </CardHeader> <CardContent className='pt-0'> <Button asChild variant='outline' className='w-full border-purple-600 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-950 bg-transparent h-12 md:h-14 text-sm md:text-base' > <Link href='https://docs.neurox.ru' target='_blank' rel='noopener noreferrer' > <BookOpen className='mr-3 h-4 w-4 md:h-5 md:w-5' /> ОТКРЫТЬ ДОКУМЕНТАЦИЮ <ExternalLink className='ml-3 h-4 w-4 md:h-5 md:w-5' /> </Link> </Button> </CardContent> </Card> </div> {/* Дополнительная информация */} <div className='mt-12 md:mt-16 grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8'> <Card> <CardHeader> <CardTitle className='text-lg md:text-xl'> Часто задаваемые вопросы </CardTitle> </CardHeader> <CardContent> <div className='space-y-4'> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Как создать нового агента? </h4> <p className='text-xs md:text-sm text-muted-foreground'> Нажмите на кнопку "+" на главной странице и выберите способ создания агента. </p> </div> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Как изменить модель GPT? </h4> <p className='text-xs md:text-sm text-muted-foreground'> Перейдите в настройки агента и выберите нужную модель в разделе "Выбор языковой модели". </p> </div> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Что такое температура? </h4> <p className='text-xs md:text-sm text-muted-foreground'> Температура контролирует случайность ответов. Низкие значения делают ответы более предсказуемыми. </p> </div> </div> </CardContent> </Card> <Card> <CardHeader> <CardTitle className='text-lg md:text-xl'> Контактная информация </CardTitle> </CardHeader> <CardContent> <div className='space-y-4'> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Техническая поддержка </h4> <p className='text-xs md:text-sm text-muted-foreground'> Доступна 24/7 через Telegram-бот </p> </div> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Время ответа </h4> <p className='text-xs md:text-sm text-muted-foreground'> Обычно отвечаем в течение 2-4 часов </p> </div> <div> <h4 className='font-medium text-sm md:text-base mb-2'> Языки поддержки </h4> <p className='text-xs md:text-sm text-muted-foreground'> Русский, English </p> </div> </div> </CardContent> </Card> </div> </div> </main> </div> </div> ); }
```

# app\terms\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useRouter } from 'next/navigation'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Separator } from '@/components/ui/separator'; import { ArrowLeft, FileText, Shield, Users, CreditCard, AlertTriangle, CheckCircle, Clock, Mail, Phone, } from 'lucide-react'; import AnimatedBackground from '@/components/animated-background'; export default function TermsPage() { const router = useRouter(); return ( <div className='min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-purple-900 relative overflow-hidden'> <AnimatedBackground /> {/* Header */} <div className='absolute top-0 left-0 right-0 z-20 p-4 sm:p-6'> <div className='flex items-center justify-between max-w-4xl mx-auto'> <Button variant='ghost' className='text-white/80 hover:text-white hover:bg-white/10' onClick={() => router.back()} > <ArrowLeft className='w-4 h-4 mr-2' /> Назад </Button> <Link href='/' className='text-xl sm:text-2xl font-bold bg-gradient-to-r from-white via-purple-100 to-blue-100 bg-clip-text text-transparent' > NEUROX </Link> </div> </div> {/* Main Content */} <div className='pt-20 pb-8 px-4 sm:px-6 lg:px-8'> <div className='max-w-4xl mx-auto'> {/* Page Header */} <div className='text-center mb-8 relative z-10'> <div className='inline-flex items-center gap-3 mb-4'> <div className='p-3 bg-white/20 rounded-xl backdrop-blur-sm'> <FileText className='w-8 h-8 text-white' /> </div> <Badge className='bg-white/20 text-white border-white/30'> Версия 1.0 </Badge> </div> <h1 className='text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4'> Условия использования </h1> <p className='text-white/80 text-lg max-w-2xl mx-auto'> Простые и понятные правила использования платформы NEUROX </p> <div className='flex items-center justify-center gap-4 mt-6 text-white/60 text-sm'> <div className='flex items-center gap-2'> <Clock className='w-4 h-4' /> <span>Обновлено: 15 января 2025</span> </div> </div> </div> {/* Content */} <Card className='bg-white/95 backdrop-blur-sm border-0 shadow-xl relative z-10'> <CardContent className='p-8 space-y-8'> {/* Introduction */} <div className='text-center'> <p className='text-gray-700 text-lg leading-relaxed'> Добро пожаловать в NEUROX! Эти условия описывают правила использования нашей платформы для создания AI-агентов. </p> </div> <Separator /> {/* Main Sections */} <div className='space-y-8'> {/* What is NEUROX */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-blue-100 rounded-lg'> <Shield className='w-5 h-5 text-blue-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Что такое NEUROX </h2> </div> <div className='bg-blue-50 p-6 rounded-lg'> <p className='text-gray-700 leading-relaxed'> NEUROX — это платформа для создания умных AI-агентов, которые помогают автоматизировать общение с клиентами. Вы можете создавать ботов для Telegram, WhatsApp, Instagram и других мессенджеров. </p> </div> </section> {/* Registration */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-green-100 rounded-lg'> <Users className='w-5 h-5 text-green-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Регистрация и аккаунт </h2> </div> <div className='space-y-4'> <p className='text-gray-700 leading-relaxed'> Для использования NEUROX вам нужно создать аккаунт. При регистрации укажите: </p> <ul className='space-y-2 text-gray-700 ml-6'> <li className='flex items-start gap-2'> <CheckCircle className='w-4 h-4 text-green-500 mt-1 flex-shrink-0' /> <span>Ваше имя и email</span> </li> <li className='flex items-start gap-2'> <CheckCircle className='w-4 h-4 text-green-500 mt-1 flex-shrink-0' /> <span>Номер телефона</span> </li> <li className='flex items-start gap-2'> <CheckCircle className='w-4 h-4 text-green-500 mt-1 flex-shrink-0' /> <span>Надежный пароль</span> </li> </ul> <div className='bg-amber-50 p-4 rounded-lg border-l-4 border-amber-500'> <p className='text-amber-800 text-sm'> <strong>Важно:</strong> Вы отвечаете за безопасность своего аккаунта. Не передавайте пароль другим людям. </p> </div> </div> </section> {/* Pricing */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-purple-100 rounded-lg'> <CreditCard className='w-5 h-5 text-purple-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Тарифы и оплата </h2> </div> <div className='space-y-4'> <p className='text-gray-700 leading-relaxed'> NEUROX предлагает несколько тарифных планов: </p> <div className='grid grid-cols-1 md:grid-cols-3 gap-4'> <div className='border rounded-lg p-4 text-center'> <h4 className='font-semibold text-gray-900 mb-2'> Тест </h4> <p className='text-2xl font-bold text-green-600 mb-2'> Бесплатно </p> <p className='text-sm text-gray-600'>7 дней</p> </div> <div className='border rounded-lg p-4 text-center border-purple-200 bg-purple-50'> <h4 className='font-semibold text-gray-900 mb-2'> Бизнес </h4> <p className='text-2xl font-bold text-purple-600 mb-2'> ₽2,900 </p> <p className='text-sm text-gray-600'>в месяц</p> </div> <div className='border rounded-lg p-4 text-center'> <h4 className='font-semibold text-gray-900 mb-2'> Премиум </h4> <p className='text-2xl font-bold text-blue-600 mb-2'> ₽4,000 </p> <p className='text-sm text-gray-600'>в месяц</p> </div> </div> <div className='bg-blue-50 p-4 rounded-lg'> <p className='text-blue-800 text-sm'> <strong>BotCoin</strong> — это внутренняя валюта для дополнительных функций. 1 BotCoin = ₽1.40. BotCoin не сгорают и не возвращаются. </p> </div> </div> </section> {/* Rules */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-red-100 rounded-lg'> <AlertTriangle className='w-5 h-5 text-red-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Правила использования </h2> </div> <div className='space-y-4'> <div className='bg-green-50 p-4 rounded-lg'> <h4 className='font-medium text-green-900 mb-2'> ✅ Можно: </h4> <ul className='text-sm text-green-800 space-y-1'> <li>• Создавать AI-агентов для бизнеса</li> <li>• Интегрировать с мессенджерами</li> <li>• Использовать для автоматизации</li> <li>• Получать техническую поддержку</li> </ul> </div> <div className='bg-red-50 p-4 rounded-lg'> <h4 className='font-medium text-red-900 mb-2'> ❌ Нельзя: </h4> <ul className='text-sm text-red-800 space-y-1'> <li>• Использовать для спама</li> <li>• Нарушать законы</li> <li>• Передавать аккаунт другим</li> <li>• Мешать работе системы</li> </ul> </div> </div> </section> {/* Support */} <section className='space-y-4'> <div className='flex items-center gap-3'> <div className='p-2 bg-green-100 rounded-lg'> <Mail className='w-5 h-5 text-green-600' /> </div> <h2 className='text-2xl font-bold text-gray-900'> Поддержка </h2> </div> <div className='bg-gray-50 p-6 rounded-lg'> <div className='grid grid-cols-1 md:grid-cols-2 gap-6'> <div className='space-y-3'> <div className='flex items-center gap-3'> <Mail className='w-5 h-5 text-gray-600' /> <div> <p className='font-medium text-gray-900'>Email</p> <p className='text-gray-700 text-sm'> support@neurox.ru </p> </div> </div> </div> <div className='space-y-3'> <div className='flex items-center gap-3'> <Phone className='w-5 h-5 text-gray-600' /> <div> <p className='font-medium text-gray-900'>Телефон</p> <p className='text-gray-700 text-sm'> +7 (495) 123-45-67 </p> </div> </div> </div> </div> </div> </section> </div> {/* Footer */} <div className='bg-gray-50 p-6 rounded-lg text-center'> <p className='text-gray-600 text-sm mb-4'> Используя NEUROX, вы соглашаетесь с этими условиями. Мы можем обновлять их время от времени. </p> <div className='flex flex-col sm:flex-row items-center justify-center gap-4'> <Button asChild className='bg-purple-600 hover:bg-purple-700'> <Link href='/register'> <Users className='w-4 h-4 mr-2' /> Создать аккаунт </Link> </Button> <Button variant='outline' asChild> <Link href='/privacy'> <Shield className='w-4 h-4 mr-2' /> Политика конфиденциальности </Link> </Button> </div> </div> </CardContent> </Card> </div> </div> </div> ); }
```

# app\test\page.tsx

```tsx
'use client'; export { default } from '@/components/service-bot-test';
```

# app\training\page.tsx

```tsx
'use client'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Plus } from 'lucide-react'; export default function TrainingPage() { return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-4xl mx-auto'> <Card> <CardHeader className='text-center'> <Plus className='h-12 w-12 md:h-16 md:w-16 mx-auto text-purple-600 mb-4' /> <CardTitle className='text-xl md:text-2xl'> Дообучение </CardTitle> </CardHeader> <CardContent className='text-center'> <p className='text-muted-foreground text-sm md:text-base'> Эта страница находится в разработке. Здесь будет возможность дообучения агентов. </p> </CardContent> </Card> </div> </main> </div> </div> ); }
```

# app\website-chat\page.tsx

```tsx
'use client'; import { Header } from '@/components/header'; import { Sidebar } from '@/components/sidebar'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { MessageSquare } from 'lucide-react'; export default function WebsiteChatPage() { return ( <div className='flex h-screen bg-background'> {/* Desktop Sidebar */} <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> <div className='flex-1 flex flex-col min-w-0'> <Header /> <main className='flex-1 p-4 md:p-6 overflow-auto'> <div className='max-w-4xl mx-auto'> <Card> <CardHeader className='text-center'> <MessageSquare className='h-12 w-12 md:h-16 md:w-16 mx-auto text-purple-600 mb-4' /> <CardTitle className='text-xl md:text-2xl'> Чат на сайт </CardTitle> </CardHeader> <CardContent className='text-center'> <p className='text-muted-foreground text-sm md:text-base'> Эта страница находится в разработке. Здесь будет возможность настройки чата для сайта. </p> </CardContent> </Card> </div> </main> </div> </div> ); }
```

# components.json

```json
{ "$schema": "https://ui.shadcn.com/schema.json", "style": "new-york", "rsc": true, "tsx": true, "tailwind": { "config": "", "css": "app/globals.css", "baseColor": "neutral", "cssVariables": true, "prefix": "" }, "aliases": { "components": "@/components", "utils": "@/lib/utils", "ui": "@/components/ui", "lib": "@/lib", "hooks": "@/hooks" }, "iconLibrary": "lucide" }
```

# components\add-agent-card.tsx

```tsx
'use client'; import { useState } from 'react'; import { Card, CardContent } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Input } from '@/components/ui/input'; import { Label } from '@/components/ui/label'; import { Textarea } from '@/components/ui/textarea'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Plus, Bot, Sparkles, Wand2, FileCode } from 'lucide-react'; import type { Agent } from '@/types/agent'; import { toast } from 'sonner'; interface AddAgentCardProps { onAddAgent: (agent: any, isFromCode?: boolean) => void; copiedAgentCode: string | null; } export function AddAgentCard({ onAddAgent, copiedAgentCode, }: AddAgentCardProps) { const [showOptions, setShowOptions] = useState(false); const [showDialog, setShowDialog] = useState(false); const [dialogType, setDialogType] = useState<'default' | 'template' | 'code'>( 'default' ); const [agentName, setAgentName] = useState(''); const [agentDescription, setAgentDescription] = useState(''); const [agentTemplate, setAgentTemplate] = useState('assistant'); const [agentCode, setAgentCode] = useState(''); const templates = { assistant: { name: 'Универсальный помощник', description: 'Помогает с различными задачами и отвечает на вопросы', prompt: 'Ты универсальный AI-помощник. Отвечай дружелюбно и помогай пользователям с их вопросами.', temperature: 0.7, }, support: { name: 'Служба поддержки', description: 'Специализируется на решении проблем клиентов', prompt: 'Ты специалист службы поддержки. Помогай клиентам решать их проблемы вежливо и профессионально.', temperature: 0.5, }, sales: { name: 'Менеджер по продажам', description: 'Помогает с продажами и консультирует клиентов', prompt: 'Ты менеджер по продажам. Консультируй клиентов о продуктах и помогай им сделать выбор.', temperature: 0.6, }, creative: { name: 'Креативный помощник', description: 'Помогает с творческими задачами и генерацией идей', prompt: 'Ты креативный помощник. Помогай с творческими задачами, генерируй идеи и вдохновляй.', temperature: 0.9, }, }; const handlePlusClick = () => { setShowOptions(true); }; const handleAddAgent = (type: 'default' | 'template' | 'code') => { setDialogType(type); setShowDialog(true); if (type === 'code' && copiedAgentCode) { setAgentCode(copiedAgentCode); } }; const createAgent = () => { if (!agentName.trim()) { toast.error('Пожалуйста, введите имя агента.'); return; } let newAgent: Agent; let isFromCode = false; if (dialogType === 'code' && agentCode) { try { const decodedAgent = JSON.parse( decodeURIComponent( atob(agentCode) .split('') .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)) .join('') ) ); newAgent = { ...decodedAgent, id: Date.now().toString(), name: agentName, createdAt: new Date(), status: 'active', }; isFromCode = true; } catch (error) { toast.error('Неверный код агента.'); return; } } else if (dialogType === 'template') { const template = templates[agentTemplate as keyof typeof templates]; newAgent = { id: Date.now().toString(), name: agentName, avatar: '', status: 'active', createdAt: new Date(), expenses: { unavailable: 0, botcoin: 0.0 }, temperature: template.temperature, instructions: template.prompt, llmModel: 'gpt-4o-mini-2024-07-18', // llm_model: "gpt-4o-mini-2024-07-18", totalConversations: 0, company_id: 1, model: '', prompt: template.prompt, enable_functions: true, talkativeness: 50, timezone: 'UTC', settings: {}, is_robot_question: 'no', }; } else { newAgent = { id: Date.now().toString(), name: agentName, avatar: '', model: '', status: 'active', createdAt: new Date(), expenses: { unavailable: 0, botcoin: 0.0 }, temperature: 0.7, instructions: agentDescription || 'Ты полезный AI-помощник.', llmModel: 'gpt-4o-mini-2024-07-18', // llm_model: "gpt-4o-mini-2024-07-18", totalConversations: 0, company_id: 1, prompt: agentDescription || 'Ты полезный AI-помощник.', enable_functions: true, talkativeness: 50, timezone: 'UTC', settings: {}, is_robot_question: 'no', }; } console.log(newAgent, 'newagent'); onAddAgent(newAgent, isFromCode); setShowDialog(false); setAgentName(''); setAgentDescription(''); setAgentCode(''); setShowOptions(false); toast.success(`${newAgent.name} был успешно создан.`); }; return ( <> <Card className='group border-2 border-dashed border-purple-300 hover:border-purple-400 dark:border-purple-700 dark:hover:border-purple-600 transition-all duration-300 hover:shadow-lg bg-gradient-to-br from-purple-50/50 to-blue-50/50 dark:from-purple-900/20 dark:to-blue-900/20 min-h-[320px] md:min-h-[380px]'> <CardContent className='flex flex-col items-center justify-center h-full p-6 md:p-8'> {!showOptions ? ( <button onClick={handlePlusClick} className='flex flex-col items-center space-y-4 p-6 md:p-8 rounded-xl hover:bg-purple-50 dark:hover:bg-purple-900/30 transition-all duration-300 group-hover:scale-105 w-full' > <div className='relative'> <div className='p-6 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full group-hover:from-purple-600 group-hover:to-blue-600 transition-all duration-300 shadow-lg'> <Plus className='h-8 w-8 md:h-10 md:w-10 text-white' /> </div> <div className='absolute -top-1 -right-1 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center'> <Sparkles className='h-3 w-3 text-yellow-800' /> </div> </div> <div className='text-center space-y-2'> <span className='text-lg md:text-xl font-semibold text-gray-900 dark:text-white'> Создать агента </span> <p className='text-sm text-muted-foreground max-w-xs'> Добавьте нового AI-агента для автоматизации задач </p> </div> </button> ) : ( <div className='flex flex-col items-center space-y-6 w-full'> <h3 className='text-lg font-semibold text-center text-gray-900 dark:text-white'> Выберите способ создания </h3> <div className='grid grid-cols-1 gap-4 w-full max-w-sm'> {/* Default Agent */} <button onClick={() => handleAddAgent('default')} className='flex items-center gap-3 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group' > <div className='p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg group-hover:bg-blue-200 dark:group-hover:bg-blue-800/30 transition-colors'> <Bot className='h-5 w-5 text-blue-600 dark:text-blue-400' /> </div> <div className='text-left'> <div className='font-medium text-sm'>Простой агент</div> <div className='text-xs text-muted-foreground'> Базовые настройки </div> </div> </button> {/* Template Agent */} <button onClick={() => handleAddAgent('template')} className='flex items-center gap-3 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group' > <div className='p-2 bg-green-100 dark:bg-green-900/30 rounded-lg group-hover:bg-green-200 dark:group-hover:bg-green-800/30 transition-colors'> <Wand2 className='h-5 w-5 text-green-600 dark:text-green-400' /> </div> <div className='text-left'> <div className='font-medium text-sm'>По шаблону</div> <div className='text-xs text-muted-foreground'> Готовые роли </div> </div> </button> {/* Code Agent */} <button onClick={() => handleAddAgent('code')} disabled={!copiedAgentCode} className='flex items-center gap-3 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed' > <div className='p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg group-hover:bg-orange-200 dark:group-hover:bg-orange-800/30 transition-colors'> <FileCode className='h-5 w-5 text-orange-600 dark:text-orange-400' /> </div> <div className='text-left'> <div className='font-medium text-sm'>Из кода</div> <div className='text-xs text-muted-foreground'> {copiedAgentCode ? 'Код готов' : 'Нет кода'} </div> </div> </button> </div> <Button variant='ghost' onClick={() => setShowOptions(false)} className='text-muted-foreground hover:text-foreground text-sm' > ← Назад </Button> </div> )} </CardContent> </Card> <Dialog open={showDialog} onOpenChange={setShowDialog}> <DialogContent className='w-[95vw] max-w-md mx-auto'> <DialogHeader> <DialogTitle className='text-lg'> {dialogType === 'default' && 'Создать простого агента'} {dialogType === 'template' && 'Создать агента по шаблону'} {dialogType === 'code' && 'Создать агента из кода'} </DialogTitle> <DialogDescription className='text-sm'> {dialogType === 'default' && 'Создайте агента с базовыми настройками'} {dialogType === 'template' && 'Выберите готовый шаблон для быстрого старта'} {dialogType === 'code' && 'Восстановите агента из сохраненного кода'} </DialogDescription> </DialogHeader> <div className='space-y-4'> <div className='space-y-2'> <Label htmlFor='agent-name'>Имя агента *</Label> <Input id='agent-name' value={agentName} onChange={(e) => setAgentName(e.target.value)} placeholder='Введите имя агента' className='w-full' /> </div> {dialogType === 'template' && ( <div className='space-y-2'> <Label htmlFor='agent-template'>Шаблон</Label> <Select value={agentTemplate} onValueChange={setAgentTemplate}> <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> {Object.entries(templates).map(([key, template]) => ( <SelectItem key={key} value={key}> <div className='flex flex-col'> <span className='font-medium'>{template.name}</span> <span className='text-xs text-muted-foreground'> {template.description} </span> </div> </SelectItem> ))} </SelectContent> </Select> </div> )} {dialogType === 'default' && ( <div className='space-y-2'> <Label htmlFor='agent-description'> Описание (опционально) </Label> <Textarea id='agent-description' value={agentDescription} onChange={(e) => setAgentDescription(e.target.value)} placeholder='Опишите, что должен делать агент...' rows={3} /> </div> )} {dialogType === 'code' && ( <div className='space-y-2'> <Label htmlFor='agent-code'>Код агента</Label> <Textarea id='agent-code' value={agentCode} onChange={(e) => setAgentCode(e.target.value)} placeholder='Вставьте код агента сюда' className='font-mono text-xs resize-none overflow-hidden min-h-[120px] max-h-[200px]' style={{ wordBreak: 'break-all', whiteSpace: 'pre-wrap', }} /> <p className='text-xs text-muted-foreground'> Вставьте скопированный код агента для восстановления </p> </div> )} </div> <DialogFooter className='flex-col sm:flex-row gap-2'> <Button variant='outline' onClick={() => setShowDialog(false)}> Отмена </Button> <Button onClick={createAgent} className='bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700' > Создать агента </Button> </DialogFooter> </DialogContent> </Dialog> </> ); }
```

# components\agent-card.tsx

```tsx
'use client'; import type React from 'react'; import { useState } from 'react'; import { Card, CardContent } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Badge } from '@/components/ui/badge'; import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, } from '@/components/ui/dropdown-menu'; import { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, } from '@/components/ui/alert-dialog'; import { Power, Settings, Trash2, MoreHorizontal, Copy, Check, } from 'lucide-react'; import { AvatarSelector } from './avatar-selector'; import { toast } from 'sonner'; import Link from 'next/link'; import { useAuth } from '@/contexts/auth-context'; import { useAgentStore } from '@/lib/agent-store'; interface AgentCardProps { agent: any; isSelected: boolean; onSelect: () => void; onUpdate: (agent: any) => void; onDelete: (agentId: any) => void; onCopyCode: (agent: any) => void; } export function AgentCard({ agent, isSelected, onSelect, onUpdate, onDelete, onCopyCode, }: AgentCardProps) { const [showDeleteDialog, setShowDeleteDialog] = useState(false); const [showAvatarSelector, setShowAvatarSelector] = useState(false); const { user } = useAuth(); const { toggleAgentStatus, getAgentStatus } = useAgentStore(); // Получаем актуальный статус из store const agentStatus = getAgentStatus(agent.id); const handlePowerToggle = (e: React.MouseEvent) => { e.stopPropagation(); toggleAgentStatus(agent.id); const newStatus = agentStatus === 'active' ? 'inactive' : 'active'; toast.success( newStatus === 'active' ? 'Агент активирован' : 'Агент выключен', { description: `${agent.name} теперь ${ newStatus === 'active' ? 'активен' : 'выключен' }.`, } ); }; const handleDelete = () => { onDelete(agent.id); setShowDeleteDialog(false); toast.error('Агент удален', { description: `${agent.name} был удален.`, }); }; const handleAvatarChange = (newAvatar: string) => { onUpdate({ ...agent, avatar: newAvatar, company_id: user?.company_id }); setShowAvatarSelector(false); toast.success('Аватар обновлен', { description: 'Аватар агента был успешно изменен.', }); }; const handleCopyCode = () => { onCopyCode(agent); toast.success('Код скопирован', { description: 'Код агента скопирован в буфер обмена.', }); }; const handleSettingsClick = (e: React.MouseEvent) => { e.stopPropagation(); if (!isSelected) { toast.error('Сначала выберите агента', { description: 'Для доступа к настройкам необходимо выбрать агента.', }); return; } }; return ( <> <Card className={`cursor-pointer transition-all hover:shadow-md min-h-[280px] sm:min-h-[320px] md:min-h-[350px] ${ isSelected ? 'ring-2 ring-purple-500' : '' }`} onClick={onSelect} > <CardContent className='p-2 sm:p-3 md:p-4 flex flex-col h-full'> {/* Avatar Section */} <div className='flex justify-center mb-2 sm:mb-3 md:mb-4 relative'> <Avatar className='h-20 w-20 sm:h-24 sm:w-24 md:h-26 md:w-26 cursor-pointer hover:opacity-80 transition-opacity relative z-0' onClick={(e) => { e.stopPropagation(); setShowAvatarSelector(true); }} > <AvatarImage src={agent.avatar || '/placeholder.svg'} alt={agent.name} /> <AvatarFallback className='text-sm sm:text-base md:text-lg'> {agent.name.charAt(0)} </AvatarFallback> </Avatar> {/* Menu button positioned over avatar */} <DropdownMenu> <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}> <Button variant='ghost' size='icon' className='h-6 w-6 sm:h-7 sm:w-7 md:h-8 md:w-8 absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 bg-background/80 backdrop-blur-sm hover:bg-background/90 border border-border/50 z-0' > <MoreHorizontal className='h-3 w-3 sm:h-4 sm:w-4' /> </Button> </DropdownMenuTrigger> <DropdownMenuContent align='end'> <DropdownMenuItem onClick={handleCopyCode}> <Copy className='mr-2 h-4 w-4' /> Создать код для копирования </DropdownMenuItem> <DropdownMenuItem onClick={(e) => { e.stopPropagation(); setShowDeleteDialog(true); }} className='text-red-600' > <Trash2 className='mr-2 h-4 w-4' /> Удалить </DropdownMenuItem> </DropdownMenuContent> </DropdownMenu> </div> {/* Agent Info */} <div className='space-y-1 sm:space-y-2 mb-2 sm:mb-3 md:mb-4 flex-1 text-center'> <h3 className='font-semibold text-sm sm:text-base md:text-lg line-clamp-2'> {agent.name} </h3> <p className='text-xs sm:text-sm text-muted-foreground truncate'> {agent.llm_model || agent.llmModel || agent.model || 'Модель не указана'} </p> <div className='flex justify-center'> <Badge variant={agentStatus === 'active' ? 'default' : 'secondary'} className={`text-xs px-2 py-1 transition-all ${ agentStatus === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100' }`} > {agentStatus === 'active' ? 'Активный агент' : 'Агент выключен'} </Badge> </div> </div> {/* Action Buttons */} <div className='flex justify-center gap-1 sm:gap-2 mb-2 sm:mb-3 md:mb-4'> <Button variant='ghost' size='icon' onClick={handlePowerToggle} className={`h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 transition-colors ${ agentStatus === 'active' ? 'text-green-600 hover:text-green-700' : 'text-gray-400 hover:text-gray-500' }`} > <Power className='h-4 w-4 sm:h-5 sm:w-5' /> </Button> {/* Settings button - disabled if not selected */} {isSelected ? ( <Button asChild variant='ghost' size='icon' className='h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10' > <Link href='/settings' onClick={handleSettingsClick}> <Settings className='h-4 w-4 sm:h-5 sm:w-5' /> </Link> </Button> ) : ( <Button variant='ghost' size='icon' className='h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 opacity-50 cursor-not-allowed' onClick={handleSettingsClick} disabled > <Settings className='h-4 w-4 sm:h-5 sm:w-5' /> </Button> )} <Button variant='ghost' size='icon' onClick={(e) => { e.stopPropagation(); setShowDeleteDialog(true); }} className='text-red-600 h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10' > <Trash2 className='h-4 w-4 sm:h-5 sm:w-5' /> </Button> </div> {/* Expenses Section */} <div className='border-t pt-2 sm:pt-3 mt-auto'> <div className='space-y-1 text-xs sm:text-sm text-muted-foreground mb-2 sm:mb-3'> <div className='text-xs sm:text-sm font-medium text-foreground mb-1 sm:mb-2'> Расходы </div> <div className='flex justify-between text-xs'> <span>За: недоступно</span> </div> <div className='flex justify-between text-xs'> <span> Расход BotCoin: {agent?.expenses?.botcoin?.toFixed(2) || 0} </span> </div> </div> {/* Selection Status */} <div className='flex items-center justify-center h-6 sm:h-8'> {isSelected ? ( <div className='flex items-center gap-2 text-green-600'> <Check className='h-3 w-3 sm:h-4 sm:w-4' /> <span className='font-medium text-xs sm:text-sm'> ВЫБРАНО </span> </div> ) : ( <span className='text-muted-foreground font-medium text-xs sm:text-sm'> ВЫБРАТЬ </span> )} </div> </div> </CardContent> </Card> <AvatarSelector open={showAvatarSelector} onOpenChange={setShowAvatarSelector} onSelect={handleAvatarChange} currentAvatar={agent.avatar} /> <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}> <AlertDialogContent> <AlertDialogHeader> <AlertDialogTitle>Вы уверены?</AlertDialogTitle> <AlertDialogDescription> Это действие нельзя отменить. Агент "{agent.name}" будет удален навсегда. </AlertDialogDescription> </AlertDialogHeader> <AlertDialogFooter> <AlertDialogCancel>Отмена</AlertDialogCancel> <AlertDialogAction onClick={handleDelete} className='bg-red-600 hover:bg-red-700' > Удалить </AlertDialogAction> </AlertDialogFooter> </AlertDialogContent> </AlertDialog> </> ); }
```

# components\agent-status-toggle.tsx

```tsx
'use client'; import type React from 'react'; import { useEffect, useState } from 'react'; import { Button } from '@/components/ui/button'; import { Power } from 'lucide-react'; import { toast } from 'sonner'; import { useAgentStore } from '@/lib/agent-store'; interface AgentStatusToggleProps { agentId: string; initialStatus: 'active' | 'inactive'; onStatusChange?: (status: 'active' | 'inactive') => void; } export function AgentStatusToggle({ agentId, initialStatus, onStatusChange, }: AgentStatusToggleProps) { const [status, setStatus] = useState<'active' | 'inactive'>(initialStatus); const { toggleAgentStatus } = useAgentStore(); // Синхронизируем локальное состояние с props useEffect(() => { setStatus(initialStatus); }, [initialStatus]); const handleToggle = (e: React.MouseEvent) => { e.stopPropagation(); // Немедленно обновляем локальное состояние для мгновенной обратной связи const newStatus = status === 'active' ? 'inactive' : 'active'; setStatus(newStatus); // Обновляем глобальное состояние toggleAgentStatus(agentId); // Вызываем callback если он предоставлен if (onStatusChange) { onStatusChange(newStatus); } toast.success( newStatus === 'active' ? 'Агент активирован' : 'Агент выключен', { description: `Агент теперь ${ newStatus === 'active' ? 'активен' : 'выключен' }.`, } ); }; return ( <Button variant='ghost' size='icon' onClick={handleToggle} className={`h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 transition-colors ${ status === 'active' ? 'text-green-600 hover:text-green-700' : 'text-gray-400 hover:text-gray-500' }`} > <Power className='h-4 w-4 sm:h-5 sm:w-5' /> </Button> ); }
```

# components\animated-background.tsx

```tsx
'use client'; import { useEffect, useRef } from 'react'; interface Particle { x: number; y: number; vx: number; vy: number; size: number; } export default function AnimatedBackground() { const canvasRef = useRef<HTMLCanvasElement>(null); const particlesRef = useRef<Particle[]>([]); const animationRef = useRef<number>(0); useEffect(() => { const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d'); if (!ctx) return; const resizeCanvas = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }; const createParticles = () => { const particles: Particle[] = []; const particleCount = Math.floor((canvas.width * canvas.height) / 15000); // Responsive particle count for (let i = 0; i < particleCount; i++) { particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, vx: (Math.random() - 0.5) * 1.5, // Slower movement vy: (Math.random() - 0.5) * 1.5, size: Math.random() * 3 + 1, }); } particlesRef.current = particles; }; const drawParticle = (particle: Particle) => { ctx.beginPath(); ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2); ctx.fillStyle = `rgba(196, 181, 253, ${0.6 + Math.random() * 0.4})`; // Purple with varying opacity ctx.fill(); }; const drawConnection = (p1: Particle, p2: Particle, distance: number) => { const maxDistance = 150; const opacity = 1 - distance / maxDistance; ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.strokeStyle = `rgba(139, 92, 246, ${opacity * 0.5})`; // Purple connections ctx.lineWidth = 1.2; ctx.stroke(); }; const updateParticles = () => { const particles = particlesRef.current; particles.forEach((particle) => { // Update position particle.x += particle.vx; particle.y += particle.vy; // Bounce off edges if (particle.x < 0 || particle.x > canvas.width) { particle.vx *= -1; particle.x = Math.max(0, Math.min(canvas.width, particle.x)); } if (particle.y < 0 || particle.y > canvas.height) { particle.vy *= -1; particle.y = Math.max(0, Math.min(canvas.height, particle.y)); } }); }; const animate = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); const particles = particlesRef.current; // Update particle positions updateParticles(); // Draw connections first (so they appear behind particles) for (let i = 0; i < particles.length; i++) { for (let j = i + 1; j < particles.length; j++) { const dx = particles[i].x - particles[j].x; const dy = particles[i].y - particles[j].y; const distance = Math.sqrt(dx * dx + dy * dy); if (distance < 150) { drawConnection(particles[i], particles[j], distance); } } } // Draw particles particles.forEach(drawParticle); animationRef.current = requestAnimationFrame(animate); }; // Initialize resizeCanvas(); createParticles(); animate(); // Handle resize const handleResize = () => { resizeCanvas(); createParticles(); }; window.addEventListener('resize', handleResize); return () => { window.removeEventListener('resize', handleResize); if (animationRef.current) { cancelAnimationFrame(animationRef.current); } }; }, []); return ( <canvas ref={canvasRef} className='absolute inset-0 w-full h-full' style={{ background: 'linear-gradient(135deg, #2a0a42 0%, #4a219a 50%, #2a0a42 100%)', // background: // 'linear-gradient(135deg, #581c87 0%, #7c3aed 50%, #581c87 100%)', }} /> ); }
```

# components\avatar-selector.tsx

```tsx
'use client'; import { useState } from 'react'; import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Button } from '@/components/ui/button'; import { ScrollArea } from '@/components/ui/scroll-area'; interface AvatarSelectorProps { open: boolean; onOpenChange: (open: boolean) => void; onSelect: (avatar: string) => void; currentAvatar: string; } // Генерация 40 различных аватаров const generateAvatars = () => { const avatars = []; for (let i = 1; i <= 40; i++) { avatars.push( `https://api.dicebear.com/9.x/notionists/png?seed=${i}&backgroundColor=b6e3f4,c0aede,d1d4f9` ); } return avatars; }; export function AvatarSelector({ open, onOpenChange, onSelect, currentAvatar, }: AvatarSelectorProps) { const [selectedAvatar, setSelectedAvatar] = useState(currentAvatar); const avatars = generateAvatars(); const handleSelect = () => { onSelect(selectedAvatar); onOpenChange(false); }; return ( <Dialog open={open} onOpenChange={onOpenChange}> <DialogContent className='max-w-2xl'> <DialogHeader> <DialogTitle>Выберите аватар</DialogTitle> <DialogDescription> Выберите аватар для вашего агента из представленных вариантов. </DialogDescription> </DialogHeader> <ScrollArea className='h-96'> <div className='grid grid-cols-8 gap-2 p-2'> {avatars.map((avatar, index) => ( <Avatar key={index} className={`h-12 w-12 cursor-pointer border-2 transition-all hover:scale-105 ${ selectedAvatar === avatar ? 'border-purple-500 ring-2 ring-purple-200' : 'border-transparent' }`} onClick={() => setSelectedAvatar(avatar)} > <AvatarImage src={avatar || '/placeholder.svg'} alt={`Аватар ${index + 1}`} /> <AvatarFallback>{index + 1}</AvatarFallback> </Avatar> ))} </div> </ScrollArea> <div className='flex justify-end gap-2'> <Button variant='outline' onClick={() => onOpenChange(false)}> Отмена </Button> <Button onClick={handleSelect}>Выбрать аватар</Button> </div> </DialogContent> </Dialog> ); }
```

# components\header.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger, } from '@/components/ui/dropdown-menu'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Badge } from '@/components/ui/badge'; import { Sheet, SheetContent, SheetTitle, SheetTrigger, } from '@/components/ui/sheet'; import { Moon, Sun, Mail, User, CreditCard, LogOut, ChevronDown, Bell, Menu, } from 'lucide-react'; import { useTheme } from 'next-themes'; import { useAgentStore } from '@/lib/agent-store'; import { NotificationPanel } from './notification-panel'; import { Sidebar } from './sidebar'; import Link from 'next/link'; import { useAuth } from '@/contexts/auth-context'; export function Header() { const { theme, setTheme } = useTheme(); const { agents, selectedAgent, setSelectedAgent } = useAgentStore(); const [showNotifications, setShowNotifications] = useState(false); const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false); const { user } = useAuth(); const [userInfo] = useState({ name: user?.name, plan: 'Тест', botcoin: 10, reserved: 0, }); // Устанавливаем первого агента как выбранного по умолчанию useEffect(() => { if (!selectedAgent && agents.length > 0) { setSelectedAgent(agents[0]); } }, [agents, selectedAgent, setSelectedAgent]); const getAgentModel = (agent: any) => { return ( agent.llm_model || agent.llmModel || agent.model || 'Модель не указана' ); }; return ( <header className='border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60'> <div className='flex h-14 md:h-16 lg:h-[72px] items-center justify-between px-4 md:px-6 lg:px-7'> {/* Mobile Menu Button */} <div className='flex items-center gap-2 md:hidden'> <Sheet open={isMobileMenuOpen} onOpenChange={setIsMobileMenuOpen}> <SheetTrigger asChild> <Button variant='ghost' size='icon' className='h-8 w-8'> <Menu className='h-5 w-5' /> </Button> </SheetTrigger> <SheetContent side='left' className='p-0 w-68'> <SheetTitle>Меню</SheetTitle> <Sidebar onItemClick={() => setIsMobileMenuOpen(false)} /> </SheetContent> </Sheet> {/* Mobile Logo */} <div className='text-lg font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent'> NEUROX </div> </div> {/* Desktop Left Section */} <div className='hidden md:flex items-center gap-3 lg:gap-5'> {/* Селектор агентов */} <DropdownMenu> <DropdownMenuTrigger asChild> <Button variant='ghost' className='flex items-center gap-2 text-sm h-8 lg:h-10 max-w-[200px] lg:max-w-none' > <span className='truncate'> {selectedAgent?.name || 'Выберите агента'} </span> <ChevronDown className='h-4 w-4 flex-shrink-0' /> </Button> </DropdownMenuTrigger> <DropdownMenuContent align='start' className='w-64 lg:w-72'> {agents.map((agent) => ( <DropdownMenuItem key={agent.id} onClick={() => setSelectedAgent(agent)} className={`flex items-center gap-3 p-3 ${ selectedAgent?.id === agent.id ? 'bg-purple-50 dark:bg-purple-950' : '' }`} > <Avatar className='h-6 w-6 lg:h-8 lg:w-8'> <AvatarImage src={agent.avatar || '/placeholder.svg'} alt={agent.name} /> <AvatarFallback>{agent.name.charAt(0)}</AvatarFallback> </Avatar> <div className='flex flex-col min-w-0'> <span className='font-medium truncate'>{agent.name}</span> <span className='text-xs text-muted-foreground truncate'> {getAgentModel(agent)} </span> </div> </DropdownMenuItem> ))} </DropdownMenuContent> </DropdownMenu> {selectedAgent && ( <Badge variant='secondary' className='text-xs hidden lg:inline-flex' > {getAgentModel(selectedAgent)} </Badge> )} </div> {/* Mobile Agent Selector */} <div className='flex md:hidden items-center'> <DropdownMenu> <DropdownMenuTrigger asChild> <Button variant='ghost' className='flex items-center gap-1 text-xs h-8 px-2' > <span className='truncate max-w-[100px]'> {selectedAgent?.name || 'Агент'} </span> <ChevronDown className='h-3 w-3' /> </Button> </DropdownMenuTrigger> <DropdownMenuContent align='center' className='w-64'> {agents.map((agent) => ( <DropdownMenuItem key={agent.id} onClick={() => setSelectedAgent(agent)} className={`flex items-center gap-3 p-3 ${ selectedAgent?.id === agent.id ? 'bg-purple-50 dark:bg-purple-950' : '' }`} > <Avatar className='h-6 w-6'> <AvatarImage src={agent.avatar || '/placeholder.svg'} alt={agent.name} /> <AvatarFallback>{agent.name.charAt(0)}</AvatarFallback> </Avatar> <div className='flex flex-col min-w-0'> <span className='font-medium truncate'>{agent.name}</span> <span className='text-xs text-muted-foreground truncate'> {getAgentModel(agent)} </span> </div> </DropdownMenuItem> ))} </DropdownMenuContent> </DropdownMenu> </div> {/* Right Section */} <div className='flex items-center gap-2 md:gap-3 lg:gap-5'> {/* Desktop User Info */} <div className='hidden lg:block text-right text-sm'> <div className='flex items-center gap-2'> <span className='text-muted-foreground'>Тариф:</span> <Badge variant='outline'>{userInfo.plan}</Badge> </div> <div className='text-muted-foreground'> BotCoin:{' '} <span className='text-foreground font-medium'> {userInfo.botcoin} </span> </div> </div> {/* Mobile User Info */} <div className='md:hidden text-xs'> <Badge variant='outline' className='text-xs'> {userInfo.plan} </Badge> </div> {/* Action Buttons */} <Button variant='ghost' size='icon' onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className='h-8 w-8 lg:h-10 lg:w-10' > <Sun className='h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0' /> <Moon className='absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100' /> <span className='sr-only'>Переключить тему</span> </Button> <Button variant='ghost' size='icon' onClick={() => setShowNotifications(!showNotifications)} className={`h-8 w-8 lg:h-10 lg:w-10 ${ showNotifications ? 'bg-muted' : '' }`} > <Bell className='h-4 w-4' /> </Button> <DropdownMenu> <DropdownMenuTrigger asChild> <Button variant='ghost' className='relative h-8 w-8 lg:h-10 lg:w-10 rounded-full' > <Avatar className='h-8 w-8 lg:h-10 lg:w-10'> <AvatarImage src={selectedAgent?.avatar || '/placeholder.svg'} alt='Пользователь' /> <AvatarFallback>П</AvatarFallback> </Avatar> </Button> </DropdownMenuTrigger> <DropdownMenuContent className='w-72 lg:w-80' align='end' forceMount > <div className='flex items-center justify-start gap-2 p-2'> <Avatar className='h-8 w-8'> <AvatarImage src={selectedAgent?.avatar || '/placeholder.svg'} alt='Пользователь' /> <AvatarFallback>П</AvatarFallback> </Avatar> <div className='flex flex-col space-y-1 leading-none min-w-0'> <p className='font-medium truncate'>{userInfo.name}</p> </div> </div> <DropdownMenuSeparator /> <div className='p-2'> <div className='text-sm text-muted-foreground mb-2'> Ваш тариф </div> <Badge variant='outline' className='mb-3'> {userInfo.plan} </Badge> <div className='space-y-1 text-sm'> <div className='flex justify-between'> <span className='text-muted-foreground'> Доступные BotCoin: </span> <span>{userInfo.botcoin}</span> </div> <div className='flex justify-between'> <span className='text-muted-foreground'> Резервные BotCoin: </span> <span>{userInfo.reserved}</span> </div> </div> </div> <DropdownMenuSeparator /> <DropdownMenuItem asChild> <Link href='/account'> <User className='mr-2 h-4 w-4' /> <span>Аккаунт</span> </Link> </DropdownMenuItem> <DropdownMenuItem asChild> <Link href='/account?tab=notifications'> <Mail className='mr-2 h-4 w-4' /> <span>Уведомления</span> </Link> </DropdownMenuItem> <DropdownMenuItem asChild> <Link href='#' onClick={(e) => e.preventDefault()}> <CreditCard className='mr-2 h-4 w-4' /> <span>Партнерская программа</span> </Link> </DropdownMenuItem> <DropdownMenuSeparator /> <DropdownMenuItem asChild> <Link href='#' onClick={(e) => e.preventDefault()}> <LogOut className='mr-2 h-4 w-4' /> <span>Выйти</span> </Link> </DropdownMenuItem> </DropdownMenuContent> </DropdownMenu> </div> </div> {/* Панель уведомлений */} <NotificationPanel open={showNotifications} onClose={() => setShowNotifications(false)} /> </header> ); }
```

# components\notification-panel.tsx

```tsx
'use client'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { X, Settings, Bell } from 'lucide-react'; import { useState } from 'react'; interface NotificationPanelProps { open: boolean; onClose: () => void; } export function NotificationPanel({ open, onClose }: NotificationPanelProps) { const [activeTab, setActiveTab] = useState< 'updates' | 'news' | 'notifications' >('updates'); if (!open) return null; const updates = [ { id: 1, date: '19 июня 2025', title: 'Настройки агента', items: [ { title: 'Очистка markdown разметки', description: 'Добавили опцию для автоматической очистки текста от Markdown-разметки. Теперь нет необходимости указывать в промпте «НЕ ИСПОЛЬЗУЙ MARKDOWN» — текст очистится от форматирования при отправке.', }, { title: 'Отправка изображений ИИ-агентом', description: 'Добавили опцию отправлять изображения в мессенджеры, ссылка будет отправлена в виде изображения. Реализовали возможность автоматически удалять ссылки на изображения из сообщения.', }, { title: 'Работа с файлами', description: 'Разделили настройку стандартного ответа: голосовые сообщения, изображения, прочие файлы', }, ], }, { id: 2, date: '11 июня 2025', title: 'Снижение цены', description: 'Модель GPT-4o', }, ]; return ( <div className='fixed inset-0 z-[100000] bg-black/20' onClick={onClose}> <div className='absolute right-0 top-14 md:top-16 lg:top-16 h-[calc(100vh-3.5rem)] md:h-[calc(100vh-4rem)] lg:h-[calc(100vh-4rem)] w-full sm:w-120 bg-background border-l shadow-lg' onClick={(e) => e.stopPropagation()} > <div className='flex h-full flex-col'> <div className='flex items-center justify-between p-3 md:p-4 border-b'> <div className='flex gap-1 sm:gap-2 overflow-x-auto'> <Button variant={activeTab === 'updates' ? 'default' : 'ghost'} size='sm' onClick={() => setActiveTab('updates')} className={`text-xs whitespace-nowrap ${ activeTab === 'updates' ? 'bg-purple-600 hover:bg-purple-700' : '' }`} > ОБНОВЛЕНИЯ </Button> <Button variant={activeTab === 'news' ? 'default' : 'ghost'} size='sm' onClick={() => setActiveTab('news')} className='text-xs whitespace-nowrap' > <Settings className='h-3 w-3 mr-1' /> НОВОСТИ </Button> <Button variant={activeTab === 'notifications' ? 'default' : 'ghost'} size='sm' onClick={() => setActiveTab('notifications')} className='text-xs whitespace-nowrap' > <Bell className='h-3 w-3 mr-1' /> УВЕДОМЛЕНИЯ </Button> </div> <Button variant='ghost' size='icon' onClick={onClose} className='h-8 w-8 flex-shrink-0' > <X className='h-4 w-4' /> </Button> </div> <ScrollArea className='flex-1 p-3 md:p-4'> {activeTab === 'updates' && ( <div className='space-y-4 md:space-y-6'> {updates.map((update) => ( <div key={update.id} className='space-y-3 md:space-y-4'> <div className='flex items-center gap-2'> <Badge variant='outline' className='text-purple-600 border-purple-600 text-xs' > Обновление от {update.date} </Badge> </div> <Card> <CardHeader className='pb-2 md:pb-3'> <CardTitle className='text-sm md:text-base'> {update.title} </CardTitle> </CardHeader> <CardContent className='space-y-3 md:space-y-4'> {update.items?.map((item, index) => ( <div key={index} className='space-y-1 md:space-y-2'> <h4 className='font-medium text-xs md:text-sm'> {item.title} </h4> <p className='text-xs leading-relaxed text-muted-foreground'> {item.description} </p> </div> ))} {update.description && ( <p className='text-xs md:text-sm text-muted-foreground'> {update.description} </p> )} </CardContent> </Card> </div> ))} </div> )} {activeTab === 'news' && ( <div className='space-y-4'> <Card> <CardHeader> <CardTitle className='text-sm md:text-base'> Новости платформы </CardTitle> </CardHeader> <CardContent> <p className='text-xs md:text-sm text-muted-foreground'> Здесь будут отображаться последние новости и анонсы платформы. </p> </CardContent> </Card> </div> )} {activeTab === 'notifications' && ( <div className='space-y-4'> <Card> <CardHeader> <CardTitle className='text-sm md:text-base'> Уведомления </CardTitle> </CardHeader> <CardContent> <p className='text-xs md:text-sm text-muted-foreground'> У вас нет новых уведомлений. </p> </CardContent> </Card> </div> )} </ScrollArea> </div> </div> </div> ); }
```

# components\service-bot-test.tsx

```tsx
'use client'; import React, { useState, useEffect, useCallback, useRef } from 'react'; import { useSearchParams, useRouter } from 'next/navigation'; import { Search, Bot, Send, Paperclip, Smile, MoreVertical, Circle, CheckCheck, Clock, AlertCircle, Loader2, Settings, X, User, MessageSquare, Zap, Brain, Sparkles, Link, ArrowRight, RefreshCw, Trash2, Volume2, VolumeX, Copy, Download, Maximize2, Minimize2, } from 'lucide-react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent, CardHeader, CardTitle, CardDescription, } from '@/components/ui/card'; import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Skeleton } from '@/components/ui/skeleton'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; import { Textarea } from '@/components/ui/textarea'; import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'; import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger, } from '@/components/ui/tooltip'; import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Label } from '@/components/ui/label'; import { Progress } from '@/components/ui/progress'; import { toast } from 'sonner'; import { useAuth } from '@/contexts/auth-context'; import { apiClient } from '@/lib/api/client'; import { getWebSocketUrl } from '@/lib/api/config'; import { tokenManager } from '@/lib/auth/token-manager'; import { cn } from '@/lib/utils'; import { Sidebar } from '@/components/sidebar'; import { Header } from '@/components/header'; import { motion, AnimatePresence } from 'framer-motion'; // Types interface ServiceBot { id: number; name: string; avatar?: string; prompt: string; llm_model: string; temperature: number; talkativeness: number; } interface InfoFlow { id: number; name: string; type: string; data: any; company_id?: number; } interface ServiceBotRelation { service_bot_id: number; info_flow_id: number; is_active: boolean; } interface Appeal { id: number; chat_id: number; status: string; created_at: string; unread_count?: number; } interface Message { id: number; appeal_id: number; sender: Sender; text: string; type: string; created_at: string; is_read?: boolean; status?: string | 'sending' | 'sent' | 'error'; localId?: string; } interface Chat { id: number; type: string; messenger_chat_id: string; meta?: { name?: string; username?: string; avatar?: string; }; } interface Sender { id: string; type: string | 'user' | 'bot' | 'service'; name?: string; avatar?: string; } export default function ServiceBotTestPage() { const router = useRouter(); const searchParams = useSearchParams(); const { user } = useAuth(); const botIdFromUrl = searchParams.get('bot'); // State const [serviceBots, setServiceBots] = useState<ServiceBot[]>([]); const [infoFlows, setInfoFlows] = useState<InfoFlow[]>([]); const [relations, setRelations] = useState<ServiceBotRelation[]>([]); const [selectedBot, setSelectedBot] = useState<ServiceBot | null>(null); const [selectedFlow, setSelectedFlow] = useState<InfoFlow | null>(null); const [botRelations, setBotRelations] = useState<ServiceBotRelation[]>([]); const [appeal, setAppeal] = useState<Appeal | null>(null); const [chat, setChat] = useState<any | Chat | null>(null); const [messages, setMessages] = useState<Message[]>([]); const [newMessage, setNewMessage] = useState(''); const [isLoading, setIsLoading] = useState(false); const [isLinking, setIsLinking] = useState(false); const [isSending, setIsSending] = useState(false); const [isConnected, setIsConnected] = useState(false); const [isTyping, setIsTyping] = useState(false); const [soundEnabled, setSoundEnabled] = useState(true); const [showSettings, setShowSettings] = useState(false); const [showLinkingPrompt, setShowLinkingPrompt] = useState(false); const [isFullscreen, setIsFullscreen] = useState(false); const [testStartTime, setTestStartTime] = useState<Date | null>(null); const [sender, setSender] = useState<Sender | null>(null); // Refs const messagesEndRef = useRef<HTMLDivElement>(null); const fileInputRef = useRef<HTMLInputElement>(null); const wsRef = useRef<WebSocket | null>(null); const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null); const reconnectAttemptsRef = useRef(0); const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null); const audioRef = useRef<HTMLAudioElement | null>(null); const access_token = tokenManager.getAccessToken(); // Play notification sound const playNotificationSound = useCallback(() => { if (soundEnabled && audioRef.current) { audioRef.current.play().catch(() => {}); } }, [soundEnabled]); // Load initial data useEffect(() => { const loadData = async () => { if (!user?.company_id) return; try { // Load service bots const botsResponse = await apiClient.serviceBot.list({ limit: 100, }); setServiceBots(botsResponse.data.results || []); // Load info flows apiClient.infoFlow.setAuthHeader( process.env.NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY ); const flowsResponse = await apiClient.infoFlow.list({ company_id: user.company_id, limit: 100, }); setInfoFlows(flowsResponse.data.results || []); // If bot ID in URL, auto-select it if (botIdFromUrl) { const bot = botsResponse.data.results?.find( (b) => b.id.toString() === botIdFromUrl ); if (bot) { setSelectedBot(bot); await checkBotRelations(bot.id); } } } catch (error) { console.error('Error loading data:', error); toast.error('Не удалось загрузить данные'); } }; loadData(); }, [user?.company_id, botIdFromUrl]); // Check bot relations const checkBotRelations = async (botId: number) => { try { const response = await apiClient.serviceBotRelation.getByBot(botId); const relations = response.data || []; setBotRelations(relations); setRelations(relations); // If no relations, show linking prompt if (relations.length === 0) { setShowLinkingPrompt(true); } else { setShowLinkingPrompt(false); } } catch (error) { console.error('Error checking bot relations:', error); } }; // Link bot to flow const linkBotToFlow = async () => { if (!selectedBot || !selectedFlow) { toast.error('Выберите поток для привязки'); return; } setIsLinking(true); try { apiClient.serviceBot.setAuthHeader( process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY ); await apiClient.serviceBotRelation.create({ service_bot_id: selectedBot.id, info_flow_id: selectedFlow.id, is_active: true, }); toast.success('Бот успешно привязан к потоку'); setShowLinkingPrompt(false); // Refresh relations await checkBotRelations(selectedBot.id); } catch (error: any) { console.error('Error linking bot to flow:', error); if (error.response?.status === 409) { toast.info('Бот уже привязан к этому потоку'); setShowLinkingPrompt(false); } else { toast.error( error.response?.data?.detail || 'Не удалось привязать бота к потоку' ); } } finally { setIsLinking(false); } }; // Load data const loadServiceBots = useCallback(async () => { if (!user?.company_id) return; try { const response = await apiClient.serviceBot.list({ limit: 100, offset: 0, }); setServiceBots(response.data.results || []); } catch (error) { console.error('Error loading service bots:', error); toast.error('Не удалось загрузить сервисных ботов'); } }, [user]); const loadInfoFlows = useCallback(async () => { if (!user?.company_id) return; try { apiClient.infoFlow.setAuthHeader( process.env.NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY ); const response = await apiClient.infoFlow.list({ limit: 100 }); setInfoFlows(response.data.results || []); } catch (error) { console.error('Error loading info flows:', error); toast.error('Не удалось загрузить потоки'); } }, [user]); const loadRelations = useCallback(async () => { if (!selectedBot) return; try { const response = await apiClient.serviceBotRelation.getByBot( selectedBot.id ); setRelations(response.data || []); } catch (error) { console.error('Error loading relations:', error); } }, [selectedBot]); // WebSocket connection const connectWebSocket = useCallback( (appealId: number) => { if (!access_token) return; // Close existing connection if (wsRef.current) { wsRef.current.close(); } const wsUrl = getWebSocketUrl('/api/v1/ws/crm/', access_token); const ws = new WebSocket(wsUrl); ws.onopen = () => { console.log('WebSocket connected'); setIsConnected(true); reconnectAttemptsRef.current = 0; // Subscribe to appeal updates ws.send( JSON.stringify({ cmd: 'subscribe', channel: 'appeal', channel_required_data: appealId, }) ); }; ws.onmessage = (event) => { try { const data = JSON.parse(event.data); console.log('WebSocket message:', data); switch (data.type) { case 'NEW_MESSAGE': if (data.message && data.message.appeal_id === appealId) { setMessages((prev) => { const exists = prev.some( (msg) => msg.id === data.message.id || msg.localId === data.message.localId ); if (!exists) { playNotificationSound(); return [...prev, data.message]; } return prev; }); setIsTyping(false); } break; case 'TYPING': if (data.appeal_id === appealId && data.sender_type === 'bot') { setIsTyping(true); if (typingTimeoutRef.current) { clearTimeout(typingTimeoutRef.current); } typingTimeoutRef.current = setTimeout(() => { setIsTyping(false); }, 3000); } break; case 'UPDATE_APPEAL': if (data.appeal && data.appeal.id === appealId) { setAppeal(data.appeal); } break; case 'ERROR': console.error('WebSocket error:', data.error); toast.error(data.error || 'Ошибка WebSocket соединения'); break; } } catch (error) { console.error('Error parsing WebSocket message:', error); } }; ws.onerror = (error) => { console.error('WebSocket error:', error); setIsConnected(false); }; ws.onclose = () => { console.log('WebSocket disconnected'); setIsConnected(false); // Attempt to reconnect if (reconnectAttemptsRef.current < 5) { reconnectTimeoutRef.current = setTimeout(() => { reconnectAttemptsRef.current++; connectWebSocket(appealId); }, 3000 * reconnectAttemptsRef.current); } }; wsRef.current = ws; }, [user, playNotificationSound] ); // Initialize chat const initializeChat = async (botId?: number, flowId?: number) => { const bot = botId ? serviceBots.find((b) => b.id === botId) : selectedBot; const flow = flowId ? infoFlows.find((f) => f.id === flowId) : selectedFlow; if (!bot || !flow || !user) { toast.error('Выберите бота и поток для начала тестирования'); return; } setIsLoading(true); setTestStartTime(new Date()); try { // First check if there's an existing appeal const appealsResponse = await apiClient.appeal.list({ company_id: user.company_id, info_flow_id: flow.id, status: 'opened', limit: 100, }); let currentAppeal = appealsResponse.data.results?.[0]; let currentChat = null; let currentSender = null; if (!currentAppeal) { apiClient.serviceBot.setAuthHeader( process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY ); const senderResponse = await apiClient.sender.create({ id: user.id, type: 'user', name: `${user.name} User ${user.id}`, username: user.name, company_id: user.company_id, avatar: selectedBot?.avatar, }); currentSender = senderResponse.data; setSender(currentSender); // Create a new chat first const chatResponse = await apiClient.chat.create({ info_flow_id: flow.id, type: 'web', messenger_chat_id: `web_test_${user.id}_${Date.now()}`, meta: { name: `Test by ${user.name || user.email}`, is_test: true, bot_id: bot.id, bot_name: bot.name, }, }); currentChat = chatResponse.data; // Create a new appeal const appealResponse = await apiClient.appeal.create({ id: Math.floor(Date.now() / 100000), chat_id: Number(currentChat.id), company_id: Number(user.company_id), service_bot_id: bot.id, status: 'new', needs_an_operator: true, is_ruled_by_bot: false, operator: currentSender.id, }); currentAppeal = appealResponse.data; } else { // Get the chat info const chatResponse = await apiClient.chat.get(currentAppeal.chat_id); currentChat = chatResponse.data; } setAppeal(currentAppeal); setChat(currentChat); // Load existing messages if any if (currentAppeal.id) { await loadMessages(currentAppeal.id); } // Connect WebSocket connectWebSocket(currentAppeal.id); toast.success('Чат инициализирован'); } catch (error: any) { console.error('Error initializing chat:', error); toast.error( error.response?.data?.detail || 'Не удалось инициализировать чат' ); } finally { setIsLoading(false); } }; // Load messages const loadMessages = async (appealId: number) => { try { const response = await apiClient.chat.getMessages(appealId, { limit: 100, offset: 0, }); setMessages(response.data.results || []); // Scroll to bottom setTimeout(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, 100); } catch (error) { console.error('Error loading messages:', error); } }; // Send message const sendMessage = async () => { if (!appeal || !newMessage.trim() || isSending) return; const localId = `local-${Date.now()}`; const tempMessage: Message = { id: 0, localId, appeal_id: appeal.id, sender: { id: user?.id.toString() || 'user', type: 'user', name: user?.name || user?.email, avatar: selectedBot?.avatar, }, text: newMessage.trim(), type: 'text', created_at: new Date().toISOString(), status: 'sending', }; // Add temporary message setMessages((prev) => [...prev, tempMessage]); setNewMessage(''); setIsSending(true); try { const response = await apiClient.chat.sendMessage({ appeal_id: appeal.id, text: tempMessage.text, type: 'text', }); // Update with real message setMessages((prev) => prev.map((msg) => msg.localId === localId ? { ...response.data, status: 'sent' as const } : msg ) ); // Scroll to bottom setTimeout(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, 100); } catch (error: any) { console.error('Error sending message:', error); // Mark message as error setMessages((prev) => prev.map((msg) => msg.localId === localId ? { ...msg, status: 'error' as const } : msg ) ); toast.error( error.response?.data?.detail || 'Не удалось отправить сообщение' ); } finally { setIsSending(false); } }; // Clear chat const clearChat = useCallback(async () => { if (!appeal) return; try { // Close the appeal await apiClient.appeal.update(appeal.id, { status: 'closed', }); // Reset state setAppeal(null); setChat(null); setMessages([]); setTestStartTime(null); // Close WebSocket if (wsRef.current) { wsRef.current.close(); } toast.success('Чат очищен'); } catch (error) { console.error('Error clearing chat:', error); toast.error('Не удалось очистить чат'); } }, [appeal]); // Copy conversation const copyConversation = useCallback(() => { const text = messages .map((msg) => { const sender = msg.sender.type === 'user' ? 'Вы' : selectedBot?.name || 'Бот'; const time = new Date(msg.created_at).toLocaleTimeString(); return `[${time}] ${sender}: ${msg.text}`; }) .join('\n'); navigator.clipboard.writeText(text); toast.success('Диалог скопирован в буфер обмена'); }, [messages, selectedBot]); // Export conversation const exportConversation = useCallback(() => { const data = { bot: selectedBot, flow: selectedFlow, messages: messages, startTime: testStartTime, endTime: new Date(), }; const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json', }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `chat-test-${ selectedBot?.name }-${new Date().toISOString()}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }, [selectedBot, selectedFlow, messages, testStartTime]); // Effects useEffect(() => { loadServiceBots(); loadInfoFlows(); }, [loadServiceBots, loadInfoFlows]); useEffect(() => { if (selectedBot) { loadRelations(); } }, [selectedBot, loadRelations]); useEffect(() => { // Initialize audio audioRef.current = new Audio('/notification.mp3'); audioRef.current.volume = 0.5; return () => { if (wsRef.current) { wsRef.current.close(); } if (reconnectTimeoutRef.current) { clearTimeout(reconnectTimeoutRef.current); } if (typingTimeoutRef.current) { clearTimeout(typingTimeoutRef.current); } }; }, []); // Get available flows for selected bot const availableFlows = selectedBot ? infoFlows.filter((flow) => relations.some( (rel) => rel.service_bot_id === selectedBot.id && rel.info_flow_id === flow.id && rel.is_active ) ) : []; return ( <div className={cn( 'flex h-screen bg-background', isFullscreen && 'fixed inset-0 z-50' )} > {/* Desktop Sidebar */} {!isFullscreen && ( <div className='hidden md:block w-68 flex-shrink-0'> <Sidebar /> </div> )} <div className='flex-1 flex flex-col min-w-0'> {!isFullscreen && <Header />} <main className='flex-1 flex overflow-hidden'> {/* Left Panel - Configuration */} <div className={cn( 'border-r bg-muted/10', isFullscreen ? 'w-80' : 'w-96' )} > <div className='h-full flex flex-col'> <div className='p-6 border-b'> <h2 className='text-2xl font-bold mb-2'>Тестирование ботов</h2> <p className='text-sm text-muted-foreground'> Протестируйте работу ваших сервисных ботов в реальном времени </p> </div> <ScrollArea className='flex-1'> <div className='p-6 space-y-6'> {/* Bot Selection */} <div className='space-y-2'> <Label className='text-sm font-medium'>Выберите бота</Label> <Select value={selectedBot?.id.toString()} onValueChange={(value) => { const bot = serviceBots.find( (b) => b.id === parseInt(value) ); setSelectedBot(bot || null); setSelectedFlow(null); if (bot) { checkBotRelations(bot.id); } }} > <SelectTrigger className='w-full'> <SelectValue placeholder='Выберите сервисного бота' /> </SelectTrigger> <SelectContent> {serviceBots.map((bot) => ( <SelectItem key={bot.id} value={bot.id.toString()}> <div className='flex items-center gap-2'> <Avatar className='h-6 w-6'> <AvatarImage src={bot.avatar} /> <AvatarFallback> <Bot className='h-4 w-4' /> </AvatarFallback> </Avatar> <span>{bot.name}</span> </div> </SelectItem> ))} </SelectContent> </Select> </div> {/* Bot Linking Alert */} {showLinkingPrompt && selectedBot && ( <Alert className='border-orange-200 bg-orange-50'> <AlertCircle className='h-4 w-4 text-orange-600' /> <AlertTitle>Бот не привязан к потоку</AlertTitle> <AlertDescription className='mt-2'> <p className='text-sm mb-3'> Для тестирования бота необходимо привязать его к потоку информации. </p> <Select value={selectedFlow?.id.toString()} onValueChange={(value) => { const flow = infoFlows.find( (f) => f.id.toString() === value ); setSelectedFlow(flow || null); }} > <SelectTrigger className='w-full mb-3'> <SelectValue placeholder='Выберите поток для привязки' /> </SelectTrigger> <SelectContent> {infoFlows.map((flow) => ( <SelectItem key={flow.id} value={flow.id.toString()} > {flow.name} ({flow.type}) </SelectItem> ))} </SelectContent> </Select> <Button className='w-full' onClick={linkBotToFlow} disabled={!selectedFlow || isLinking} > {isLinking ? ( <> <Loader2 className='mr-2 h-4 w-4 animate-spin' /> Привязка... </> ) : ( <> <Link className='mr-2 h-4 w-4' /> Привязать к потоку </> )} </Button> </AlertDescription> </Alert> )} {/* Flow Selection */} {selectedBot && !showLinkingPrompt && ( <div className='space-y-2'> <Label className='text-sm font-medium'> Выберите поток </Label> <Select value={selectedFlow?.id.toString()} onValueChange={(value) => { const flow = availableFlows.find( (f) => f.id === parseInt(value) ); setSelectedFlow(flow || null); }} disabled={availableFlows.length === 0} > <SelectTrigger className='w-full'> <SelectValue placeholder={ availableFlows.length === 0 ? 'Нет доступных потоков' : 'Выберите поток' } /> </SelectTrigger> <SelectContent> {availableFlows.map((flow) => ( <SelectItem key={flow.id} value={flow.id.toString()} > <div className='flex items-center gap-2'> <MessageSquare className='h-4 w-4 text-muted-foreground' /> <span>{flow.name}</span> <Badge variant='outline' className='ml-auto'> {flow.type} </Badge> </div> </SelectItem> ))} </SelectContent> </Select> </div> )} {/* Bot Info */} {selectedBot && ( <Card> <CardHeader className='pb-3'> <CardTitle className='text-sm'> Информация о боте </CardTitle> </CardHeader> <CardContent className='space-y-3'> <div className='flex items-center gap-3'> <Avatar className='h-12 w-12'> <AvatarImage src={selectedBot.avatar} /> <AvatarFallback> <Bot className='h-6 w-6' /> </AvatarFallback> </Avatar> <div> <p className='font-medium'>{selectedBot.name}</p> <p className='text-sm text-muted-foreground'> {selectedBot.llm_model} </p> </div> </div> <div className='space-y-2'> <div className='flex items-center justify-between text-sm'> <span className='text-muted-foreground'> Температура </span> <Badge variant='secondary'> {selectedBot.temperature} </Badge> </div> <div className='flex items-center justify-between text-sm'> <span className='text-muted-foreground'> Разговорчивость </span> <Badge variant='secondary'> {selectedBot.talkativeness} </Badge> </div> </div> <div className='pt-2'> <p className='text-xs text-muted-foreground mb-1'> Промпт </p> <p className='text-xs bg-muted p-2 rounded-md line-clamp-3'> {selectedBot.prompt} </p> </div> </CardContent> </Card> )} {/* Start Test Button */} <Button onClick={() => initializeChat()} disabled={ !selectedBot || !selectedFlow || isLoading || showLinkingPrompt } className='w-full' size='lg' > {isLoading ? ( <> <Loader2 className='mr-2 h-4 w-4 animate-spin' /> Инициализация... </> ) : appeal ? ( <> <RefreshCw className='mr-2 h-4 w-4' /> Перезапустить тест </> ) : ( <> <Zap className='mr-2 h-4 w-4' /> Начать тестирование </> )} </Button> {/* Test Statistics */} {appeal && testStartTime && ( <Card> <CardHeader className='pb-3'> <CardTitle className='text-sm'> Статистика теста </CardTitle> </CardHeader> <CardContent className='space-y-2'> <div className='flex items-center justify-between text-sm'> <span className='text-muted-foreground'> Сообщений </span> <Badge variant='secondary'>{messages.length}</Badge> </div> <div className='flex items-center justify-between text-sm'> <span className='text-muted-foreground'> Длительность </span> <Badge variant='secondary'> {Math.floor( (new Date().getTime() - testStartTime.getTime()) / 1000 / 60 )}{' '} мин </Badge> </div> <div className='flex items-center justify-between text-sm'> <span className='text-muted-foreground'>Статус</span> <Badge variant={isConnected ? 'default' : 'destructive'} className='gap-1' > <Circle className={cn( 'h-2 w-2', isConnected ? 'fill-green-500' : 'fill-red-500' )} /> {isConnected ? 'Подключен' : 'Отключен'} </Badge> </div> </CardContent> </Card> )} </div> </ScrollArea> </div> </div> {/* Right Panel - Chat */} <div className='flex-1 flex flex-col bg-background'> {/* Chat Header */} <div className='border-b p-4 flex items-center justify-between bg-card'> <div className='flex items-center gap-3'> {selectedBot ? ( <> <Avatar className='h-10 w-10'> <AvatarImage src={selectedBot.avatar} /> <AvatarFallback> <Bot className='h-5 w-5' /> </AvatarFallback> </Avatar> <div> <h3 className='font-semibold'>{selectedBot.name}</h3> <p className='text-sm text-muted-foreground'> {selectedFlow?.name || 'Выберите поток'} </p> </div> </> ) : ( <div> <h3 className='font-semibold'>Тестовый чат</h3> <p className='text-sm text-muted-foreground'> Выберите бота и поток для начала </p> </div> )} {isTyping && ( <Badge variant='secondary' className='ml-auto animate-pulse'> <Bot className='h-3 w-3 mr-1' /> печатает... </Badge> )} </div> <div className='flex items-center gap-2'> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button variant='ghost' size='icon' onClick={() => setSoundEnabled(!soundEnabled)} > {soundEnabled ? ( <Volume2 className='h-4 w-4' /> ) : ( <VolumeX className='h-4 w-4' /> )} </Button> </TooltipTrigger> <TooltipContent> {soundEnabled ? 'Выключить звук' : 'Включить звук'} </TooltipContent> </Tooltip> </TooltipProvider> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button variant='ghost' size='icon' onClick={copyConversation} disabled={messages.length === 0} > <Copy className='h-4 w-4' /> </Button> </TooltipTrigger> <TooltipContent>Копировать диалог</TooltipContent> </Tooltip> </TooltipProvider> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button variant='ghost' size='icon' onClick={exportConversation} disabled={messages.length === 0} > <Download className='h-4 w-4' /> </Button> </TooltipTrigger> <TooltipContent>Экспортировать диалог</TooltipContent> </Tooltip> </TooltipProvider> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button variant='ghost' size='icon' onClick={clearChat} disabled={!appeal} > <Trash2 className='h-4 w-4' /> </Button> </TooltipTrigger> <TooltipContent>Очистить чат</TooltipContent> </Tooltip> </TooltipProvider> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button variant='ghost' size='icon' onClick={() => setIsFullscreen(!isFullscreen)} > {isFullscreen ? ( <Minimize2 className='h-4 w-4' /> ) : ( <Maximize2 className='h-4 w-4' /> )} </Button> </TooltipTrigger> <TooltipContent> {isFullscreen ? 'Выйти из полноэкранного режима' : 'Полноэкранный режим'} </TooltipContent> </Tooltip> </TooltipProvider> </div> </div> {/* Messages Area */} <ScrollArea className='flex-1 p-4'> {!appeal ? ( <div className='flex flex-col items-center justify-center h-full text-center'> <div className='mb-6 relative'> <div className='absolute inset-0 bg-purple-500/20 blur-3xl rounded-full' /> <Bot className='h-24 w-24 text-purple-500 relative' /> </div> <h3 className='text-xl font-semibold mb-2'> Готов к тестированию </h3> <p className='text-muted-foreground max-w-md'> Выберите сервисного бота и поток, затем нажмите "Начать тестирование", чтобы начать диалог </p> </div> ) : messages.length === 0 ? ( <div className='flex flex-col items-center justify-center h-full text-center'> <Sparkles className='h-12 w-12 text-purple-500 mb-4' /> <h3 className='text-lg font-semibold mb-2'> Чат инициализирован </h3> <p className='text-muted-foreground'> Напишите первое сообщение, чтобы начать диалог </p> </div> ) : ( <div className='space-y-4'> <AnimatePresence> {messages.map((message) => ( <motion.div key={message.id || message.localId} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} transition={{ duration: 0.2 }} className={cn( 'flex gap-3', message?.sender?.type === 'user' ? 'justify-end' : 'justify-start' )} > {message?.sender?.type !== 'user' && ( <Avatar className='h-8 w-8 flex-shrink-0'> <AvatarImage src={message?.sender?.avatar} /> <AvatarFallback> <Bot className='h-4 w-4' /> </AvatarFallback> </Avatar> )} <div className={cn( 'max-w-[70%] space-y-1', message?.sender?.type === 'user' && 'items-end' )} > <div className={cn( 'rounded-2xl px-4 py-2 break-words', message?.sender?.type === 'user' ? 'bg-primary text-primary-foreground' : 'bg-muted' )} > <p className='text-sm whitespace-pre-wrap'> {message.text} </p> </div> <div className={cn( 'flex items-center gap-1 text-xs text-muted-foreground px-2', message?.sender?.type === 'user' && 'justify-end' )} > <span> {new Date(message.created_at).toLocaleTimeString( 'ru-RU', { hour: '2-digit', minute: '2-digit', } )} </span> {message?.sender?.type === 'user' && ( <> {message.status === 'sending' && ( <Clock className='h-3 w-3' /> )} {message.status === 'sent' && ( <CheckCheck className='h-3 w-3' /> )} {message.status === 'error' && ( <AlertCircle className='h-3 w-3 text-destructive' /> )} </> )} </div> </div> {message?.sender?.type === 'user' && ( <Avatar className='h-8 w-8 flex-shrink-0'> <AvatarImage src={selectedBot?.avatar} /> <AvatarFallback> <User className='h-4 w-4' /> </AvatarFallback> </Avatar> )} </motion.div> ))} </AnimatePresence> {isTyping && ( <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className='flex gap-3' > <Avatar className='h-8 w-8'> <AvatarImage src={selectedBot?.avatar} /> <AvatarFallback> <Bot className='h-4 w-4' /> </AvatarFallback> </Avatar> <div className='bg-muted rounded-2xl px-4 py-2'> <div className='flex gap-1'> <motion.div className='w-2 h-2 bg-muted-foreground rounded-full' animate={{ opacity: [0.4, 1, 0.4] }} transition={{ duration: 1.5, repeat: Infinity, delay: 0, }} /> <motion.div className='w-2 h-2 bg-muted-foreground rounded-full' animate={{ opacity: [0.4, 1, 0.4] }} transition={{ duration: 1.5, repeat: Infinity, delay: 0.2, }} /> <motion.div className='w-2 h-2 bg-muted-foreground rounded-full' animate={{ opacity: [0.4, 1, 0.4] }} transition={{ duration: 1.5, repeat: Infinity, delay: 0.4, }} /> </div> </div> </motion.div> )} <div ref={messagesEndRef} /> </div> )} </ScrollArea> {/* Input Area */} {appeal && ( <div className='border-t p-4 bg-card'> <div className='flex gap-2'> <Textarea value={newMessage} onChange={(e) => setNewMessage(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }} placeholder='Введите сообщение...' className='min-h-[44px] max-h-32 resize-none' disabled={isSending} /> <Button onClick={sendMessage} disabled={!newMessage.trim() || isSending} size='icon' className='h-11 w-11' > {isSending ? ( <Loader2 className='h-4 w-4 animate-spin' /> ) : ( <Send className='h-4 w-4' /> )} </Button> </div> <div className='flex items-center justify-between mt-2'> <div className='flex items-center gap-2'> <Button variant='ghost' size='sm' className='h-8 px-2' onClick={() => fileInputRef.current?.click()} disabled > <Paperclip className='h-3.5 w-3.5 mr-1' /> Файл </Button> <Button variant='ghost' size='sm' className='h-8 px-2' disabled > <Smile className='h-3.5 w-3.5 mr-1' /> Эмодзи </Button> </div> <p className='text-xs text-muted-foreground'> {newMessage.length}/1000 </p> </div> <input ref={fileInputRef} type='file' className='hidden' accept='image/*,.pdf,.doc,.docx' /> </div> )} </div> </main> </div> </div> ); }
```

# components\sidebar.tsx

```tsx
'use client'; import { cn } from '@/lib/utils'; import { Button } from '@/components/ui/button'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Bot, MessageCircle, Settings, Database, Zap, Plus, BarChart3, Webhook, MessageSquare, HelpCircle, CableIcon as Channels, } from 'lucide-react'; import Link from 'next/link'; import { usePathname } from 'next/navigation'; const sidebarItems = [ { title: 'ТЕСТЫ', items: [{ name: 'Агенты', href: '/agents', icon: Bot, active: true }], }, { title: 'НАСТРОЙКИ', items: [ { name: 'Чат', href: '/chat', icon: MessageCircle }, { name: 'Настройка агента', href: '/settings', icon: Settings }, { name: 'Источники знаний', href: '/knowledge', icon: Database }, { name: 'Функции', href: '/functions', icon: Zap }, { name: 'Дообучение', href: '/training', icon: Plus }, ], }, { title: 'СЕРВИС', items: [ { name: 'Каналы', href: '/channels', icon: Channels }, { name: 'Интеграции', href: '/integrations', icon: Webhook }, { name: 'Чат на сайт', href: '/website-chat', icon: MessageSquare }, ], }, { title: 'МОНИТОРИНГ', items: [ { name: 'Диалоги', href: '/dialogs', icon: MessageCircle }, { name: 'Аналитика', href: '/analytics', icon: BarChart3 }, ], }, ]; const helpItems = [ { title: 'ПОМОЩЬ', items: [{ name: 'Поддержка', href: '/support', icon: HelpCircle }], }, ]; interface SidebarProps { onItemClick?: () => void; } export function Sidebar({ onItemClick }: SidebarProps) { const pathname = usePathname(); const handleItemClick = () => { if (onItemClick) { onItemClick(); } }; return ( <div className='pb-12 w-full bg-background border-r flex flex-col h-full'> {/* Логотип в сайдбаре - только на десктопе */} <div className='hidden md:block px-7 py-[20px] border-b'> <div className='text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent'> NEUROX </div> </div> {/* Мобильный заголовок */} <div className='md:hidden px-4 py-4 border-b'> <div className='text-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent'> NEUROX </div> </div> <div className='flex-1 space-y-4 py-5'> <div className='px-3 py-2'> <div className='space-y-1'> <ScrollArea className='h-[calc(100vh-12rem)] md:h-[calc(100vh-17rem)]'> <div className='space-y-6 p-2'> {sidebarItems.map((section) => ( <div key={section.title}> <h3 className='mb-2 px-4 text-xs font-semibold text-muted-foreground uppercase tracking-wider'> {section.title} </h3> <div className='space-y-1'> {section.items.map((item) => ( <Link key={item.name} href={item.href} onClick={handleItemClick} > <Button variant={ pathname === item.href ? 'secondary' : 'ghost' } className={cn( 'w-full justify-start h-10 text-sm', pathname === item.href && 'bg-purple-100 text-purple-900 dark:bg-purple-900 dark:text-purple-100' )} > <item.icon className='mr-2 h-4 w-4' /> {item.name} </Button> </Link> ))} </div> </div> ))} </div> </ScrollArea> </div> </div> </div> {/* Зафиксированная секция помощи внизу */} <div className='border-t p-3'> {helpItems.map((section) => ( <div key={section.title}> <h3 className='mb-2 px-4 text-xs font-semibold text-muted-foreground uppercase tracking-wider'> {section.title} </h3> <div className='space-y-1'> {section.items.map((item) => ( <Link key={item.name} href={item.href} onClick={handleItemClick} > <Button variant={pathname === item.href ? 'secondary' : 'ghost'} className={cn( 'w-full justify-start h-10 text-sm', pathname === item.href && 'bg-purple-100 text-purple-900 dark:bg-purple-900 dark:text-purple-100' )} > <item.icon className='mr-2 h-4 w-4' /> {item.name} </Button> </Link> ))} </div> </div> ))} </div> </div> ); }
```

# components\theme-provider.tsx

```tsx
"use client" import { ThemeProvider as NextThemesProvider } from "next-themes" import type { ThemeProviderProps } from "next-themes" export function ThemeProvider({ children, ...props }: ThemeProviderProps) { return <NextThemesProvider {...props}>{children}</NextThemesProvider> }
```

# contexts\auth-context.tsx

```tsx
'use client'; import React, { createContext, useContext, useState, useEffect, useCallback, } from 'react'; import { useRouter, usePathname } from 'next/navigation'; import { apiClient, type User, type LoginData, type RegisterData, } from '@/lib/api/client'; import { tokenManager } from '@/lib/auth/token-manager'; import { toast } from 'sonner'; interface AuthContextType { user: User | null; isLoading: boolean; isAuthenticated: boolean; login: (data: LoginData) => Promise<void>; register: (data: RegisterData) => Promise<void>; logout: () => Promise<void>; refreshUser: () => Promise<void>; checkAuth: () => Promise<boolean>; } const AuthContext = createContext<AuthContextType | undefined>(undefined); const PUBLIC_ROUTES = [ '/login', '/register', '/', '/reset-password', '/terms', '/privacy', '/404', '/not-found', ]; export function AuthProvider({ children }: { children: React.ReactNode }) { const [user, setUser] = useState<User | null>(null); const [isLoading, setIsLoading] = useState(true); const [isInitialized, setIsInitialized] = useState(false); const router = useRouter(); const pathname = usePathname(); const checkAuth = useCallback(async (): Promise<boolean> => { try { if (!tokenManager.hasValidSession()) { setUser(null); return false; } // Get cached user first const cachedUser = tokenManager.getUser(); if (cachedUser && !tokenManager.shouldRefreshToken()) { setUser(cachedUser); return true; } const response = await apiClient.auth.getMe(); const userData = response.data; setUser(userData); tokenManager.setUser(userData); return true; } catch (error) { console.error('Auth check failed:', error); setUser(null); tokenManager.clearTokens(); return false; } }, []); useEffect(() => { const initAuth = async () => { setIsLoading(true); try { const isAuth = await checkAuth(); // Redirect logic if (!isAuth && !PUBLIC_ROUTES.includes(pathname)) { router.push('/login'); } else if (isAuth && PUBLIC_ROUTES.includes(pathname)) { router.push('/agents'); } } finally { setIsLoading(false); setIsInitialized(true); } }; initAuth(); }, []); const login = useCallback( async (data: LoginData) => { try { setIsLoading(true); const response = await apiClient.auth.login(data); const { access_token, refresh_token, user: userData } = response.data; tokenManager.setTokens(access_token, refresh_token); tokenManager.setUser(userData); setUser(userData); toast.success('Успешный вход', { description: `Добро пожаловать, ${userData.name}!`, }); router.push('/agents'); } catch (error: any) { console.error('Login error:', error); if (error.response?.data?.detail) { throw new Error(error.response.data.detail); } else { throw new Error('Ошибка входа. Проверьте email и пароль.'); } } finally { setIsLoading(false); } }, [router] ); const register = useCallback( async (data: RegisterData) => { try { setIsLoading(true); const response = await apiClient.auth.register(data); const userData = response.data; console.log('Register response:', response); toast.success('Регистрация успешна', { description: 'Теперь вы можете войти в систему', }); // Auto-login after registration await login({ email: data.email, password: data.password, }); } catch (error: any) { console.error('Register error:', error); if (error.response?.data?.detail) { throw new Error(error.response.data.detail); } else { throw new Error('Ошибка регистрации. Попробуйте позже.'); } } finally { setIsLoading(false); } }, [login] ); const logout = useCallback(async () => { try { setIsLoading(true); try { await apiClient.auth.logout(); } catch (error) { console.error('Logout API error:', error); } tokenManager.clearTokens(); setUser(null); toast.success('Вы вышли из системы'); router.push('/login'); } finally { setIsLoading(false); } }, [router]); const refreshUser = useCallback(async () => { try { const response = await apiClient.auth.getMe(); const userData = response.data; setUser(userData); tokenManager.setUser(userData); } catch (error) { console.error('Refresh user error:', error); await logout(); } }, [logout]); useEffect(() => { if (!user) return; const interval = setInterval(() => { if (tokenManager.shouldRefreshToken()) { checkAuth(); } }, 60000); // Check every minute return () => clearInterval(interval); }, [user, checkAuth]); // Protect routes useEffect(() => { if (!isInitialized) return; const isPublicRoute = PUBLIC_ROUTES.includes(pathname); const isAuth = tokenManager.isAuthenticated(); if (!isAuth && !isPublicRoute) { router.push('/login'); } else if (isAuth && isPublicRoute && pathname !== '/') { router.push('/agents'); } }, [pathname, isInitialized, router]); const value: AuthContextType = { user, isLoading, isAuthenticated: !!user && tokenManager.isAuthenticated(), login, register, logout, refreshUser, checkAuth, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; } export function useAuth() { const context = useContext(AuthContext); if (context === undefined) { throw new Error('useAuth must be used within an AuthProvider'); } return context; } // HOC for protected pages export function withAuth<P extends object>( Component: React.ComponentType<P>, options?: { requiredRole?: string; redirectTo?: string; } ) { return function AuthenticatedComponent(props: P) { const { user, isLoading, isAuthenticated } = useAuth(); const router = useRouter(); useEffect(() => { if (!isLoading) { if (!isAuthenticated) { router.push(options?.redirectTo || '/login'); } else if ( options?.requiredRole && user?.role !== options.requiredRole ) { toast.error('У вас нет доступа к этой странице'); router.push('/agents'); } } }, [isLoading, isAuthenticated, user, router]); if (isLoading) { return ( <div className='flex items-center justify-center min-h-screen'> <div className='animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600'></div> </div> ); } if (!isAuthenticated) { return null; } if (options?.requiredRole && user?.role !== options.requiredRole) { return null; } return <Component {...props} />; }; }
```

# Dockerfile

```
# ---- Base Node ---- FROM node:20-alpine AS base WORKDIR /app RUN apk add --no-cache libc6-compat EXPOSE 3000 # ---- Dependencies ---- FROM base AS deps COPY package*.json ./ RUN npm ci --only=production RUN cp -R node_modules prod_node_modules RUN npm ci # ---- Build ---- FROM base AS builder WORKDIR /app # Build arguments ARG NEXT_PUBLIC_AUTH_SERVICE_URL ARG NEXT_PUBLIC_BACKEND_URL ARG NEXT_PUBLIC_BOTS_CONNECTION_SECRET ARG NEXT_PUBLIC_MAIN_SERVICE_API_KEY ARG NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY # Set environment variables for build ENV NEXT_PUBLIC_AUTH_SERVICE_URL=$NEXT_PUBLIC_AUTH_SERVICE_URL ENV NEXT_PUBLIC_BACKEND_URL=$NEXT_PUBLIC_BACKEND_URL ENV NEXT_PUBLIC_BOTS_CONNECTION_SECRET=$NEXT_PUBLIC_BOTS_CONNECTION_SECRET ENV NEXT_PUBLIC_MAIN_SERVICE_API_KEY=$NEXT_PUBLIC_MAIN_SERVICE_API_KEY ENV NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY=$NEXT_PUBLIC_STATS_SERVICE_SECRET_KEY COPY --from=deps /app/node_modules ./node_modules COPY . . # Build the application RUN npm run build # ---- Production ---- FROM base AS runner WORKDIR /app ENV NODE_ENV=production ENV NEXT_TELEMETRY_DISABLED=1 # Create a non-root user to run the app RUN addgroup -g 1001 -S nodejs RUN adduser -S nextjs -u 1001 # Copy necessary files COPY --from=builder /app/public ./public COPY --from=builder /app/package.json ./package.json # Copy standalone build COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./ COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static USER nextjs # Health check HEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \ CMD node -e "require('http').get('http://localhost:3000/api/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1); });" CMD ["node", "server.js"]
```

# hooks\use-agents.ts

```ts
import { useState, useEffect, useCallback } from 'react'; import { apiClient, type ServiceBot, type PaginatedResponse, } from '@/lib/api/client'; import { toast } from 'sonner'; import { useAuth } from '@/contexts/auth-context'; interface UseAgentsOptions { limit?: number; autoLoad?: boolean; } export interface Agent { id: any; name: string; avatar: string; status: string | 'active' | 'inactive'; llmModel: string; totalConversations: number; temperature: number; instructions: string; // Backend fields mapping company_id: number; prompt: string; enable_functions: boolean; talkativeness: number; timezone: string; settings: any; is_robot_question: string; } // Маппинг данных из ServiceBot в Agent function mapServiceBotToAgent(bot: ServiceBot): Agent { return { id: bot.id.toString(), name: bot.name, avatar: bot.avatar || `https://api.dicebear.com/9.x/notionists/png?seed=${bot.id}&backgroundColor=b6e3f4,c0aede,d1d4f9`, status: 'active', // По умолчанию активен, можно добавить поле в бэкенд llmModel: bot.llm_model, totalConversations: 0, // Нужно будет получать из статистики temperature: bot.temperature, instructions: bot.prompt, // Backend fields company_id: bot.company_id, prompt: bot.prompt, enable_functions: bot.enable_functions, talkativeness: bot.talkativeness, timezone: bot.timezone, settings: bot.settings, is_robot_question: bot.is_robot_question, }; } // Маппинг Agent обратно в данные для бэкенда function mapAgentToServiceBotData(agent: Agent): Partial<ServiceBot> { return { company_id: agent.company_id, name: agent.name, avatar: agent.avatar, llm_model: agent.llmModel, temperature: agent.temperature, prompt: agent.prompt, // enable_functions: agent.enable_functions || true, talkativeness: agent.talkativeness || 50, timezone: agent.timezone || 'UTC', settings: agent.settings || {}, is_robot_question: agent.is_robot_question || 'no', }; } export function useAgents(options: UseAgentsOptions = {}) { const { limit = 50, autoLoad = true } = options; const [agents, setAgents] = useState<any[]>([]); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState<string | null>(null); const [total, setTotal] = useState(0); const [offset, setOffset] = useState(0); const { user } = useAuth(); const fetchAgents = useCallback(async () => { if (!user?.company_id) { console.log('No company_id available'); return; } try { setIsLoading(true); setError(null); const response = await apiClient.serviceBot.list({ limit, offset, }); console.log('Fetched agents:', response.data); const { results, total: totalCount } = response.data; console.log('Total agents:', totalCount); console.log('Results:', results); // Фильтруем только агентов текущей компании и маппим данные const companyAgents = results .filter((bot) => bot.company_id === user.company_id) .map(mapServiceBotToAgent); setAgents(results); setTotal(totalCount); } catch (err) { const errorMessage = err instanceof Error ? err.message : 'Failed to fetch agents'; setError(errorMessage); toast.error('Ошибка загрузки агентов', { description: errorMessage, }); } finally { setIsLoading(false); } }, [limit, offset, user?.company_id]); const createAgent = useCallback( async (agentData: Partial<Agent>) => { if (!user?.company_id) { toast.error('Ошибка', { description: 'Компания не найдена', }); return null; } try { setIsLoading(true); const serviceBotData = { // generate a unique ID for the new agent(int32) id: Math.floor(Date.now() / 100000), company_id: user.company_id, name: agentData.name || 'Новый агент', prompt: agentData.instructions || 'You are a helpful assistant.', // enable_functions: true, talkativeness: 50.5, temperature: agentData.temperature || 0.7, timezone: 'UTC', // settings: {}, is_robot_question: 'no', llm_model: agentData.llmModel || 'gpt-4o-mini-2025-04-16', avatar: agentData.avatar, }; apiClient.serviceBot.setAuthHeader(process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY); // also need to provide company_id const response = await apiClient.serviceBot.create(serviceBotData); const newAgent = mapServiceBotToAgent(response.data); console.log(response, 'response'); setAgents((prev) => [...prev, newAgent]); toast.success('Агент создан успешно'); return newAgent; } catch (err) { const errorMessage = err instanceof Error ? err.message : 'Failed to create agent'; toast.error('Ошибка создания агента', { description: errorMessage, }); return null; } finally { setIsLoading(false); } }, [user?.company_id] ); const updateAgent = useCallback( async (agentId: any, updates: Partial<Agent>) => { try { setIsLoading(true); const serviceBotData = mapAgentToServiceBotData({ ...agents.find((a) => a.id === agentId)!, ...updates, }); console.log('updating bot with data:', serviceBotData); apiClient.serviceBot.setAuthHeader(process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY); const response = await apiClient.serviceBot.update( parseInt(agentId), serviceBotData ); const updatedAgent = mapServiceBotToAgent(response.data); setAgents((prev) => prev.map((agent) => (agent.id === agentId ? updatedAgent : agent)) ); toast.success('Агент обновлен'); return updatedAgent; } catch (err) { const errorMessage = err instanceof Error ? err.message : 'Failed to update agent'; toast.error('Ошибка обновления агента', { description: errorMessage, }); return null; } finally { setIsLoading(false); } }, [agents] ); const deleteAgent = useCallback(async (agentId: any, companyId: number) => { try { setIsLoading(true); apiClient.serviceBot.setAuthHeader(process.env.NEXT_PUBLIC_MAIN_SERVICE_API_KEY); // Send company_id as a query parameter await apiClient.serviceBot.delete(parseInt(agentId), { params: { company_id: companyId, }, }); setAgents((prev) => prev.filter((agent) => agent.id !== agentId)); toast.success('Агент удален'); return true; } catch (err) { const errorMessage = err instanceof Error ? err.message : 'Failed to delete agent'; toast.error('Ошибка удаления агента', { description: errorMessage, }); return false; } finally { setIsLoading(false); } }, []); const loadMore = useCallback(() => { if (!isLoading && agents.length < total) { setOffset((prev) => prev + limit); } }, [isLoading, agents.length, total, limit]); const refresh = useCallback(() => { setOffset(0); fetchAgents(); }, [fetchAgents]); // Auto load on mount if enabled useEffect(() => { if (autoLoad && user?.company_id) { fetchAgents(); } }, [autoLoad, fetchAgents, user?.company_id]); return { agents, isLoading, error, total, hasMore: agents.length < total, fetchAgents, createAgent, updateAgent, deleteAgent, loadMore, refresh, }; }
```

# hooks\use-mobile.ts

```ts
import * as React from "react" const MOBILE_BREAKPOINT = 768 export function useIsMobile() { const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined) React.useEffect(() => { const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`) const onChange = () => { setIsMobile(window.innerWidth < MOBILE_BREAKPOINT) } mql.addEventListener("change", onChange) setIsMobile(window.innerWidth < MOBILE_BREAKPOINT) return () => mql.removeEventListener("change", onChange) }, []) return !!isMobile }
```

# jest.config.ts

```ts
import type { Config } from 'jest'; import nextJest from 'next/jest'; const createJestConfig = nextJest({ // Provide the path to your Next.js app to load next.config.js and .env files in your test environment dir: './', }); // Add any custom config to be passed to Jest const config: Config = { coverageProvider: 'v8', testEnvironment: 'jsdom', // Add more setup options before each test is run setupFilesAfterEnv: ['<rootDir>/jest.setup.ts'], moduleNameMapper: { '^@/(.*)$': '<rootDir>/$1', }, testPathIgnorePatterns: ['/node_modules/', '/.next/'], transformIgnorePatterns: [ '/node_modules/', '^.+\\.module\\.(css|sass|scss)$', ], collectCoverageFrom: [ 'app/**/*.{js,jsx,ts,tsx}', 'components/**/*.{js,jsx,ts,tsx}', 'lib/**/*.{js,jsx,ts,tsx}', '!**/*.d.ts', '!**/node_modules/**', '!**/.next/**', ], coverageThreshold: { global: { branches: 60, functions: 60, lines: 60, statements: 60, }, }, }; // createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async export default createJestConfig(config);
```

# jest.setup.ts

```ts
import '@testing-library/jest-dom'; // Mock Next.js router jest.mock('next/navigation', () => ({ useRouter() { return { push: jest.fn(), back: jest.fn(), refresh: jest.fn(), prefetch: jest.fn(), replace: jest.fn(), }; }, usePathname() { return '/'; }, useSearchParams() { return new URLSearchParams(); }, })); // Mock window.matchMedia Object.defineProperty(window, 'matchMedia', { writable: true, value: jest.fn().mockImplementation((query) => ({ matches: false, media: query, onchange: null, addListener: jest.fn(), // deprecated removeListener: jest.fn(), // deprecated addEventListener: jest.fn(), removeEventListener: jest.fn(), dispatchEvent: jest.fn(), })), }); // Mock IntersectionObserver global.IntersectionObserver = class IntersectionObserver { constructor() {} disconnect() {} observe() {} unobserve() {} } as any; // Mock localStorage const localStorageMock = { getItem: jest.fn(), setItem: jest.fn(), removeItem: jest.fn(), clear: jest.fn(), length: 0, key: jest.fn(), }; global.localStorage = localStorageMock as any; // Mock console methods in tests to reduce noise global.console = { ...console, error: jest.fn(), warn: jest.fn(), };
```

# lib\agent-store.ts

```ts
import { create } from 'zustand'; import { persist } from 'zustand/middleware'; import type { Agent } from '@/hooks/use-agents'; interface AgentStatusMap { [agentId: string]: string | 'active' | 'inactive'; } interface AgentStore { agents: Agent[]; selectedAgent: Agent | null; agentStatuses: AgentStatusMap; setAgents: (agents: Agent[]) => void; setSelectedAgent: (agent: Agent | null) => void; updateAgent: (updatedAgent: Agent) => void; deleteAgent: (agentId: string) => void; addAgent: (agent: Agent) => void; toggleAgentStatus: (agentId: string) => void; getAgentStatus: (agentId: string) => string | 'active' | 'inactive'; } export const useAgentStore = create<AgentStore>()( persist( (set, get) => ({ agents: [], selectedAgent: null, agentStatuses: {}, setAgents: (agents) => { const { selectedAgent, agentStatuses } = get(); // Merge agents with their statuses from localStorage const agentsWithStatus = agents.map((agent) => ({ ...agent, status: agentStatuses[agent.id] || 'active', })); set({ agents: agentsWithStatus, selectedAgent: selectedAgent ? agentsWithStatus.find((a) => a.id === selectedAgent.id) || null : null, }); }, setSelectedAgent: (agent) => { if (agent) { const status = get().agentStatuses[agent.id] || 'active'; set({ selectedAgent: { ...agent, status }, }); } else { set({ selectedAgent: null }); } }, updateAgent: (updatedAgent) => { const { agents, selectedAgent, agentStatuses } = get(); const status = agentStatuses[updatedAgent.id] || 'active'; const agentWithStatus = { ...updatedAgent, status }; const newAgents = agents.map((agent) => agent.id === updatedAgent.id ? agentWithStatus : agent ); set({ agents: newAgents, selectedAgent: selectedAgent?.id === updatedAgent.id ? agentWithStatus : selectedAgent, }); }, deleteAgent: (agentId) => { const { agents, selectedAgent, agentStatuses } = get(); const newAgents = agents.filter((agent) => agent.id !== agentId); const newStatuses = { ...agentStatuses }; delete newStatuses[agentId]; set({ agents: newAgents, agentStatuses: newStatuses, selectedAgent: selectedAgent?.id === agentId ? newAgents[0] || null : selectedAgent, }); }, addAgent: (agent) => { const { agents, agentStatuses } = get(); const newStatuses = { ...agentStatuses, [agent.id]: 'active' }; set({ agents: [...agents, { ...agent, status: 'active' }], agentStatuses: newStatuses, }); }, toggleAgentStatus: (agentId) => { const { agents, selectedAgent, agentStatuses } = get(); const currentStatus = agentStatuses[agentId] || 'active'; const newStatus = currentStatus === 'active' ? 'inactive' : 'active'; const newStatuses = { ...agentStatuses, [agentId]: newStatus }; // Update agents array with new status const newAgents = agents.map((agent) => agent.id === agentId ? { ...agent, status: newStatus } : agent ); // Update selected agent if it's the one being toggled const updatedSelectedAgent = selectedAgent?.id === agentId ? { ...selectedAgent, status: newStatus } : selectedAgent; set({ agents: newAgents, agentStatuses: newStatuses, selectedAgent: updatedSelectedAgent, }); }, getAgentStatus: (agentId) => { const { agentStatuses } = get(); return agentStatuses[agentId] || 'active'; }, }), { name: 'agent-store', partialize: (state) => ({ agentStatuses: state.agentStatuses, selectedAgentId: state.selectedAgent?.id, }), } ) );
```

# lib\api\client.ts

```ts
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig, } from 'axios'; import { API_CONFIG, API_ENDPOINTS } from './config'; import { tokenManager } from '../auth/token-manager'; import { toast } from 'sonner'; interface ApiError { error?: string; message?: string; detail?: string; status_code?: number; } class ApiClient { private authClient: AxiosInstance; private backendClient: AxiosInstance; private isRefreshing = false; private refreshSubscribers: ((token: string) => void)[] = []; constructor() { // Auth Service Client this.authClient = axios.create({ baseURL: API_CONFIG.AUTH_SERVICE_URL, timeout: API_CONFIG.TIMEOUT, headers: { 'Content-Type': 'application/json', }, }); // Backend Service Client this.backendClient = axios.create({ baseURL: API_CONFIG.BACKEND_URL, timeout: API_CONFIG.TIMEOUT, headers: { 'Content-Type': 'application/json', }, }); this.setupInterceptors(); } private setupInterceptors() { // Request interceptor for backend client this.backendClient.interceptors.request.use( (config: InternalAxiosRequestConfig) => { const token = tokenManager.getAccessToken(); if (token && config.headers) { config.headers.Authorization = `Bearer ${token}`; } return config; }, (error: any) => Promise.reject(error) ); // Response interceptor for backend client this.backendClient.interceptors.response.use( (response: any) => response, async (error: AxiosError<ApiError>) => { const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean; }; if (error.response?.status === 401 && !originalRequest._retry) { if (this.isRefreshing) { return new Promise((resolve) => { this.refreshSubscribers.push((token: string) => { if (originalRequest.headers) { originalRequest.headers.Authorization = `Bearer ${token}`; } resolve(this.backendClient(originalRequest)); }); }); } originalRequest._retry = true; this.isRefreshing = true; try { const refreshToken = tokenManager.getRefreshToken(); if (!refreshToken) { throw new Error('No refresh token'); } const response = await this.authClient.post( API_ENDPOINTS.auth.refresh, { refresh_token: refreshToken, } ); const { access_token, refresh_token } = response.data; tokenManager.setTokens(access_token, refresh_token); this.refreshSubscribers.forEach((callback) => callback(access_token) ); this.refreshSubscribers = []; if (originalRequest.headers) { originalRequest.headers.Authorization = `Bearer ${access_token}`; } return this.backendClient(originalRequest); } catch (refreshError) { tokenManager.clearTokens(); window.location.href = '/login'; return Promise.reject(refreshError); } finally { this.isRefreshing = false; } } if (error.response?.data) { const errorMessage = error.response.data.detail || error.response.data.message || error.response.data.error || 'Произошла ошибка'; if (error.response.status >= 500) { toast.error('Ошибка сервера', { description: errorMessage, }); } else if (error.response.status >= 400) { toast.error(errorMessage); } } else if (error.request) { toast.error('Ошибка сети', { description: 'Проверьте подключение к интернету', }); } return Promise.reject(error); } ); // Auth client response interceptor this.authClient.interceptors.response.use( (response: any) => response, (error: AxiosError<ApiError>) => { if (error.response?.data) { const errorMessage = error.response.data.detail || error.response.data.message || error.response.data.error || 'Ошибка авторизации'; toast.error(errorMessage); } return Promise.reject(error); } ); } // Auth methods get auth() { return { register: (data: RegisterData) => this.authClient.post<AuthResponse>(API_ENDPOINTS.auth.register, data), login: (data: LoginData) => this.authClient.post<AuthResponse>(API_ENDPOINTS.auth.login, data), logout: () => { const token = tokenManager.getAccessToken(); return this.authClient.post( API_ENDPOINTS.auth.logout, {}, { headers: { Authorization: `Bearer ${token}` }, } ); }, getMe: () => { const token = tokenManager.getAccessToken(); return this.authClient.get<User>(API_ENDPOINTS.auth.me, { headers: { Authorization: `Bearer ${token}` }, }); }, verifyEmail: (token: string) => this.authClient.post(API_ENDPOINTS.auth.verify, { token }), }; } // Backend methods get backend() { return this.backendClient; } get company() { return { list: (params?: PaginationParams) => this.backendClient.get<PaginatedResponse<Company>>( API_ENDPOINTS.company.list, { params } ), get: (id: number) => this.backendClient.get<Company>(API_ENDPOINTS.company.get(id)), create: (data: CreateCompanyData) => this.backendClient.post<Company>(API_ENDPOINTS.company.create, data), update: (id: number, data: UpdateCompanyData) => this.backendClient.patch<Company>( API_ENDPOINTS.company.update(id), data ), delete: (id: number) => this.backendClient.delete(API_ENDPOINTS.company.delete(id)), }; } get infoFlow() { return { list: (params?: InfoFlowListParams) => this.backendClient.get<PaginatedResponse<InfoFlow>>( API_ENDPOINTS.infoFlow.list, { params } ), get: (id: number) => this.backendClient.get<InfoFlow>(API_ENDPOINTS.infoFlow.get(id)), create: (data: CreateInfoFlowData) => this.backendClient.post<InfoFlow>(API_ENDPOINTS.infoFlow.create, data), update: (id: number, data: UpdateInfoFlowData) => this.backendClient.patch<InfoFlow>( API_ENDPOINTS.infoFlow.update(id), data ), delete: (id: number) => this.backendClient.delete(API_ENDPOINTS.infoFlow.delete(id)), getOAuthLink: (id: number, flowType: string) => this.backendClient.get<{ url: string }>( API_ENDPOINTS.infoFlow.oauth(id, flowType) ), // we need to add x-authorization header with main service key setAuthHeader: (serviceKey: string | undefined) => { this.backendClient.defaults.headers.common['x-authorization'] = serviceKey; }, }; } get chat() { return { // Create a new chat create: (data: CreateChatData) => this.backendClient.post<Chat>('/api/v1/chat/', data), // Get chat by ID get: (id: number) => this.backendClient.get<Chat>(`/api/v1/chat/${id}`), // List chats for info flow list: (infoFlowId: number, params?: PaginationParams) => this.backendClient.get<PaginatedResponse<Chat>>( API_ENDPOINTS.chat.list(infoFlowId), { params } ), // Get messages for appeal getMessages: (appealId: number, params?: PaginationParams) => this.backendClient.get<PaginatedResponse<Message>>( API_ENDPOINTS.chat.messages(appealId), { params } ), // Send message as company/operator sendMessage: (data: MessageCreateData) => this.backendClient.post<Message>(API_ENDPOINTS.chat.sendMessage, { appeal_id: data.appeal_id, message: data.text, message_type: data.type || 'text', }), // Mark messages as read markMessagesAsRead: (appealId: number, lastMessageId: number) => this.backendClient.patch( `/api/v1/message/${appealId}/messages/mark_as_read`, null, { params: { last_message_id: lastMessageId } } ), // New endpoints for service bot chat createConversation: (infoFlowId: number, data: ConversationCreateData) => this.backendClient.post<ConversationResponse>( `/api/v1/text_bot/${infoFlowId}/conversation/`, data, { headers: { 'Bot-authorization': API_CONFIG.BOTS_CONNECTION_SECRET || 'secret_key', }, } ), getServiceBotConfig: (infoFlowId: number) => this.backendClient.get<ServiceBotConfigResponse>( `/api/v1/text_bot/${infoFlowId}/service_bot_settings/`, { headers: { 'Bot-authorization': API_CONFIG.BOTS_CONNECTION_SECRET || 'bot_secret_key', }, } ), }; } get appeal() { return { list: (params?: AppealListParams) => this.backendClient.get<PaginatedResponse<Appeal>>( API_ENDPOINTS.appeal.list, { params } ), get: (id: number) => this.backendClient.get<Appeal>(API_ENDPOINTS.appeal.get(id)), // Create new appeal create: (data: CreateAppealData) => this.backendClient.post<Appeal>('/api/v1/appeal/', data), // Update appeal update: (id: number, data: UpdateAppealData) => this.backendClient.patch<Appeal>(API_ENDPOINTS.appeal.update(id), data), // update: (id: number, data: UpdateAppealData) => // this.backendClient.patch<Appeal>(API_ENDPOINTS.appeal.update(id), data), assign: (id: number, operatorId: number) => this.backendClient.post<Appeal>(API_ENDPOINTS.appeal.assign(id), { operator_id: operatorId, }), close: (id: number) => this.backendClient.post<Appeal>(API_ENDPOINTS.appeal.close(id)), }; } get serviceBot() { return { list: (params?: PaginationParams) => this.backendClient.get<PaginatedResponse<ServiceBot>>( API_ENDPOINTS.serviceBot.list, { params } ), get: (id: number) => this.backendClient.get<ServiceBot>(API_ENDPOINTS.serviceBot.get(id)), // we need to add x-authorization header with main service key setAuthHeader: (serviceKey: string | undefined) => { this.backendClient.defaults.headers.common['x-authorization'] = serviceKey; }, create: (data: CreateServiceBotData) => this.backendClient.post<ServiceBot>( API_ENDPOINTS.serviceBot.create, data ), update: (id: number, data: UpdateServiceBotData) => this.backendClient.patch<ServiceBot>( API_ENDPOINTS.serviceBot.update(id), data ), delete: (id: number, data: any) => this.backendClient.delete(API_ENDPOINTS.serviceBot.delete(id), data), }; } // Service Bot Relation endpoints get serviceBotRelation() { return { // Create bot-flow relation create: (data: ServiceBotRelation) => this.backendClient.post( '/api/v1/service_bot_relation/info_flow/', data ), // Get relations for bot getByBot: (botId: number) => this.backendClient.get<ServiceBotRelation[]>( `/api/v1/service_bot_relation/service_bot/${botId}/` ), // Get relations for flow getByFlow: (flowId: number) => this.backendClient.get<ServiceBotRelation[]>( `/api/v1/service_bot_relation/info_flow/${flowId}/` ), // Delete relation delete: (botId: number, flowId: number) => this.backendClient.delete( `/api/v1/service_bot_relation/${botId}/${flowId}/` ), }; } get operator() { return { getStats: (params?: OperatorStatsParams) => this.backendClient.get<OperatorStats>(API_ENDPOINTS.operator.stats, { params, }), list: (params?: PaginationParams) => this.backendClient.get<PaginatedResponse<Operator>>( API_ENDPOINTS.operator.list, { params } ), }; } get sender() { return { create: (data: any) => this.backendClient.post('/api/v1/sender/', data), }; } } // Types interface RegisterData { email: string; phone: string; password: string; password_confirmation: string; name: string; company_id?: number; } interface LoginData { email: string; password: string; } interface AuthResponse { access_token: string; refresh_token: string; expires_in: number; user: User; } interface User { id: number; email: string; name: string; phone: string; role: string; company_id?: number; is_active: boolean; is_verified: boolean; created_at: string; updated_at: string; } interface Company { id: number; auto_assign_appeals: boolean; is_active: boolean; created_at: string; updated_at: string; } interface InfoFlow { id: number; company_id: number; name: string; type: string; data: Record<string, any>; status: string; created_at: string; updated_at: string; } interface Chat { id: number; info_flow_id: number; messenger_chat_id: string; type: string; meta: Record<string, any>; } interface Message { id: number; appeal_id: number; sender: { id: string; type: string; name?: string; username?: string; avatar?: string; }; text: string; type: string; attachments: any[]; created_at: string; } interface Appeal { id: number; company_id: number; info_flow_id: number; chat_id: number; operator_id?: number; status: string; created_at: string; updated_at: string; } interface ServiceBot { id: number; company_id: number; prompt: string; enable_functions: boolean; // decimal talkativeness: number; temperature: number; timezone: string; settings: any; is_robot_question: string; llm_model: string; name: string; avatar?: string; } interface Operator { id: number; name: string; email: string; role: string; } interface OperatorStats { operator_id: number; company_id: number; appeals_cnt: number; appeals_accepted_cnt: number; appeals_closed_cnt: number; mean_response_time_in_seconds: number; mean_pending_time_in_seconds: number; } interface PaginationParams { page?: number; page_size?: number; limit?: number; offset?: number; } interface PaginatedResponse<T> { page: number; page_size: number; pages: number; count: number; next?: string | null; previous?: string | null; results: T[]; total: number; limit: number; offset: number; } interface ConversationCreateData { type: string; messenger_chat_id: string; meta: any; } interface MessageCreateData { appeal_id: number; text: string; type?: 'text' | 'image' | 'video' | 'audio' | 'file'; attachments?: any[]; } interface ServiceBotConfigResponse { company_id?: number; bot_id?: number; bot_name?: string; bot_avatar?: string; bot_prompt?: string; bot_talkativeness?: number; bot_temperature?: number; bot_timezone?: string; settings?: any; bot_is_robot_question?: string; bot_llm_model?: string; } interface ConversationResponse { status: boolean; appeal?: Appeal; bot?: ServiceBot; } interface CreateCompanyData { auto_assign_appeals: boolean; is_active: boolean; } interface ServiceBotRelation { service_bot_id: number; info_flow_id: number; is_active: boolean; } interface CreateAppealData { id: any; chat_id: number; company_id: number; service_bot_id?: number; status?: string; needs_an_operator?: boolean; is_ruled_by_bot?: boolean; operator: number; } interface UpdateAppealData { status?: string; operator_id?: number; needs_an_operator?: boolean; is_ruled_by_bot?: boolean; } interface CreateChatData { info_flow_id: number; type: string; messenger_chat_id: string; meta?: any; } interface CreateServiceBotData { id?: number; company_id: number; prompt: string; talkativeness: number; temperature: number; timezone: string; is_robot_question: string; llm_model: string; name: string; avatar?: string; } interface UpdateCompanyData extends Partial<CreateCompanyData> {} interface InfoFlowListParams extends PaginationParams { company_id?: number; type?: string; } interface CreateInfoFlowData { company_id: number; name: string; type: string; data: Record<string, any>; } interface UpdateInfoFlowData extends Partial<CreateInfoFlowData> {} interface SendMessageData { appeal_id: number; text: string; type?: string; attachments?: any[]; } interface AppealListParams extends PaginationParams { company_id?: number; status?: string; operator_id?: number; info_flow_id: any; } interface UpdateAppealData { status?: string; operator_id?: number; } interface CreateServiceBotData { id?: number; // Optional for new agents company_id: number; prompt: string; // enable_functions: boolean; talkativeness: number; temperature: number; timezone: string; // settings: any; is_robot_question: string; llm_model: string; name: string; avatar?: string; } interface UpdateServiceBotData extends Partial<CreateServiceBotData> {} interface OperatorStatsParams extends PaginationParams { company_id?: number; start_date?: string; end_date?: string; } // Export singleton instance export const apiClient = new ApiClient(); export type { RegisterData, LoginData, AuthResponse, User, Company, InfoFlow, Chat, Message, Appeal, ServiceBot, ServiceBotRelation, Operator, OperatorStats, PaginationParams, PaginatedResponse, CreateServiceBotData, UpdateServiceBotData, CreateChatData, CreateAppealData, UpdateAppealData, };
```

# lib\api\config.ts

```ts
'use client'; export const API_CONFIG = { AUTH_SERVICE_URL: process.env.NEXT_PUBLIC_AUTH_SERVICE_URL || 'http://localhost:8000', BACKEND_URL: process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:8100', BOTS_CONNECTION_SECRET: process.env.NEXT_PUBLIC_BOTS_CONNECTION_SECRET || 'secret_key', TIMEOUT: 30000, RETRY_ATTEMPTS: 3, RETRY_DELAY: 1000, }; export const API_ENDPOINTS = { // Auth Service Endpoints auth: { register: '/api/v1/auth/register', login: '/api/v1/auth/login', refresh: '/api/v1/auth/refresh', logout: '/api/v1/auth/logout', me: '/api/v1/auth/me', publicKey: '/api/v1/auth/public-key', verify: '/api/v1/auth/verify-email', }, // Main Backend Endpoints company: { list: '/api/v1/company/', get: (id: number) => `/api/v1/company/${id}`, create: '/api/v1/company/', update: (id: number) => `/api/v1/company/${id}`, delete: (id: number) => `/api/v1/company/${id}`, }, infoFlow: { list: '/api/v1/info_flow/list', get: (id: number) => `/api/v1/info_flow/${id}`, create: '/api/v1/info_flow/', update: (id: number) => `/api/v1/info_flow/${id}`, delete: (id: number) => `/api/v1/info_flow/${id}`, oauth: (id: number, type: string) => `/api/v1/info_flow/${id}/oauth/?flow_type=${type}`, }, chat: { create: '/api/v1/chat/', get: (id: number) => `/api/v1/chat/${id}`, list: (infoFlowId: number) => `/api/v1/info_flow/${infoFlowId}/chats/`, messages: (appealId: number) => `/api/v1/message/${appealId}/list/`, sendMessage: '/api/v1/message/', }, appeal: { list: '/api/v1/appeal/', get: (id: number) => `/api/v1/appeal/${id}`, create: '/api/v1/appeal/', update: (id: number) => `/api/v1/appeal/${id}`, assign: (id: number) => `/api/v1/appeal/${id}/assign/`, close: (id: number) => `/api/v1/appeal/${id}/close/`, }, serviceBot: { list: '/api/v1/service_bot/', get: (id: number) => `/api/v1/service_bot/${id}`, create: '/api/v1/service_bot/', update: (id: number) => `/api/v1/service_bot/${id}`, delete: (id: number) => `/api/v1/service_bot/${id}`, }, serviceBotRelation: { create: '/api/v1/service_bot_relation/info_flow/', getByBot: (botId: number) => `/api/v1/service_bot_relation/service_bot/${botId}/`, getByFlow: (flowId: number) => `/api/v1/service_bot_relation/info_flow/${flowId}/`, delete: (botId: number, flowId: number) => `/api/v1/service_bot_relation/${botId}/${flowId}/`, }, operator: { stats: '/api/v1/operator/stats/', list: '/api/v1/operator/', }, websocket: { crm: '/api/v1/ws/crm/', }, }; export const getAuthHeaders = (token: string) => ({ Authorization: `Bearer ${token}`, 'Content-Type': 'application/json', }); export const getWebSocketUrl = (endpoint: string, token: string) => { const wsUrl = API_CONFIG.BACKEND_URL.replace(/^http/, 'ws'); return `${wsUrl}${endpoint}?access_token=${token}`; };
```

# lib\auth\token-manager.ts

```ts
import { jwtDecode } from 'jwt-decode'; interface TokenPayload { sub: string; exp: number; iat: number; jti: string; company_id?: number; role?: string; } class TokenManager { private readonly ACCESS_TOKEN_KEY = 'neurox_access_token'; private readonly REFRESH_TOKEN_KEY = 'neurox_refresh_token'; private readonly USER_KEY = 'neurox_user'; // Token management setTokens(accessToken: string, refreshToken: string) { if (typeof window !== 'undefined') { localStorage.setItem(this.ACCESS_TOKEN_KEY, accessToken); localStorage.setItem(this.REFRESH_TOKEN_KEY, refreshToken); } } getAccessToken(): string | null { if (typeof window === 'undefined') return null; return localStorage.getItem(this.ACCESS_TOKEN_KEY); } getRefreshToken(): string | null { if (typeof window === 'undefined') return null; return localStorage.getItem(this.REFRESH_TOKEN_KEY); } clearTokens() { if (typeof window !== 'undefined') { localStorage.removeItem(this.ACCESS_TOKEN_KEY); localStorage.removeItem(this.REFRESH_TOKEN_KEY); localStorage.removeItem(this.USER_KEY); } } // User management setUser(user: any) { if (typeof window !== 'undefined') { localStorage.setItem(this.USER_KEY, JSON.stringify(user)); } } getUser(): any | null { if (typeof window === 'undefined') return null; const userStr = localStorage.getItem(this.USER_KEY); if (!userStr) return null; try { return JSON.parse(userStr); } catch { return null; } } // Token validation isTokenExpired(token: string): boolean { try { const decoded = jwtDecode<TokenPayload>(token); const currentTime = Date.now() / 1000; return decoded.exp < currentTime; } catch { return true; } } isAuthenticated(): boolean { const accessToken = this.getAccessToken(); if (!accessToken) return false; return !this.isTokenExpired(accessToken); } // Token payload getTokenPayload(token?: string): TokenPayload | null { const targetToken = token || this.getAccessToken(); if (!targetToken) return null; try { return jwtDecode<TokenPayload>(targetToken); } catch { return null; } } getUserRole(): string | null { const user = this.getUser(); return user?.role || null; } getCompanyId(): number | null { const user = this.getUser(); return user?.company_id || null; } isAdmin(): boolean { return this.getUserRole() === 'admin'; } isOperator(): boolean { return this.getUserRole() === 'operator'; } isViewer(): boolean { return this.getUserRole() === 'viewer'; } // Session management hasValidSession(): boolean { const accessToken = this.getAccessToken(); const refreshToken = this.getRefreshToken(); if (!accessToken || !refreshToken) return false; if (this.isTokenExpired(refreshToken)) { this.clearTokens(); return false; } return true; } // Get time until token expiry getTokenExpiryTime(): number | null { const accessToken = this.getAccessToken(); if (!accessToken) return null; try { const decoded = jwtDecode<TokenPayload>(accessToken); const currentTime = Date.now() / 1000; return Math.max(0, decoded.exp - currentTime); } catch { return null; } } // Check if token needs refresh (less than 5 minutes remaining) shouldRefreshToken(): boolean { const expiryTime = this.getTokenExpiryTime(); if (expiryTime === null) return false; return expiryTime < 300; // 5 minutes } } export const tokenManager = new TokenManager(); export type { TokenPayload };
```

# lib\utils.ts

```ts
import { clsx, type ClassValue } from "clsx" import { twMerge } from "tailwind-merge" export function cn(...inputs: ClassValue[]) { return twMerge(clsx(inputs)) }
```

# next-env.d.ts

```ts
/// <reference types="next" /> /// <reference types="next/image-types/global" /> // NOTE: This file should not be edited // see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
```

# next.config.ts

```ts
import type { NextConfig } from 'next'; const nextConfig: NextConfig = { output: 'standalone', poweredByHeader: false, reactStrictMode: true, swcMinify: true, // Оптимизация изображений images: { domains: ['api.dicebear.com', 'example.com', 'localhost'], formats: ['image/avif', 'image/webp'], }, // Экспериментальные функции для улучшения производительности experimental: { optimizeCss: true, }, // Заголовки безопасности async headers() { return [ { source: '/:path*', headers: [ { key: 'X-DNS-Prefetch-Control', value: 'on', }, { key: 'X-XSS-Protection', value: '1; mode=block', }, { key: 'X-Frame-Options', value: 'SAMEORIGIN', }, { key: 'X-Content-Type-Options', value: 'nosniff', }, { key: 'Referrer-Policy', value: 'origin-when-cross-origin', }, ], }, ]; }, // Webpack конфигурация для оптимизации webpack: (config, { isServer }) => { // Оптимизация для клиента if (!isServer) { config.resolve.fallback = { ...config.resolve.fallback, fs: false, net: false, tls: false, }; } return config; }, }; export default nextConfig;
```

# package.json

```json
{ "name": "nextbot", "version": "0.1.0", "private": true, "scripts": { "dev": "next dev", "build": "next build", "start": "next start", "lint": "next lint", "test": "jest" }, "dependencies": { "@radix-ui/react-alert-dialog": "^1.1.14", "@radix-ui/react-avatar": "^1.1.10", "@radix-ui/react-checkbox": "^1.3.2", "@radix-ui/react-collapsible": "^1.1.11", "@radix-ui/react-dialog": "^1.1.14", "@radix-ui/react-dropdown-menu": "^2.1.15", "@radix-ui/react-label": "^2.1.7", "@radix-ui/react-progress": "^1.1.7", "@radix-ui/react-radio-group": "^1.3.7", "@radix-ui/react-scroll-area": "^1.2.9", "@radix-ui/react-select": "^2.2.5", "@radix-ui/react-separator": "^1.1.7", "@radix-ui/react-slider": "^1.3.5", "@radix-ui/react-slot": "^1.2.3", "@radix-ui/react-switch": "^1.2.5", "@radix-ui/react-tabs": "^1.1.12", "@radix-ui/react-tooltip": "^1.2.7", "@testing-library/user-event": "^14.6.1", "@types/react-is": "^19.0.0", "axios": "^1.10.0", "class-variance-authority": "^0.7.1", "clsx": "^2.1.1", "framer-motion": "^12.23.6", "jwt-decode": "^4.0.0", "lucide-react": "^0.525.0", "next": "15.3.4", "next-themes": "^0.4.6", "react": "^19.0.0", "react-dom": "^19.0.0", "react-is": "^19.0.0", "recharts": "^3.0.2", "sonner": "^2.0.5", "tailwind-merge": "^3.3.1", "zustand": "^5.0.6" }, "devDependencies": { "@tailwindcss/postcss": "^4", "@testing-library/dom": "^10.4.0", "@testing-library/jest-dom": "^6.6.3", "@testing-library/react": "^16.3.0", "@types/jest": "^30.0.0", "@types/node": "^20", "@types/react": "^19", "@types/react-dom": "^19", "jest": "^30.0.4", "jest-environment-jsdom": "^30.0.4", "tailwindcss": "^4", "ts-node": "^10.9.2", "tw-animate-css": "^1.3.4", "typescript": "^5" } }
```

# postcss.config.mjs

```mjs
const config = { plugins: ["@tailwindcss/postcss"], }; export default config;
```

# tsconfig.json

```json
{ "compilerOptions": { "target": "ES2017", "lib": ["dom", "dom.iterable", "esnext"], "allowJs": true, "skipLibCheck": true, "strict": true, "noEmit": true, "esModuleInterop": true, "module": "esnext", "moduleResolution": "bundler", "resolveJsonModule": true, "isolatedModules": true, "jsx": "preserve", "incremental": true, "plugins": [ { "name": "next" } ], "paths": { "@/*": ["./*"] } }, "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"], "exclude": ["node_modules"] }
```

# types\agent.ts

```ts
export interface Agent { id: string; name: string; avatar: string; model: string; status: 'active' | 'inactive'; createdAt: Date; expenses: { unavailable: number; botcoin: number; }; temperature?: number; instructions?: string; llmModel: string; totalConversations: number; // Backend fields mapping company_id: number; prompt: string; enable_functions: boolean; talkativeness: number; timezone: string; settings: any; is_robot_question: string; }
```

